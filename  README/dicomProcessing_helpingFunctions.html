<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="generator" content="pdoc 14.1.0"/>
    <title>dicomProcessing_helpingFunctions API documentation</title>

    <style>/*! * Bootstrap Reboot v5.0.0 (https://getbootstrap.com/) * Copyright 2011-2021 The Bootstrap Authors * Copyright 2011-2021 Twitter, Inc. * Licensed under MIT (https://github.com/twbs/bootstrap/blob/main/LICENSE) * Forked from Normalize.css, licensed MIT (https://github.com/necolas/normalize.css/blob/master/LICENSE.md) */*,::after,::before{box-sizing:border-box}@media (prefers-reduced-motion:no-preference){:root{scroll-behavior:smooth}}body{margin:0;font-family:system-ui,-apple-system,"Segoe UI",Roboto,"Helvetica Neue",Arial,"Noto Sans","Liberation Sans",sans-serif,"Apple Color Emoji","Segoe UI Emoji","Segoe UI Symbol","Noto Color Emoji";font-size:1rem;font-weight:400;line-height:1.5;color:#212529;background-color:#fff;-webkit-text-size-adjust:100%;-webkit-tap-highlight-color:transparent}hr{margin:1rem 0;color:inherit;background-color:currentColor;border:0;opacity:.25}hr:not([size]){height:1px}h1,h2,h3,h4,h5,h6{margin-top:0;margin-bottom:.5rem;font-weight:500;line-height:1.2}h1{font-size:calc(1.375rem + 1.5vw)}@media (min-width:1200px){h1{font-size:2.5rem}}h2{font-size:calc(1.325rem + .9vw)}@media (min-width:1200px){h2{font-size:2rem}}h3{font-size:calc(1.3rem + .6vw)}@media (min-width:1200px){h3{font-size:1.75rem}}h4{font-size:calc(1.275rem + .3vw)}@media (min-width:1200px){h4{font-size:1.5rem}}h5{font-size:1.25rem}h6{font-size:1rem}p{margin-top:0;margin-bottom:1rem}abbr[data-bs-original-title],abbr[title]{-webkit-text-decoration:underline dotted;text-decoration:underline dotted;cursor:help;-webkit-text-decoration-skip-ink:none;text-decoration-skip-ink:none}address{margin-bottom:1rem;font-style:normal;line-height:inherit}ol,ul{padding-left:2rem}dl,ol,ul{margin-top:0;margin-bottom:1rem}ol ol,ol ul,ul ol,ul ul{margin-bottom:0}dt{font-weight:700}dd{margin-bottom:.5rem;margin-left:0}blockquote{margin:0 0 1rem}b,strong{font-weight:bolder}small{font-size:.875em}mark{padding:.2em;background-color:#fcf8e3}sub,sup{position:relative;font-size:.75em;line-height:0;vertical-align:baseline}sub{bottom:-.25em}sup{top:-.5em}a{color:#0d6efd;text-decoration:underline}a:hover{color:#0a58ca}a:not([href]):not([class]),a:not([href]):not([class]):hover{color:inherit;text-decoration:none}code,kbd,pre,samp{font-family:SFMono-Regular,Menlo,Monaco,Consolas,"Liberation Mono","Courier New",monospace;font-size:1em;direction:ltr;unicode-bidi:bidi-override}pre{display:block;margin-top:0;margin-bottom:1rem;overflow:auto;font-size:.875em}pre code{font-size:inherit;color:inherit;word-break:normal}code{font-size:.875em;color:#d63384;word-wrap:break-word}a>code{color:inherit}kbd{padding:.2rem .4rem;font-size:.875em;color:#fff;background-color:#212529;border-radius:.2rem}kbd kbd{padding:0;font-size:1em;font-weight:700}figure{margin:0 0 1rem}img,svg{vertical-align:middle}table{caption-side:bottom;border-collapse:collapse}caption{padding-top:.5rem;padding-bottom:.5rem;color:#6c757d;text-align:left}th{text-align:inherit;text-align:-webkit-match-parent}tbody,td,tfoot,th,thead,tr{border-color:inherit;border-style:solid;border-width:0}label{display:inline-block}button{border-radius:0}button:focus:not(:focus-visible){outline:0}button,input,optgroup,select,textarea{margin:0;font-family:inherit;font-size:inherit;line-height:inherit}button,select{text-transform:none}[role=button]{cursor:pointer}select{word-wrap:normal}select:disabled{opacity:1}[list]::-webkit-calendar-picker-indicator{display:none}[type=button],[type=reset],[type=submit],button{-webkit-appearance:button}[type=button]:not(:disabled),[type=reset]:not(:disabled),[type=submit]:not(:disabled),button:not(:disabled){cursor:pointer}::-moz-focus-inner{padding:0;border-style:none}textarea{resize:vertical}fieldset{min-width:0;padding:0;margin:0;border:0}legend{float:left;width:100%;padding:0;margin-bottom:.5rem;font-size:calc(1.275rem + .3vw);line-height:inherit}@media (min-width:1200px){legend{font-size:1.5rem}}legend+*{clear:left}::-webkit-datetime-edit-day-field,::-webkit-datetime-edit-fields-wrapper,::-webkit-datetime-edit-hour-field,::-webkit-datetime-edit-minute,::-webkit-datetime-edit-month-field,::-webkit-datetime-edit-text,::-webkit-datetime-edit-year-field{padding:0}::-webkit-inner-spin-button{height:auto}[type=search]{outline-offset:-2px;-webkit-appearance:textfield}::-webkit-search-decoration{-webkit-appearance:none}::-webkit-color-swatch-wrapper{padding:0}::file-selector-button{font:inherit}::-webkit-file-upload-button{font:inherit;-webkit-appearance:button}output{display:inline-block}iframe{border:0}summary{display:list-item;cursor:pointer}progress{vertical-align:baseline}[hidden]{display:none!important}</style>
    <style>/*! syntax-highlighting.css */pre{line-height:125%;}span.linenos{color:inherit; background-color:transparent; padding-left:5px; padding-right:20px;}.pdoc-code .hll{background-color:#ffffcc}.pdoc-code{background:#f8f8f8;}.pdoc-code .c{color:#3D7B7B; font-style:italic}.pdoc-code .err{border:1px solid #FF0000}.pdoc-code .k{color:#008000; font-weight:bold}.pdoc-code .o{color:#666666}.pdoc-code .ch{color:#3D7B7B; font-style:italic}.pdoc-code .cm{color:#3D7B7B; font-style:italic}.pdoc-code .cp{color:#9C6500}.pdoc-code .cpf{color:#3D7B7B; font-style:italic}.pdoc-code .c1{color:#3D7B7B; font-style:italic}.pdoc-code .cs{color:#3D7B7B; font-style:italic}.pdoc-code .gd{color:#A00000}.pdoc-code .ge{font-style:italic}.pdoc-code .gr{color:#E40000}.pdoc-code .gh{color:#000080; font-weight:bold}.pdoc-code .gi{color:#008400}.pdoc-code .go{color:#717171}.pdoc-code .gp{color:#000080; font-weight:bold}.pdoc-code .gs{font-weight:bold}.pdoc-code .gu{color:#800080; font-weight:bold}.pdoc-code .gt{color:#0044DD}.pdoc-code .kc{color:#008000; font-weight:bold}.pdoc-code .kd{color:#008000; font-weight:bold}.pdoc-code .kn{color:#008000; font-weight:bold}.pdoc-code .kp{color:#008000}.pdoc-code .kr{color:#008000; font-weight:bold}.pdoc-code .kt{color:#B00040}.pdoc-code .m{color:#666666}.pdoc-code .s{color:#BA2121}.pdoc-code .na{color:#687822}.pdoc-code .nb{color:#008000}.pdoc-code .nc{color:#0000FF; font-weight:bold}.pdoc-code .no{color:#880000}.pdoc-code .nd{color:#AA22FF}.pdoc-code .ni{color:#717171; font-weight:bold}.pdoc-code .ne{color:#CB3F38; font-weight:bold}.pdoc-code .nf{color:#0000FF}.pdoc-code .nl{color:#767600}.pdoc-code .nn{color:#0000FF; font-weight:bold}.pdoc-code .nt{color:#008000; font-weight:bold}.pdoc-code .nv{color:#19177C}.pdoc-code .ow{color:#AA22FF; font-weight:bold}.pdoc-code .w{color:#bbbbbb}.pdoc-code .mb{color:#666666}.pdoc-code .mf{color:#666666}.pdoc-code .mh{color:#666666}.pdoc-code .mi{color:#666666}.pdoc-code .mo{color:#666666}.pdoc-code .sa{color:#BA2121}.pdoc-code .sb{color:#BA2121}.pdoc-code .sc{color:#BA2121}.pdoc-code .dl{color:#BA2121}.pdoc-code .sd{color:#BA2121; font-style:italic}.pdoc-code .s2{color:#BA2121}.pdoc-code .se{color:#AA5D1F; font-weight:bold}.pdoc-code .sh{color:#BA2121}.pdoc-code .si{color:#A45A77; font-weight:bold}.pdoc-code .sx{color:#008000}.pdoc-code .sr{color:#A45A77}.pdoc-code .s1{color:#BA2121}.pdoc-code .ss{color:#19177C}.pdoc-code .bp{color:#008000}.pdoc-code .fm{color:#0000FF}.pdoc-code .vc{color:#19177C}.pdoc-code .vg{color:#19177C}.pdoc-code .vi{color:#19177C}.pdoc-code .vm{color:#19177C}.pdoc-code .il{color:#666666}</style>
    <style>/*! theme.css */:root{--pdoc-background:#fff;}.pdoc{--text:#212529;--muted:#6c757d;--link:#3660a5;--link-hover:#1659c5;--code:#f8f8f8;--active:#fff598;--accent:#eee;--accent2:#c1c1c1;--nav-hover:rgba(255, 255, 255, 0.5);--name:#0066BB;--def:#008800;--annotation:#007020;}</style>
    <style>/*! layout.css */html, body{width:100%;height:100%;}html, main{scroll-behavior:smooth;}body{background-color:var(--pdoc-background);}@media (max-width:769px){#navtoggle{cursor:pointer;position:absolute;width:50px;height:40px;top:1rem;right:1rem;border-color:var(--text);color:var(--text);display:flex;opacity:0.8;z-index:999;}#navtoggle:hover{opacity:1;}#togglestate + div{display:none;}#togglestate:checked + div{display:inherit;}main, header{padding:2rem 3vw;}header + main{margin-top:-3rem;}.git-button{display:none !important;}nav input[type="search"]{max-width:77%;}nav input[type="search"]:first-child{margin-top:-6px;}nav input[type="search"]:valid ~ *{display:none !important;}}@media (min-width:770px){:root{--sidebar-width:clamp(12.5rem, 28vw, 22rem);}nav{position:fixed;overflow:auto;height:100vh;width:var(--sidebar-width);}main, header{padding:3rem 2rem 3rem calc(var(--sidebar-width) + 3rem);width:calc(54rem + var(--sidebar-width));max-width:100%;}header + main{margin-top:-4rem;}#navtoggle{display:none;}}#togglestate{position:absolute;height:0;opacity:0;}nav.pdoc{--pad:clamp(0.5rem, 2vw, 1.75rem);--indent:1.5rem;background-color:var(--accent);border-right:1px solid var(--accent2);box-shadow:0 0 20px rgba(50, 50, 50, .2) inset;padding:0 0 0 var(--pad);overflow-wrap:anywhere;scrollbar-width:thin; scrollbar-color:var(--accent2) transparent; z-index:1}nav.pdoc::-webkit-scrollbar{width:.4rem; }nav.pdoc::-webkit-scrollbar-thumb{background-color:var(--accent2); }nav.pdoc > div{padding:var(--pad) 0;}nav.pdoc .module-list-button{display:inline-flex;align-items:center;color:var(--text);border-color:var(--muted);margin-bottom:1rem;}nav.pdoc .module-list-button:hover{border-color:var(--text);}nav.pdoc input[type=search]{display:block;outline-offset:0;width:calc(100% - var(--pad));}nav.pdoc .logo{max-width:calc(100% - var(--pad));max-height:35vh;display:block;margin:0 auto 1rem;transform:translate(calc(-.5 * var(--pad)), 0);}nav.pdoc ul{list-style:none;padding-left:0;}nav.pdoc > div > ul{margin-left:calc(0px - var(--pad));}nav.pdoc li a{padding:.2rem 0 .2rem calc(var(--pad) + var(--indent));}nav.pdoc > div > ul > li > a{padding-left:var(--pad);}nav.pdoc li{transition:all 100ms;}nav.pdoc li:hover{background-color:var(--nav-hover);}nav.pdoc a, nav.pdoc a:hover{color:var(--text);}nav.pdoc a{display:block;}nav.pdoc > h2:first-of-type{margin-top:1.5rem;}nav.pdoc .class:before{content:"class ";color:var(--muted);}nav.pdoc .function:after{content:"()";color:var(--muted);}nav.pdoc footer:before{content:"";display:block;width:calc(100% - var(--pad));border-top:solid var(--accent2) 1px;margin-top:1.5rem;padding-top:.5rem;}nav.pdoc footer{font-size:small;}</style>
    <style>/*! content.css */.pdoc{color:var(--text);box-sizing:border-box;line-height:1.5;background:none;}.pdoc .pdoc-button{cursor:pointer;display:inline-block;border:solid black 1px;border-radius:2px;font-size:.75rem;padding:calc(0.5em - 1px) 1em;transition:100ms all;}.pdoc .pdoc-alert{padding:1rem 1rem 1rem calc(1.5rem + 24px);border:1px solid transparent;border-radius:.25rem;background-repeat:no-repeat;background-position:1rem center;margin-bottom:1rem;}.pdoc .pdoc-alert > *:last-child{margin-bottom:0;}.pdoc .pdoc-alert-note {color:#084298;background-color:#cfe2ff;border-color:#b6d4fe;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%23084298%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M8%2016A8%208%200%201%200%208%200a8%208%200%200%200%200%2016zm.93-9.412-1%204.705c-.07.34.029.533.304.533.194%200%20.487-.07.686-.246l-.088.416c-.287.346-.92.598-1.465.598-.703%200-1.002-.422-.808-1.319l.738-3.468c.064-.293.006-.399-.287-.47l-.451-.081.082-.381%202.29-.287zM8%205.5a1%201%200%201%201%200-2%201%201%200%200%201%200%202z%22/%3E%3C/svg%3E");}.pdoc .pdoc-alert-warning{color:#664d03;background-color:#fff3cd;border-color:#ffecb5;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%23664d03%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M8.982%201.566a1.13%201.13%200%200%200-1.96%200L.165%2013.233c-.457.778.091%201.767.98%201.767h13.713c.889%200%201.438-.99.98-1.767L8.982%201.566zM8%205c.535%200%20.954.462.9.995l-.35%203.507a.552.552%200%200%201-1.1%200L7.1%205.995A.905.905%200%200%201%208%205zm.002%206a1%201%200%201%201%200%202%201%201%200%200%201%200-2z%22/%3E%3C/svg%3E");}.pdoc .pdoc-alert-danger{color:#842029;background-color:#f8d7da;border-color:#f5c2c7;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%23842029%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M5.52.359A.5.5%200%200%201%206%200h4a.5.5%200%200%201%20.474.658L8.694%206H12.5a.5.5%200%200%201%20.395.807l-7%209a.5.5%200%200%201-.873-.454L6.823%209.5H3.5a.5.5%200%200%201-.48-.641l2.5-8.5z%22/%3E%3C/svg%3E");}.pdoc .visually-hidden{position:absolute !important;width:1px !important;height:1px !important;padding:0 !important;margin:-1px !important;overflow:hidden !important;clip:rect(0, 0, 0, 0) !important;white-space:nowrap !important;border:0 !important;}.pdoc h1, .pdoc h2, .pdoc h3{font-weight:300;margin:.3em 0;padding:.2em 0;}.pdoc > section:not(.module-info) h1{font-size:1.5rem;font-weight:500;}.pdoc > section:not(.module-info) h2{font-size:1.4rem;font-weight:500;}.pdoc > section:not(.module-info) h3{font-size:1.3rem;font-weight:500;}.pdoc > section:not(.module-info) h4{font-size:1.2rem;}.pdoc > section:not(.module-info) h5{font-size:1.1rem;}.pdoc a{text-decoration:none;color:var(--link);}.pdoc a:hover{color:var(--link-hover);}.pdoc blockquote{margin-left:2rem;}.pdoc pre{border-top:1px solid var(--accent2);border-bottom:1px solid var(--accent2);margin-top:0;margin-bottom:1em;padding:.5rem 0 .5rem .5rem;overflow-x:auto;background-color:var(--code);}.pdoc code{color:var(--text);padding:.2em .4em;margin:0;font-size:85%;background-color:var(--accent);border-radius:6px;}.pdoc a > code{color:inherit;}.pdoc pre > code{display:inline-block;font-size:inherit;background:none;border:none;padding:0;}.pdoc > section:not(.module-info){margin-bottom:1.5rem;}.pdoc .modulename{margin-top:0;font-weight:bold;}.pdoc .modulename a{color:var(--link);transition:100ms all;}.pdoc .git-button{float:right;border:solid var(--link) 1px;}.pdoc .git-button:hover{background-color:var(--link);color:var(--pdoc-background);}.view-source-toggle-state,.view-source-toggle-state ~ .pdoc-code{display:none;}.view-source-toggle-state:checked ~ .pdoc-code{display:block;}.view-source-button{display:inline-block;float:right;font-size:.75rem;line-height:1.5rem;color:var(--muted);padding:0 .4rem 0 1.3rem;cursor:pointer;text-indent:-2px;}.view-source-button > span{visibility:hidden;}.module-info .view-source-button{float:none;display:flex;justify-content:flex-end;margin:-1.2rem .4rem -.2rem 0;}.view-source-button::before{position:absolute;content:"View Source";display:list-item;list-style-type:disclosure-closed;}.view-source-toggle-state:checked ~ .attr .view-source-button::before,.view-source-toggle-state:checked ~ .view-source-button::before{list-style-type:disclosure-open;}.pdoc .docstring{margin-bottom:1.5rem;}.pdoc section:not(.module-info) .docstring{margin-left:clamp(0rem, 5vw - 2rem, 1rem);}.pdoc .docstring .pdoc-code{margin-left:1em;margin-right:1em;}.pdoc h1:target,.pdoc h2:target,.pdoc h3:target,.pdoc h4:target,.pdoc h5:target,.pdoc h6:target,.pdoc .pdoc-code > pre > span:target{background-color:var(--active);box-shadow:-1rem 0 0 0 var(--active);}.pdoc .pdoc-code > pre > span:target{display:block;}.pdoc div:target > .attr,.pdoc section:target > .attr,.pdoc dd:target > a{background-color:var(--active);}.pdoc *{scroll-margin:2rem;}.pdoc .pdoc-code .linenos{user-select:none;}.pdoc .attr:hover{filter:contrast(0.95);}.pdoc section, .pdoc .classattr{position:relative;}.pdoc .headerlink{--width:clamp(1rem, 3vw, 2rem);position:absolute;top:0;left:calc(0rem - var(--width));transition:all 100ms ease-in-out;opacity:0;}.pdoc .headerlink::before{content:"#";display:block;text-align:center;width:var(--width);height:2.3rem;line-height:2.3rem;font-size:1.5rem;}.pdoc .attr:hover ~ .headerlink,.pdoc *:target > .headerlink,.pdoc .headerlink:hover{opacity:1;}.pdoc .attr{display:block;margin:.5rem 0 .5rem;padding:.4rem .4rem .4rem 1rem;background-color:var(--accent);overflow-x:auto;}.pdoc .classattr{margin-left:2rem;}.pdoc .name{color:var(--name);font-weight:bold;}.pdoc .def{color:var(--def);font-weight:bold;}.pdoc .signature{background-color:transparent;}.pdoc .param, .pdoc .return-annotation{white-space:pre;}.pdoc .signature.multiline .param{display:block;}.pdoc .signature.condensed .param{display:inline-block;}.pdoc .annotation{color:var(--annotation);}.pdoc .view-value-toggle-state,.pdoc .view-value-toggle-state ~ .default_value{display:none;}.pdoc .view-value-toggle-state:checked ~ .default_value{display:inherit;}.pdoc .view-value-button{font-size:.5rem;vertical-align:middle;border-style:dashed;margin-top:-0.1rem;}.pdoc .view-value-button:hover{background:white;}.pdoc .view-value-button::before{content:"show";text-align:center;width:2.2em;display:inline-block;}.pdoc .view-value-toggle-state:checked ~ .view-value-button::before{content:"hide";}.pdoc .inherited{margin-left:2rem;}.pdoc .inherited dt{font-weight:700;}.pdoc .inherited dt, .pdoc .inherited dd{display:inline;margin-left:0;margin-bottom:.5rem;}.pdoc .inherited dd:not(:last-child):after{content:", ";}.pdoc .inherited .class:before{content:"class ";}.pdoc .inherited .function a:after{content:"()";}.pdoc .search-result .docstring{overflow:auto;max-height:25vh;}.pdoc .search-result.focused > .attr{background-color:var(--active);}.pdoc .attribution{margin-top:2rem;display:block;opacity:0.5;transition:all 200ms;filter:grayscale(100%);}.pdoc .attribution:hover{opacity:1;filter:grayscale(0%);}.pdoc .attribution img{margin-left:5px;height:35px;vertical-align:middle;width:70px;transition:all 200ms;}.pdoc table{display:block;width:max-content;max-width:100%;overflow:auto;margin-bottom:1rem;}.pdoc table th{font-weight:600;}.pdoc table th, .pdoc table td{padding:6px 13px;border:1px solid var(--accent2);}</style>
    <style>/*! custom.css */</style></head>
<body>
    <nav class="pdoc">
        <label id="navtoggle" for="togglestate" class="pdoc-button"><svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 30 30'><path stroke-linecap='round' stroke="currentColor" stroke-miterlimit='10' stroke-width='2' d='M4 7h22M4 15h22M4 23h22'/></svg></label>
        <input id="togglestate" type="checkbox" aria-hidden="true" tabindex="-1">
        <div>




            <h2>API Documentation</h2>
                <ul class="memberlist">
            <li>
                    <a class="function" href="#allowed_types">allowed_types</a>
            </li>
            <li>
                    <a class="function" href="#normalize">normalize</a>
            </li>
            <li>
                    <a class="function" href="#transform_to_hu">transform_to_hu</a>
            </li>
            <li>
                    <a class="function" href="#filter_data">filter_data</a>
            </li>
            <li>
                    <a class="function" href="#thresholding">thresholding</a>
            </li>
            <li>
                    <a class="function" href="#median_filter">median_filter</a>
            </li>
            <li>
                    <a class="function" href="#adjust_contrast">adjust_contrast</a>
            </li>
            <li>
                    <a class="function" href="#clear_data">clear_data</a>
            </li>
            <li>
                    <a class="function" href="#zoom_scan">zoom_scan</a>
            </li>
            <li>
                    <a class="function" href="#resize_scan">resize_scan</a>
            </li>
            <li>
                    <a class="function" href="#move_to_center">move_to_center</a>
            </li>
            <li>
                    <a class="function" href="#rotate_to_center">rotate_to_center</a>
            </li>
            <li>
                    <a class="function" href="#uniform_depth">uniform_depth</a>
            </li>
            <li>
                    <a class="function" href="#plot_ct_images">plot_ct_images</a>
            </li>
            <li>
                    <a class="function" href="#load_data">load_data</a>
            </li>
            <li>
                    <a class="function" href="#remove_background">remove_background</a>
            </li>
    </ul>



        <a class="attribution" title="pdoc: Python API documentation generator" href="https://pdoc.dev" target="_blank">
            built with <span class="visually-hidden">pdoc</span><img
                alt="pdoc logo"
                src="data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20role%3D%22img%22%20aria-label%3D%22pdoc%20logo%22%20width%3D%22300%22%20height%3D%22150%22%20viewBox%3D%22-1%200%2060%2030%22%3E%3Ctitle%3Epdoc%3C/title%3E%3Cpath%20d%3D%22M29.621%2021.293c-.011-.273-.214-.475-.511-.481a.5.5%200%200%200-.489.503l-.044%201.393c-.097.551-.695%201.215-1.566%201.704-.577.428-1.306.486-2.193.182-1.426-.617-2.467-1.654-3.304-2.487l-.173-.172a3.43%203.43%200%200%200-.365-.306.49.49%200%200%200-.286-.196c-1.718-1.06-4.931-1.47-7.353.191l-.219.15c-1.707%201.187-3.413%202.131-4.328%201.03-.02-.027-.49-.685-.141-1.763.233-.721.546-2.408.772-4.076.042-.09.067-.187.046-.288.166-1.347.277-2.625.241-3.351%201.378-1.008%202.271-2.586%202.271-4.362%200-.976-.272-1.935-.788-2.774-.057-.094-.122-.18-.184-.268.033-.167.052-.339.052-.516%200-1.477-1.202-2.679-2.679-2.679-.791%200-1.496.352-1.987.9a6.3%206.3%200%200%200-1.001.029c-.492-.564-1.207-.929-2.012-.929-1.477%200-2.679%201.202-2.679%202.679A2.65%202.65%200%200%200%20.97%206.554c-.383.747-.595%201.572-.595%202.41%200%202.311%201.507%204.29%203.635%205.107-.037.699-.147%202.27-.423%203.294l-.137.461c-.622%202.042-2.515%208.257%201.727%2010.643%201.614.908%203.06%201.248%204.317%201.248%202.665%200%204.492-1.524%205.322-2.401%201.476-1.559%202.886-1.854%206.491.82%201.877%201.393%203.514%201.753%204.861%201.068%202.223-1.713%202.811-3.867%203.399-6.374.077-.846.056-1.469.054-1.537zm-4.835%204.313c-.054.305-.156.586-.242.629-.034-.007-.131-.022-.307-.157-.145-.111-.314-.478-.456-.908.221.121.432.25.675.355.115.039.219.051.33.081zm-2.251-1.238c-.05.33-.158.648-.252.694-.022.001-.125-.018-.307-.157-.217-.166-.488-.906-.639-1.573.358.344.754.693%201.198%201.036zm-3.887-2.337c-.006-.116-.018-.231-.041-.342.635.145%201.189.368%201.599.625.097.231.166.481.174.642-.03.049-.055.101-.067.158-.046.013-.128.026-.298.004-.278-.037-.901-.57-1.367-1.087zm-1.127-.497c.116.306.176.625.12.71-.019.014-.117.045-.345.016-.206-.027-.604-.332-.986-.695.41-.051.816-.056%201.211-.031zm-4.535%201.535c.209.22.379.47.358.598-.006.041-.088.138-.351.234-.144.055-.539-.063-.979-.259a11.66%2011.66%200%200%200%20.972-.573zm.983-.664c.359-.237.738-.418%201.126-.554.25.237.479.548.457.694-.006.042-.087.138-.351.235-.174.064-.694-.105-1.232-.375zm-3.381%201.794c-.022.145-.061.29-.149.401-.133.166-.358.248-.69.251h-.002c-.133%200-.306-.26-.45-.621.417.091.854.07%201.291-.031zm-2.066-8.077a4.78%204.78%200%200%201-.775-.584c.172-.115.505-.254.88-.378l-.105.962zm-.331%202.302a10.32%2010.32%200%200%201-.828-.502c.202-.143.576-.328.984-.49l-.156.992zm-.45%202.157l-.701-.403c.214-.115.536-.249.891-.376a11.57%2011.57%200%200%201-.19.779zm-.181%201.716c.064.398.194.702.298.893-.194-.051-.435-.162-.736-.398.061-.119.224-.3.438-.495zM8.87%204.141c0%20.152-.123.276-.276.276s-.275-.124-.275-.276.123-.276.276-.276.275.124.275.276zm-.735-.389a1.15%201.15%200%200%200-.314.783%201.16%201.16%200%200%200%201.162%201.162c.457%200%20.842-.27%201.032-.653.026.117.042.238.042.362a1.68%201.68%200%200%201-1.679%201.679%201.68%201.68%200%200%201-1.679-1.679c0-.843.626-1.535%201.436-1.654zM5.059%205.406A1.68%201.68%200%200%201%203.38%207.085a1.68%201.68%200%200%201-1.679-1.679c0-.037.009-.072.011-.109.21.3.541.508.935.508a1.16%201.16%200%200%200%201.162-1.162%201.14%201.14%200%200%200-.474-.912c.015%200%20.03-.005.045-.005.926.001%201.679.754%201.679%201.68zM3.198%204.141c0%20.152-.123.276-.276.276s-.275-.124-.275-.276.123-.276.276-.276.275.124.275.276zM1.375%208.964c0-.52.103-1.035.288-1.52.466.394%201.06.64%201.717.64%201.144%200%202.116-.725%202.499-1.738.383%201.012%201.355%201.738%202.499%201.738.867%200%201.631-.421%202.121-1.062.307.605.478%201.267.478%201.942%200%202.486-2.153%204.51-4.801%204.51s-4.801-2.023-4.801-4.51zm24.342%2019.349c-.985.498-2.267.168-3.813-.979-3.073-2.281-5.453-3.199-7.813-.705-1.315%201.391-4.163%203.365-8.423.97-3.174-1.786-2.239-6.266-1.261-9.479l.146-.492c.276-1.02.395-2.457.444-3.268a6.11%206.11%200%200%200%201.18.115%206.01%206.01%200%200%200%202.536-.562l-.006.175c-.802.215-1.848.612-2.021%201.25-.079.295.021.601.274.837.219.203.415.364.598.501-.667.304-1.243.698-1.311%201.179-.02.144-.022.507.393.787.213.144.395.26.564.365-1.285.521-1.361.96-1.381%201.126-.018.142-.011.496.427.746l.854.489c-.473.389-.971.914-.999%201.429-.018.278.095.532.316.713.675.556%201.231.721%201.653.721.059%200%20.104-.014.158-.02.207.707.641%201.64%201.513%201.64h.013c.8-.008%201.236-.345%201.462-.626.173-.216.268-.457.325-.692.424.195.93.374%201.372.374.151%200%20.294-.021.423-.068.732-.27.944-.704.993-1.021.009-.061.003-.119.002-.179.266.086.538.147.789.147.15%200%20.294-.021.423-.069.542-.2.797-.489.914-.754.237.147.478.258.704.288.106.014.205.021.296.021.356%200%20.595-.101.767-.229.438.435%201.094.992%201.656%201.067.106.014.205.021.296.021a1.56%201.56%200%200%200%20.323-.035c.17.575.453%201.289.866%201.605.358.273.665.362.914.362a.99.99%200%200%200%20.421-.093%201.03%201.03%200%200%200%20.245-.164c.168.428.39.846.68%201.068.358.273.665.362.913.362a.99.99%200%200%200%20.421-.093c.317-.148.512-.448.639-.762.251.157.495.257.726.257.127%200%20.25-.024.37-.071.427-.17.706-.617.841-1.314.022-.015.047-.022.068-.038.067-.051.133-.104.196-.159-.443%201.486-1.107%202.761-2.086%203.257zM8.66%209.925a.5.5%200%201%200-1%200c0%20.653-.818%201.205-1.787%201.205s-1.787-.552-1.787-1.205a.5.5%200%201%200-1%200c0%201.216%201.25%202.205%202.787%202.205s2.787-.989%202.787-2.205zm4.4%2015.965l-.208.097c-2.661%201.258-4.708%201.436-6.086.527-1.542-1.017-1.88-3.19-1.844-4.198a.4.4%200%200%200-.385-.414c-.242-.029-.406.164-.414.385-.046%201.249.367%203.686%202.202%204.896.708.467%201.547.7%202.51.7%201.248%200%202.706-.392%204.362-1.174l.185-.086a.4.4%200%200%200%20.205-.527c-.089-.204-.326-.291-.527-.206zM9.547%202.292c.093.077.205.114.317.114a.5.5%200%200%200%20.318-.886L8.817.397a.5.5%200%200%200-.703.068.5.5%200%200%200%20.069.703l1.364%201.124zm-7.661-.065c.086%200%20.173-.022.253-.068l1.523-.893a.5.5%200%200%200-.506-.863l-1.523.892a.5.5%200%200%200-.179.685c.094.158.261.247.432.247z%22%20transform%3D%22matrix%28-1%200%200%201%2058%200%29%22%20fill%3D%22%233bb300%22/%3E%3Cpath%20d%3D%22M.3%2021.86V10.18q0-.46.02-.68.04-.22.18-.5.28-.54%201.34-.54%201.06%200%201.42.28.38.26.44.78.76-1.04%202.38-1.04%201.64%200%203.1%201.54%201.46%201.54%201.46%203.58%200%202.04-1.46%203.58-1.44%201.54-3.08%201.54-1.64%200-2.38-.92v4.04q0%20.46-.04.68-.02.22-.18.5-.14.3-.5.42-.36.12-.98.12-.62%200-1-.12-.36-.12-.52-.4-.14-.28-.18-.5-.02-.22-.02-.68zm3.96-9.42q-.46.54-.46%201.18%200%20.64.46%201.18.48.52%201.2.52.74%200%201.24-.52.52-.52.52-1.18%200-.66-.48-1.18-.48-.54-1.26-.54-.76%200-1.22.54zm14.741-8.36q.16-.3.54-.42.38-.12%201-.12.64%200%201.02.12.38.12.52.42.16.3.18.54.04.22.04.68v11.94q0%20.46-.04.7-.02.22-.18.5-.3.54-1.7.54-1.38%200-1.54-.98-.84.96-2.34.96-1.8%200-3.28-1.56-1.48-1.58-1.48-3.66%200-2.1%201.48-3.68%201.5-1.58%203.28-1.58%201.48%200%202.3%201v-4.2q0-.46.02-.68.04-.24.18-.52zm-3.24%2010.86q.52.54%201.26.54.74%200%201.22-.54.5-.54.5-1.18%200-.66-.48-1.22-.46-.56-1.26-.56-.8%200-1.28.56-.48.54-.48%201.2%200%20.66.52%201.2zm7.833-1.2q0-2.4%201.68-3.96%201.68-1.56%203.84-1.56%202.16%200%203.82%201.56%201.66%201.54%201.66%203.94%200%201.66-.86%202.96-.86%201.28-2.1%201.9-1.22.6-2.54.6-1.32%200-2.56-.64-1.24-.66-2.1-1.92-.84-1.28-.84-2.88zm4.18%201.44q.64.48%201.3.48.66%200%201.32-.5.66-.5.66-1.48%200-.98-.62-1.46-.62-.48-1.34-.48-.72%200-1.34.5-.62.5-.62%201.48%200%20.96.64%201.46zm11.412-1.44q0%20.84.56%201.32.56.46%201.18.46.64%200%201.18-.36.56-.38.9-.38.6%200%201.46%201.06.46.58.46%201.04%200%20.76-1.1%201.42-1.14.8-2.8.8-1.86%200-3.58-1.34-.82-.64-1.34-1.7-.52-1.08-.52-2.36%200-1.3.52-2.34.52-1.06%201.34-1.7%201.66-1.32%203.54-1.32.76%200%201.48.22.72.2%201.06.4l.32.2q.36.24.56.38.52.4.52.92%200%20.5-.42%201.14-.72%201.1-1.38%201.1-.38%200-1.08-.44-.36-.34-1.04-.34-.66%200-1.24.48-.58.48-.58%201.34z%22%20fill%3D%22green%22/%3E%3C/svg%3E"/>
        </a>
</div>
    </nav>
    <main class="pdoc">
            <section class="module-info">
                    <h1 class="modulename">
dicomProcessing_helpingFunctions    </h1>

                
                        <input id="mod-dicomProcessing_helpingFunctions-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">

                        <label class="view-source-button" for="mod-dicomProcessing_helpingFunctions-view-source"><span>View Source</span></label>

                        <div class="pdoc-code codehilite"><pre><span></span><span id="L-1"><a href="#L-1"><span class="linenos">  1</span></a><span class="kn">import</span> <span class="nn">os</span>
</span><span id="L-2"><a href="#L-2"><span class="linenos">  2</span></a><span class="kn">import</span> <span class="nn">pydicom</span> <span class="k">as</span> <span class="nn">pdcm</span>
</span><span id="L-3"><a href="#L-3"><span class="linenos">  3</span></a><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
</span><span id="L-4"><a href="#L-4"><span class="linenos">  4</span></a><span class="kn">import</span> <span class="nn">scipy</span> <span class="k">as</span> <span class="nn">sp</span>
</span><span id="L-5"><a href="#L-5"><span class="linenos">  5</span></a><span class="kn">import</span> <span class="nn">skimage</span>
</span><span id="L-6"><a href="#L-6"><span class="linenos">  6</span></a><span class="kn">import</span> <span class="nn">cv2</span>
</span><span id="L-7"><a href="#L-7"><span class="linenos">  7</span></a>
</span><span id="L-8"><a href="#L-8"><span class="linenos">  8</span></a><span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
</span><span id="L-9"><a href="#L-9"><span class="linenos">  9</span></a><span class="kn">import</span> <span class="nn">matplotlib</span>
</span><span id="L-10"><a href="#L-10"><span class="linenos"> 10</span></a>
</span><span id="L-11"><a href="#L-11"><span class="linenos"> 11</span></a><span class="n">matplotlib</span><span class="o">.</span><span class="n">use</span><span class="p">(</span><span class="s1">&#39;TkAgg&#39;</span><span class="p">)</span>
</span><span id="L-12"><a href="#L-12"><span class="linenos"> 12</span></a>
</span><span id="L-13"><a href="#L-13"><span class="linenos"> 13</span></a><span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">Any</span>
</span><span id="L-14"><a href="#L-14"><span class="linenos"> 14</span></a>
</span><span id="L-15"><a href="#L-15"><span class="linenos"> 15</span></a>
</span><span id="L-16"><a href="#L-16"><span class="linenos"> 16</span></a><span class="k">def</span> <span class="nf">allowed_types</span><span class="p">():</span>
</span><span id="L-17"><a href="#L-17"><span class="linenos"> 17</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-18"><a href="#L-18"><span class="linenos"> 18</span></a><span class="sd">    Function returns list of allowed CT scan series descriptions</span>
</span><span id="L-19"><a href="#L-19"><span class="linenos"> 19</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="L-20"><a href="#L-20"><span class="linenos"> 20</span></a>    <span class="k">return</span> <span class="p">[</span><span class="s1">&#39;Head  3.0  MPR&#39;</span><span class="p">]</span>
</span><span id="L-21"><a href="#L-21"><span class="linenos"> 21</span></a>
</span><span id="L-22"><a href="#L-22"><span class="linenos"> 22</span></a>
</span><span id="L-23"><a href="#L-23"><span class="linenos"> 23</span></a><span class="k">def</span> <span class="nf">normalize</span><span class="p">(</span><span class="n">data</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">):</span>
</span><span id="L-24"><a href="#L-24"><span class="linenos"> 24</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-25"><a href="#L-25"><span class="linenos"> 25</span></a><span class="sd">    Function normalizes given data to min-max scale</span>
</span><span id="L-26"><a href="#L-26"><span class="linenos"> 26</span></a><span class="sd">    </span>
</span><span id="L-27"><a href="#L-27"><span class="linenos"> 27</span></a><span class="sd">    :param data: Numpy array data</span>
</span><span id="L-28"><a href="#L-28"><span class="linenos"> 28</span></a><span class="sd">    :return: 0-k scaled numpy array data</span>
</span><span id="L-29"><a href="#L-29"><span class="linenos"> 29</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="L-30"><a href="#L-30"><span class="linenos"> 30</span></a>    <span class="k">return</span> <span class="p">(</span><span class="n">data</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">data</span><span class="p">))</span> <span class="o">/</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">data</span><span class="p">)</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">data</span><span class="p">))</span>
</span><span id="L-31"><a href="#L-31"><span class="linenos"> 31</span></a>
</span><span id="L-32"><a href="#L-32"><span class="linenos"> 32</span></a>
</span><span id="L-33"><a href="#L-33"><span class="linenos"> 33</span></a><span class="k">def</span> <span class="nf">transform_to_hu</span><span class="p">(</span><span class="n">dicom_data</span><span class="p">:</span> <span class="n">pdcm</span><span class="o">.</span><span class="n">dataset</span><span class="o">.</span><span class="n">FileDataset</span><span class="p">,</span>
</span><span id="L-34"><a href="#L-34"><span class="linenos"> 34</span></a>                    <span class="n">slope</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="L-35"><a href="#L-35"><span class="linenos"> 35</span></a>                    <span class="n">intercept</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
</span><span id="L-36"><a href="#L-36"><span class="linenos"> 36</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-37"><a href="#L-37"><span class="linenos"> 37</span></a><span class="sd">    Function transforms DICOM data (Digital Imaging and Communication in Medicine)</span>
</span><span id="L-38"><a href="#L-38"><span class="linenos"> 38</span></a><span class="sd">    format to Hounsfield Unit (HU) given relationship</span>
</span><span id="L-39"><a href="#L-39"><span class="linenos"> 39</span></a><span class="sd">    data_HU = data*slope + intercept</span>
</span><span id="L-40"><a href="#L-40"><span class="linenos"> 40</span></a>
</span><span id="L-41"><a href="#L-41"><span class="linenos"> 41</span></a><span class="sd">    :param dicom_data: Data in DICOM format</span>
</span><span id="L-42"><a href="#L-42"><span class="linenos"> 42</span></a><span class="sd">    :param slope: Slope value</span>
</span><span id="L-43"><a href="#L-43"><span class="linenos"> 43</span></a><span class="sd">    :param intercept: Intercept value</span>
</span><span id="L-44"><a href="#L-44"><span class="linenos"> 44</span></a><span class="sd">    :return: pixel array in HU</span>
</span><span id="L-45"><a href="#L-45"><span class="linenos"> 45</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="L-46"><a href="#L-46"><span class="linenos"> 46</span></a>    <span class="k">if</span> <span class="n">slope</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-47"><a href="#L-47"><span class="linenos"> 47</span></a>        <span class="n">slope</span> <span class="o">=</span> <span class="n">dicom_data</span><span class="o">.</span><span class="n">RescaleSlope</span>
</span><span id="L-48"><a href="#L-48"><span class="linenos"> 48</span></a>
</span><span id="L-49"><a href="#L-49"><span class="linenos"> 49</span></a>    <span class="k">if</span> <span class="n">intercept</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-50"><a href="#L-50"><span class="linenos"> 50</span></a>        <span class="n">intercept</span> <span class="o">=</span> <span class="n">dicom_data</span><span class="o">.</span><span class="n">RescaleIntercept</span>
</span><span id="L-51"><a href="#L-51"><span class="linenos"> 51</span></a>
</span><span id="L-52"><a href="#L-52"><span class="linenos"> 52</span></a>    <span class="k">return</span> <span class="n">dicom_data</span><span class="o">.</span><span class="n">pixel_array</span> <span class="o">*</span> <span class="n">slope</span> <span class="o">+</span> <span class="n">intercept</span>
</span><span id="L-53"><a href="#L-53"><span class="linenos"> 53</span></a>
</span><span id="L-54"><a href="#L-54"><span class="linenos"> 54</span></a>
</span><span id="L-55"><a href="#L-55"><span class="linenos"> 55</span></a><span class="k">def</span> <span class="nf">filter_data</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">show_diff</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
</span><span id="L-56"><a href="#L-56"><span class="linenos"> 56</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-57"><a href="#L-57"><span class="linenos"> 57</span></a><span class="sd">    Function sets every pixel value beyond given threshold to 0 (default backgrond value)</span>
</span><span id="L-58"><a href="#L-58"><span class="linenos"> 58</span></a><span class="sd">    Thresholds are listed below in the table</span>
</span><span id="L-59"><a href="#L-59"><span class="linenos"> 59</span></a><span class="sd">    Afterwards using erosion and dilation redundant parts are removed (such as ears e.g.)</span>
</span><span id="L-60"><a href="#L-60"><span class="linenos"> 60</span></a>
</span><span id="L-61"><a href="#L-61"><span class="linenos"> 61</span></a><span class="sd">    Table values are based on data normalization</span>
</span><span id="L-62"><a href="#L-62"><span class="linenos"> 62</span></a>
</span><span id="L-63"><a href="#L-63"><span class="linenos"> 63</span></a><span class="sd">    |----------------------|-----------------------|</span>
</span><span id="L-64"><a href="#L-64"><span class="linenos"> 64</span></a>
</span><span id="L-65"><a href="#L-65"><span class="linenos"> 65</span></a><span class="sd">    | Bone     80  (Max)   | Brain   +-50          |</span>
</span><span id="L-66"><a href="#L-66"><span class="linenos"> 66</span></a><span class="sd">    | Vacuum   0   (Min)   |                       |</span>
</span><span id="L-67"><a href="#L-67"><span class="linenos"> 67</span></a><span class="sd">    | Water    18          |                       |</span>
</span><span id="L-68"><a href="#L-68"><span class="linenos"> 68</span></a>
</span><span id="L-69"><a href="#L-69"><span class="linenos"> 69</span></a><span class="sd">    |----------------------|-----------------------|</span>
</span><span id="L-70"><a href="#L-70"><span class="linenos"> 70</span></a>
</span><span id="L-71"><a href="#L-71"><span class="linenos"> 71</span></a><span class="sd">    :param data: CT scan data array in HU</span>
</span><span id="L-72"><a href="#L-72"><span class="linenos"> 72</span></a><span class="sd">    :param threshold: Threshold beyond to filter out</span>
</span><span id="L-73"><a href="#L-73"><span class="linenos"> 73</span></a><span class="sd">    :param show_diff: True/False (debug parameter) - if true result is shown</span>
</span><span id="L-74"><a href="#L-74"><span class="linenos"> 74</span></a><span class="sd">    :return: Filtered out data</span>
</span><span id="L-75"><a href="#L-75"><span class="linenos"> 75</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="L-76"><a href="#L-76"><span class="linenos"> 76</span></a>    <span class="n">filter_values</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;bone&#39;</span><span class="p">:</span> <span class="mi">80</span><span class="p">,</span> <span class="s1">&#39;vacuum&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;water&#39;</span><span class="p">:</span> <span class="mi">18</span><span class="p">,</span> <span class="s1">&#39;brain&#39;</span><span class="p">:</span> <span class="mi">50</span><span class="p">}</span>
</span><span id="L-77"><a href="#L-77"><span class="linenos"> 77</span></a>    <span class="n">org_scan</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</span><span id="L-78"><a href="#L-78"><span class="linenos"> 78</span></a>    <span class="n">data</span><span class="p">[</span><span class="n">data</span> <span class="o">&gt;=</span> <span class="n">filter_values</span><span class="p">[</span><span class="s1">&#39;bone&#39;</span><span class="p">]]</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="L-79"><a href="#L-79"><span class="linenos"> 79</span></a>    <span class="n">data</span><span class="p">[</span><span class="n">data</span> <span class="o">&lt;=</span> <span class="n">filter_values</span><span class="p">[</span><span class="s1">&#39;water&#39;</span><span class="p">]]</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="L-80"><a href="#L-80"><span class="linenos"> 80</span></a>
</span><span id="L-81"><a href="#L-81"><span class="linenos"> 81</span></a>    <span class="n">labels</span><span class="p">,</span> <span class="n">label_nb</span> <span class="o">=</span> <span class="n">sp</span><span class="o">.</span><span class="n">ndimage</span><span class="o">.</span><span class="n">label</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
</span><span id="L-82"><a href="#L-82"><span class="linenos"> 82</span></a>    <span class="n">label_count</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">bincount</span><span class="p">(</span><span class="n">labels</span><span class="o">.</span><span class="n">ravel</span><span class="p">()</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">))</span>
</span><span id="L-83"><a href="#L-83"><span class="linenos"> 83</span></a>    <span class="n">label_count</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="L-84"><a href="#L-84"><span class="linenos"> 84</span></a>
</span><span id="L-85"><a href="#L-85"><span class="linenos"> 85</span></a>    <span class="n">mask</span> <span class="o">=</span> <span class="n">labels</span> <span class="o">==</span> <span class="n">label_count</span><span class="o">.</span><span class="n">argmax</span><span class="p">()</span>
</span><span id="L-86"><a href="#L-86"><span class="linenos"> 86</span></a>
</span><span id="L-87"><a href="#L-87"><span class="linenos"> 87</span></a>    <span class="c1"># mask = skimage.morphology.erosion(mask, np.ones((3, 3)))</span>
</span><span id="L-88"><a href="#L-88"><span class="linenos"> 88</span></a>    <span class="n">mask</span> <span class="o">=</span> <span class="n">skimage</span><span class="o">.</span><span class="n">morphology</span><span class="o">.</span><span class="n">erosion</span><span class="p">(</span><span class="n">mask</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">((</span><span class="mi">4</span><span class="p">,</span> <span class="mi">4</span><span class="p">)))</span>
</span><span id="L-89"><a href="#L-89"><span class="linenos"> 89</span></a>
</span><span id="L-90"><a href="#L-90"><span class="linenos"> 90</span></a>    <span class="c1"># @TODO - dilataciu mozno prec</span>
</span><span id="L-91"><a href="#L-91"><span class="linenos"> 91</span></a>    <span class="n">mask</span> <span class="o">=</span> <span class="n">skimage</span><span class="o">.</span><span class="n">morphology</span><span class="o">.</span><span class="n">dilation</span><span class="p">(</span><span class="n">mask</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">((</span><span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">)))</span>
</span><span id="L-92"><a href="#L-92"><span class="linenos"> 92</span></a>
</span><span id="L-93"><a href="#L-93"><span class="linenos"> 93</span></a>    <span class="n">res</span> <span class="o">=</span> <span class="n">mask</span> <span class="o">*</span> <span class="n">data</span>
</span><span id="L-94"><a href="#L-94"><span class="linenos"> 94</span></a>
</span><span id="L-95"><a href="#L-95"><span class="linenos"> 95</span></a>    <span class="k">if</span> <span class="n">show_diff</span><span class="p">:</span>
</span><span id="L-96"><a href="#L-96"><span class="linenos"> 96</span></a>        <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">[</span><span class="mi">8</span><span class="p">,</span> <span class="mi">8</span><span class="p">])</span>
</span><span id="L-97"><a href="#L-97"><span class="linenos"> 97</span></a>        <span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Original scan&#39;</span><span class="p">)</span>
</span><span id="L-98"><a href="#L-98"><span class="linenos"> 98</span></a>        <span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">org_scan</span><span class="p">,</span> <span class="n">aspect</span><span class="o">=</span><span class="s1">&#39;auto&#39;</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">cm</span><span class="o">.</span><span class="n">bone</span><span class="p">)</span>
</span><span id="L-99"><a href="#L-99"><span class="linenos"> 99</span></a>
</span><span id="L-100"><a href="#L-100"><span class="linenos">100</span></a>        <span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Filtered out scan&#39;</span><span class="p">)</span>
</span><span id="L-101"><a href="#L-101"><span class="linenos">101</span></a>        <span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">res</span><span class="p">,</span> <span class="n">aspect</span><span class="o">=</span><span class="s1">&#39;auto&#39;</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">cm</span><span class="o">.</span><span class="n">bone</span><span class="p">)</span>
</span><span id="L-102"><a href="#L-102"><span class="linenos">102</span></a>        <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="n">block</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="L-103"><a href="#L-103"><span class="linenos">103</span></a>
</span><span id="L-104"><a href="#L-104"><span class="linenos">104</span></a>    <span class="k">return</span> <span class="n">res</span>
</span><span id="L-105"><a href="#L-105"><span class="linenos">105</span></a>
</span><span id="L-106"><a href="#L-106"><span class="linenos">106</span></a>
</span><span id="L-107"><a href="#L-107"><span class="linenos">107</span></a><span class="k">def</span> <span class="nf">thresholding</span><span class="p">(</span><span class="n">data</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span>
</span><span id="L-108"><a href="#L-108"><span class="linenos">108</span></a>                 <span class="n">show_diff</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="L-109"><a href="#L-109"><span class="linenos">109</span></a>                 <span class="n">save</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">):</span>
</span><span id="L-110"><a href="#L-110"><span class="linenos">110</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-111"><a href="#L-111"><span class="linenos">111</span></a><span class="sd">    Function does thresholding of the CT image to remove very bright pixels;</span>
</span><span id="L-112"><a href="#L-112"><span class="linenos">112</span></a><span class="sd">    pixels &gt; 100 (bone) to 100 and all</span>
</span><span id="L-113"><a href="#L-113"><span class="linenos">113</span></a><span class="sd">    pixels &lt; 0 (background) to value 0</span>
</span><span id="L-114"><a href="#L-114"><span class="linenos">114</span></a><span class="sd">    (original scan max value is approx. 1000 and min value -1000)</span>
</span><span id="L-115"><a href="#L-115"><span class="linenos">115</span></a>
</span><span id="L-116"><a href="#L-116"><span class="linenos">116</span></a><span class="sd">    Afterwards all pixels are divided by 100 - this can be considered as a data normalization</span>
</span><span id="L-117"><a href="#L-117"><span class="linenos">117</span></a><span class="sd">    </span>
</span><span id="L-118"><a href="#L-118"><span class="linenos">118</span></a><span class="sd">    :param data: CT scan data array in HU</span>
</span><span id="L-119"><a href="#L-119"><span class="linenos">119</span></a><span class="sd">    :param show_diff: True/False (debug parameter) - if true result is shown</span>
</span><span id="L-120"><a href="#L-120"><span class="linenos">120</span></a><span class="sd">    :param save: True/False - if true result scan is saved </span>
</span><span id="L-121"><a href="#L-121"><span class="linenos">121</span></a><span class="sd">    :return: threshold data in range (0-1)</span>
</span><span id="L-122"><a href="#L-122"><span class="linenos">122</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="L-123"><a href="#L-123"><span class="linenos">123</span></a>    <span class="n">org_scan</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</span><span id="L-124"><a href="#L-124"><span class="linenos">124</span></a>
</span><span id="L-125"><a href="#L-125"><span class="linenos">125</span></a>    <span class="c1"># Set pixel values range from 0 to 100</span>
</span><span id="L-126"><a href="#L-126"><span class="linenos">126</span></a>    <span class="n">data</span><span class="p">[</span><span class="n">data</span> <span class="o">&gt;</span> <span class="mi">100</span><span class="p">]</span> <span class="o">=</span> <span class="mi">100</span>
</span><span id="L-127"><a href="#L-127"><span class="linenos">127</span></a>    <span class="n">data</span><span class="p">[</span><span class="n">data</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="L-128"><a href="#L-128"><span class="linenos">128</span></a>
</span><span id="L-129"><a href="#L-129"><span class="linenos">129</span></a>    <span class="n">data</span> <span class="o">=</span> <span class="n">data</span> <span class="o">/</span> <span class="mi">100</span>
</span><span id="L-130"><a href="#L-130"><span class="linenos">130</span></a>
</span><span id="L-131"><a href="#L-131"><span class="linenos">131</span></a>    <span class="k">if</span> <span class="n">save</span><span class="p">:</span>
</span><span id="L-132"><a href="#L-132"><span class="linenos">132</span></a>        <span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
</span><span id="L-133"><a href="#L-133"><span class="linenos">133</span></a>
</span><span id="L-134"><a href="#L-134"><span class="linenos">134</span></a>        <span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">aspect</span><span class="o">=</span><span class="s1">&#39;auto&#39;</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">cm</span><span class="o">.</span><span class="n">bone</span><span class="p">)</span>
</span><span id="L-135"><a href="#L-135"><span class="linenos">135</span></a>        <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;threshold scan&#39;</span><span class="p">)</span>
</span><span id="L-136"><a href="#L-136"><span class="linenos">136</span></a>
</span><span id="L-137"><a href="#L-137"><span class="linenos">137</span></a>        <span class="c1"># plt.show(block=True)</span>
</span><span id="L-138"><a href="#L-138"><span class="linenos">138</span></a>        <span class="n">i</span> <span class="o">=</span> <span class="mi">1</span>
</span><span id="L-139"><a href="#L-139"><span class="linenos">139</span></a>        <span class="k">while</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="s2">&quot;threshold_</span><span class="si">%d</span><span class="s2">.png&quot;</span> <span class="o">%</span> <span class="n">i</span><span class="p">):</span>
</span><span id="L-140"><a href="#L-140"><span class="linenos">140</span></a>            <span class="n">i</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="L-141"><a href="#L-141"><span class="linenos">141</span></a>        <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;./images/thresholding/threshold_</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s1">.png&#39;</span><span class="p">)</span>
</span><span id="L-142"><a href="#L-142"><span class="linenos">142</span></a>
</span><span id="L-143"><a href="#L-143"><span class="linenos">143</span></a>    <span class="k">if</span> <span class="n">show_diff</span><span class="p">:</span>
</span><span id="L-144"><a href="#L-144"><span class="linenos">144</span></a>        <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">[</span><span class="mi">8</span><span class="p">,</span> <span class="mi">8</span><span class="p">])</span>
</span><span id="L-145"><a href="#L-145"><span class="linenos">145</span></a>        <span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Before threshold scan&#39;</span><span class="p">)</span>
</span><span id="L-146"><a href="#L-146"><span class="linenos">146</span></a>        <span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">org_scan</span><span class="p">,</span> <span class="n">aspect</span><span class="o">=</span><span class="s1">&#39;auto&#39;</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">cm</span><span class="o">.</span><span class="n">bone</span><span class="p">)</span>
</span><span id="L-147"><a href="#L-147"><span class="linenos">147</span></a>
</span><span id="L-148"><a href="#L-148"><span class="linenos">148</span></a>        <span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;After threshold scan&#39;</span><span class="p">)</span>
</span><span id="L-149"><a href="#L-149"><span class="linenos">149</span></a>        <span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">aspect</span><span class="o">=</span><span class="s1">&#39;auto&#39;</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">cm</span><span class="o">.</span><span class="n">bone</span><span class="p">)</span>
</span><span id="L-150"><a href="#L-150"><span class="linenos">150</span></a>
</span><span id="L-151"><a href="#L-151"><span class="linenos">151</span></a>        <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="n">block</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="L-152"><a href="#L-152"><span class="linenos">152</span></a>    <span class="k">return</span> <span class="n">data</span>
</span><span id="L-153"><a href="#L-153"><span class="linenos">153</span></a>
</span><span id="L-154"><a href="#L-154"><span class="linenos">154</span></a>
</span><span id="L-155"><a href="#L-155"><span class="linenos">155</span></a><span class="k">def</span> <span class="nf">median_filter</span><span class="p">(</span><span class="n">data</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span>
</span><span id="L-156"><a href="#L-156"><span class="linenos">156</span></a>                  <span class="n">mat</span><span class="p">:</span> <span class="nb">tuple</span> <span class="o">=</span> <span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">),</span>
</span><span id="L-157"><a href="#L-157"><span class="linenos">157</span></a>                  <span class="n">show_diff</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="L-158"><a href="#L-158"><span class="linenos">158</span></a>                  <span class="n">save</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">):</span>
</span><span id="L-159"><a href="#L-159"><span class="linenos">159</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-160"><a href="#L-160"><span class="linenos">160</span></a><span class="sd">    Function uses median filter to remove noise from an image (CT scan array)</span>
</span><span id="L-161"><a href="#L-161"><span class="linenos">161</span></a><span class="sd">    The median filter replaces each pixel&#39;s value with the median value of the neighboring pixels.</span>
</span><span id="L-162"><a href="#L-162"><span class="linenos">162</span></a><span class="sd">    It&#39;s effective in removing salt-and-pepper noise (randomly occurring bright or dark pixels)</span>
</span><span id="L-163"><a href="#L-163"><span class="linenos">163</span></a><span class="sd">    which occurs in electronic detectors.</span>
</span><span id="L-164"><a href="#L-164"><span class="linenos">164</span></a>
</span><span id="L-165"><a href="#L-165"><span class="linenos">165</span></a><span class="sd">    :param data: CT scan data array in HU</span>
</span><span id="L-166"><a href="#L-166"><span class="linenos">166</span></a><span class="sd">    :param mat: Filtering matrix</span>
</span><span id="L-167"><a href="#L-167"><span class="linenos">167</span></a><span class="sd">    :param show_diff: Boolean (debug parameter) - if true result is shown</span>
</span><span id="L-168"><a href="#L-168"><span class="linenos">168</span></a><span class="sd">    :param save: Boolean - if true result scan is saved</span>
</span><span id="L-169"><a href="#L-169"><span class="linenos">169</span></a><span class="sd">    :return: clean (without noise) data</span>
</span><span id="L-170"><a href="#L-170"><span class="linenos">170</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="L-171"><a href="#L-171"><span class="linenos">171</span></a>    <span class="n">org_scan</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</span><span id="L-172"><a href="#L-172"><span class="linenos">172</span></a>    <span class="n">structuring_element</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">mat</span><span class="p">)</span>
</span><span id="L-173"><a href="#L-173"><span class="linenos">173</span></a>    <span class="n">data</span> <span class="o">=</span> <span class="n">skimage</span><span class="o">.</span><span class="n">filters</span><span class="o">.</span><span class="n">median</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">structuring_element</span><span class="p">)</span>
</span><span id="L-174"><a href="#L-174"><span class="linenos">174</span></a>    <span class="k">if</span> <span class="n">save</span><span class="p">:</span>
</span><span id="L-175"><a href="#L-175"><span class="linenos">175</span></a>        <span class="n">morph_type</span> <span class="o">=</span> <span class="s1">&#39;median_filter&#39;</span>
</span><span id="L-176"><a href="#L-176"><span class="linenos">176</span></a>        <span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
</span><span id="L-177"><a href="#L-177"><span class="linenos">177</span></a>        <span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">aspect</span><span class="o">=</span><span class="s1">&#39;auto&#39;</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">cm</span><span class="o">.</span><span class="n">bone</span><span class="p">)</span>
</span><span id="L-178"><a href="#L-178"><span class="linenos">178</span></a>        <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">morph_type</span><span class="si">}</span><span class="s1"> mat=</span><span class="si">{</span><span class="n">mat</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
</span><span id="L-179"><a href="#L-179"><span class="linenos">179</span></a>
</span><span id="L-180"><a href="#L-180"><span class="linenos">180</span></a>        <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;./images/</span><span class="si">{</span><span class="n">morph_type</span><span class="si">}</span><span class="s1">/</span><span class="si">{</span><span class="n">morph_type</span><span class="si">}</span><span class="s1">_mat</span><span class="si">{</span><span class="n">mat</span><span class="si">}</span><span class="s1">.png&#39;</span><span class="p">)</span>
</span><span id="L-181"><a href="#L-181"><span class="linenos">181</span></a>
</span><span id="L-182"><a href="#L-182"><span class="linenos">182</span></a>    <span class="k">if</span> <span class="n">show_diff</span><span class="p">:</span>
</span><span id="L-183"><a href="#L-183"><span class="linenos">183</span></a>        <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">[</span><span class="mi">8</span><span class="p">,</span> <span class="mi">8</span><span class="p">])</span>
</span><span id="L-184"><a href="#L-184"><span class="linenos">184</span></a>        <span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Before median filter scan&#39;</span><span class="p">)</span>
</span><span id="L-185"><a href="#L-185"><span class="linenos">185</span></a>        <span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">org_scan</span><span class="p">,</span> <span class="n">aspect</span><span class="o">=</span><span class="s1">&#39;auto&#39;</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">cm</span><span class="o">.</span><span class="n">bone</span><span class="p">)</span>
</span><span id="L-186"><a href="#L-186"><span class="linenos">186</span></a>
</span><span id="L-187"><a href="#L-187"><span class="linenos">187</span></a>        <span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;After median filter scan&#39;</span><span class="p">)</span>
</span><span id="L-188"><a href="#L-188"><span class="linenos">188</span></a>        <span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">aspect</span><span class="o">=</span><span class="s1">&#39;auto&#39;</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">cm</span><span class="o">.</span><span class="n">bone</span><span class="p">)</span>
</span><span id="L-189"><a href="#L-189"><span class="linenos">189</span></a>
</span><span id="L-190"><a href="#L-190"><span class="linenos">190</span></a>        <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="n">block</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="L-191"><a href="#L-191"><span class="linenos">191</span></a>    <span class="k">return</span> <span class="n">data</span>
</span><span id="L-192"><a href="#L-192"><span class="linenos">192</span></a>
</span><span id="L-193"><a href="#L-193"><span class="linenos">193</span></a>
</span><span id="L-194"><a href="#L-194"><span class="linenos">194</span></a><span class="k">def</span> <span class="nf">adjust_contrast</span><span class="p">(</span><span class="n">data</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span>
</span><span id="L-195"><a href="#L-195"><span class="linenos">195</span></a>                    <span class="n">show_diff</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="L-196"><a href="#L-196"><span class="linenos">196</span></a>                    <span class="n">save</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">):</span>
</span><span id="L-197"><a href="#L-197"><span class="linenos">197</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-198"><a href="#L-198"><span class="linenos">198</span></a>
</span><span id="L-199"><a href="#L-199"><span class="linenos">199</span></a><span class="sd">    :param data: CT scan data array in HU</span>
</span><span id="L-200"><a href="#L-200"><span class="linenos">200</span></a><span class="sd">    :param show_diff: Boolean (debug parameter) - if true result is shown</span>
</span><span id="L-201"><a href="#L-201"><span class="linenos">201</span></a><span class="sd">    :param save: Boolean - if true result scan is saved</span>
</span><span id="L-202"><a href="#L-202"><span class="linenos">202</span></a><span class="sd">    :return: Image after histogram equalization</span>
</span><span id="L-203"><a href="#L-203"><span class="linenos">203</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="L-204"><a href="#L-204"><span class="linenos">204</span></a>    <span class="n">org_scan</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</span><span id="L-205"><a href="#L-205"><span class="linenos">205</span></a>
</span><span id="L-206"><a href="#L-206"><span class="linenos">206</span></a>    <span class="n">low</span><span class="p">,</span> <span class="n">high</span> <span class="o">=</span> <span class="mf">0.15</span><span class="p">,</span> <span class="mf">0.75</span>
</span><span id="L-207"><a href="#L-207"><span class="linenos">207</span></a>    <span class="n">data</span> <span class="o">=</span> <span class="n">skimage</span><span class="o">.</span><span class="n">exposure</span><span class="o">.</span><span class="n">rescale_intensity</span><span class="p">(</span><span class="n">org_scan</span><span class="p">,</span> <span class="n">in_range</span><span class="o">=</span><span class="p">(</span><span class="n">low</span><span class="p">,</span> <span class="n">high</span><span class="p">))</span>
</span><span id="L-208"><a href="#L-208"><span class="linenos">208</span></a>
</span><span id="L-209"><a href="#L-209"><span class="linenos">209</span></a>    <span class="k">if</span> <span class="n">save</span><span class="p">:</span>
</span><span id="L-210"><a href="#L-210"><span class="linenos">210</span></a>        <span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
</span><span id="L-211"><a href="#L-211"><span class="linenos">211</span></a>        <span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">aspect</span><span class="o">=</span><span class="s1">&#39;auto&#39;</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">cm</span><span class="o">.</span><span class="n">bone</span><span class="p">)</span>
</span><span id="L-212"><a href="#L-212"><span class="linenos">212</span></a>        <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Contrast adjustment&#39;</span><span class="p">)</span>
</span><span id="L-213"><a href="#L-213"><span class="linenos">213</span></a>
</span><span id="L-214"><a href="#L-214"><span class="linenos">214</span></a>        <span class="n">i</span> <span class="o">=</span> <span class="mi">1</span>
</span><span id="L-215"><a href="#L-215"><span class="linenos">215</span></a>        <span class="k">while</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="s2">&quot;threshold_</span><span class="si">%d</span><span class="s2">.png&quot;</span> <span class="o">%</span> <span class="n">i</span><span class="p">):</span>
</span><span id="L-216"><a href="#L-216"><span class="linenos">216</span></a>            <span class="n">i</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="L-217"><a href="#L-217"><span class="linenos">217</span></a>        <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;./images/contrast/contrast_</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s1">.png&#39;</span><span class="p">)</span>
</span><span id="L-218"><a href="#L-218"><span class="linenos">218</span></a>
</span><span id="L-219"><a href="#L-219"><span class="linenos">219</span></a>    <span class="k">if</span> <span class="n">show_diff</span><span class="p">:</span>
</span><span id="L-220"><a href="#L-220"><span class="linenos">220</span></a>        <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">[</span><span class="mi">8</span><span class="p">,</span> <span class="mi">8</span><span class="p">])</span>
</span><span id="L-221"><a href="#L-221"><span class="linenos">221</span></a>        <span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Before contrast adjustment scan&#39;</span><span class="p">)</span>
</span><span id="L-222"><a href="#L-222"><span class="linenos">222</span></a>        <span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">org_scan</span><span class="p">,</span> <span class="n">aspect</span><span class="o">=</span><span class="s1">&#39;auto&#39;</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">cm</span><span class="o">.</span><span class="n">bone</span><span class="p">)</span>
</span><span id="L-223"><a href="#L-223"><span class="linenos">223</span></a>
</span><span id="L-224"><a href="#L-224"><span class="linenos">224</span></a>        <span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;After contrast adjustment scan&#39;</span><span class="p">)</span>
</span><span id="L-225"><a href="#L-225"><span class="linenos">225</span></a>        <span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">aspect</span><span class="o">=</span><span class="s1">&#39;auto&#39;</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">cm</span><span class="o">.</span><span class="n">bone</span><span class="p">)</span>
</span><span id="L-226"><a href="#L-226"><span class="linenos">226</span></a>
</span><span id="L-227"><a href="#L-227"><span class="linenos">227</span></a>        <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="n">block</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="L-228"><a href="#L-228"><span class="linenos">228</span></a>    <span class="k">return</span> <span class="n">data</span>
</span><span id="L-229"><a href="#L-229"><span class="linenos">229</span></a>
</span><span id="L-230"><a href="#L-230"><span class="linenos">230</span></a>
</span><span id="L-231"><a href="#L-231"><span class="linenos">231</span></a><span class="k">def</span> <span class="nf">clear_data</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">dil_mat</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">10</span><span class="p">),</span> <span class="n">show_diff</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">save</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
</span><span id="L-232"><a href="#L-232"><span class="linenos">232</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-233"><a href="#L-233"><span class="linenos">233</span></a><span class="sd">    Function filters out noise in scan, it sets all</span>
</span><span id="L-234"><a href="#L-234"><span class="linenos">234</span></a><span class="sd">    pixels &gt; 100 (bone) to 100 and all</span>
</span><span id="L-235"><a href="#L-235"><span class="linenos">235</span></a><span class="sd">    pixels &lt; 0 (background) to value 0</span>
</span><span id="L-236"><a href="#L-236"><span class="linenos">236</span></a><span class="sd">    (original scan max value is approx. 1000 and min value -1000)</span>
</span><span id="L-237"><a href="#L-237"><span class="linenos">237</span></a><span class="sd">    </span>
</span><span id="L-238"><a href="#L-238"><span class="linenos">238</span></a><span class="sd">    :param data: CT scan data array in HU</span>
</span><span id="L-239"><a href="#L-239"><span class="linenos">239</span></a><span class="sd">    :param dil_mat: Dilation matrix of shape (N x N)</span>
</span><span id="L-240"><a href="#L-240"><span class="linenos">240</span></a><span class="sd">    :param show_diff: True/False (debug parameter) - if true result is shown</span>
</span><span id="L-241"><a href="#L-241"><span class="linenos">241</span></a><span class="sd">    :param save: True/False - if true result scan is saved </span>
</span><span id="L-242"><a href="#L-242"><span class="linenos">242</span></a><span class="sd">    :return: clean (without noise) data</span>
</span><span id="L-243"><a href="#L-243"><span class="linenos">243</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="L-244"><a href="#L-244"><span class="linenos">244</span></a>    <span class="n">org_scan</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</span><span id="L-245"><a href="#L-245"><span class="linenos">245</span></a>
</span><span id="L-246"><a href="#L-246"><span class="linenos">246</span></a>    <span class="c1"># Set pixel values range from 0 to 100</span>
</span><span id="L-247"><a href="#L-247"><span class="linenos">247</span></a>    <span class="n">data</span><span class="p">[</span><span class="n">data</span> <span class="o">&gt;</span> <span class="mi">100</span><span class="p">]</span> <span class="o">=</span> <span class="mi">100</span>
</span><span id="L-248"><a href="#L-248"><span class="linenos">248</span></a>    <span class="n">data</span><span class="p">[</span><span class="n">data</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="L-249"><a href="#L-249"><span class="linenos">249</span></a>
</span><span id="L-250"><a href="#L-250"><span class="linenos">250</span></a>    <span class="n">segmentation</span> <span class="o">=</span> <span class="n">skimage</span><span class="o">.</span><span class="n">morphology</span><span class="o">.</span><span class="n">dilation</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">dil_mat</span><span class="p">))</span>
</span><span id="L-251"><a href="#L-251"><span class="linenos">251</span></a>
</span><span id="L-252"><a href="#L-252"><span class="linenos">252</span></a>    <span class="n">labels</span><span class="p">,</span> <span class="n">label_nb</span> <span class="o">=</span> <span class="n">sp</span><span class="o">.</span><span class="n">ndimage</span><span class="o">.</span><span class="n">label</span><span class="p">(</span><span class="n">segmentation</span><span class="p">)</span>
</span><span id="L-253"><a href="#L-253"><span class="linenos">253</span></a>    <span class="n">label_count</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">bincount</span><span class="p">(</span><span class="n">labels</span><span class="o">.</span><span class="n">ravel</span><span class="p">()</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">))</span>
</span><span id="L-254"><a href="#L-254"><span class="linenos">254</span></a>    <span class="n">label_count</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="L-255"><a href="#L-255"><span class="linenos">255</span></a>
</span><span id="L-256"><a href="#L-256"><span class="linenos">256</span></a>    <span class="c1"># mask = labels == label_count.argmax()</span>
</span><span id="L-257"><a href="#L-257"><span class="linenos">257</span></a>    <span class="c1"># mask = skimage.morphology.dilation(mask, np.ones(dil_mat))</span>
</span><span id="L-258"><a href="#L-258"><span class="linenos">258</span></a>    <span class="c1"># mask = sp.ndimage.morphology.binary_fill_holes(mask)</span>
</span><span id="L-259"><a href="#L-259"><span class="linenos">259</span></a>    <span class="c1"># mask = skimage.morphology.dilation(mask, np.ones(dil_mat))</span>
</span><span id="L-260"><a href="#L-260"><span class="linenos">260</span></a>
</span><span id="L-261"><a href="#L-261"><span class="linenos">261</span></a>    <span class="n">data</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">erode</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">dil_mat</span><span class="p">))</span>
</span><span id="L-262"><a href="#L-262"><span class="linenos">262</span></a>    <span class="n">mask</span> <span class="o">=</span> <span class="mi">1</span>
</span><span id="L-263"><a href="#L-263"><span class="linenos">263</span></a>
</span><span id="L-264"><a href="#L-264"><span class="linenos">264</span></a>    <span class="k">if</span> <span class="n">save</span><span class="p">:</span>
</span><span id="L-265"><a href="#L-265"><span class="linenos">265</span></a>        <span class="n">morph_type</span> <span class="o">=</span> <span class="s1">&#39;dilation&#39;</span>
</span><span id="L-266"><a href="#L-266"><span class="linenos">266</span></a>        <span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
</span><span id="L-267"><a href="#L-267"><span class="linenos">267</span></a>
</span><span id="L-268"><a href="#L-268"><span class="linenos">268</span></a>        <span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">mask</span> <span class="o">*</span> <span class="n">data</span><span class="p">,</span> <span class="n">aspect</span><span class="o">=</span><span class="s1">&#39;auto&#39;</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">cm</span><span class="o">.</span><span class="n">bone</span><span class="p">)</span>
</span><span id="L-269"><a href="#L-269"><span class="linenos">269</span></a>        <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">morph_type</span><span class="si">}</span><span class="s1"> mat=</span><span class="si">{</span><span class="n">dil_mat</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
</span><span id="L-270"><a href="#L-270"><span class="linenos">270</span></a>
</span><span id="L-271"><a href="#L-271"><span class="linenos">271</span></a>        <span class="c1"># plt.show(block=True)</span>
</span><span id="L-272"><a href="#L-272"><span class="linenos">272</span></a>        <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;./images/</span><span class="si">{</span><span class="n">morph_type</span><span class="si">}</span><span class="s1">/</span><span class="si">{</span><span class="n">morph_type</span><span class="si">}</span><span class="s1">_mat</span><span class="si">{</span><span class="n">dil_mat</span><span class="si">}</span><span class="s1">.png&#39;</span><span class="p">)</span>
</span><span id="L-273"><a href="#L-273"><span class="linenos">273</span></a>
</span><span id="L-274"><a href="#L-274"><span class="linenos">274</span></a>    <span class="k">if</span> <span class="n">show_diff</span><span class="p">:</span>
</span><span id="L-275"><a href="#L-275"><span class="linenos">275</span></a>        <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">[</span><span class="mi">8</span><span class="p">,</span> <span class="mi">8</span><span class="p">])</span>
</span><span id="L-276"><a href="#L-276"><span class="linenos">276</span></a>        <span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Noisy scan&#39;</span><span class="p">)</span>
</span><span id="L-277"><a href="#L-277"><span class="linenos">277</span></a>        <span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">org_scan</span><span class="p">,</span> <span class="n">aspect</span><span class="o">=</span><span class="s1">&#39;auto&#39;</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">cm</span><span class="o">.</span><span class="n">bone</span><span class="p">)</span>
</span><span id="L-278"><a href="#L-278"><span class="linenos">278</span></a>
</span><span id="L-279"><a href="#L-279"><span class="linenos">279</span></a>        <span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Clean scan&#39;</span><span class="p">)</span>
</span><span id="L-280"><a href="#L-280"><span class="linenos">280</span></a>        <span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">mask</span> <span class="o">*</span> <span class="n">data</span><span class="p">,</span> <span class="n">aspect</span><span class="o">=</span><span class="s1">&#39;auto&#39;</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">cm</span><span class="o">.</span><span class="n">bone</span><span class="p">)</span>
</span><span id="L-281"><a href="#L-281"><span class="linenos">281</span></a>
</span><span id="L-282"><a href="#L-282"><span class="linenos">282</span></a>        <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="n">block</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="L-283"><a href="#L-283"><span class="linenos">283</span></a>    <span class="k">return</span> <span class="n">mask</span> <span class="o">*</span> <span class="n">data</span>
</span><span id="L-284"><a href="#L-284"><span class="linenos">284</span></a>
</span><span id="L-285"><a href="#L-285"><span class="linenos">285</span></a>
</span><span id="L-286"><a href="#L-286"><span class="linenos">286</span></a>
</span><span id="L-287"><a href="#L-287"><span class="linenos">287</span></a><span class="k">def</span> <span class="nf">zoom_scan</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">out_width</span><span class="o">=</span><span class="mi">512</span><span class="p">,</span> <span class="n">out_height</span><span class="o">=</span><span class="mi">512</span><span class="p">,</span> <span class="n">out_depth</span><span class="o">=</span><span class="mi">30</span><span class="p">,</span> <span class="n">show_diff</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
</span><span id="L-288"><a href="#L-288"><span class="linenos">288</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-289"><a href="#L-289"><span class="linenos">289</span></a><span class="sd">    Function zooms in on given data array of size = org_width x org_height</span>
</span><span id="L-290"><a href="#L-290"><span class="linenos">290</span></a><span class="sd">    to new resolution = out_width x out_height</span>
</span><span id="L-291"><a href="#L-291"><span class="linenos">291</span></a><span class="sd">    </span>
</span><span id="L-292"><a href="#L-292"><span class="linenos">292</span></a><span class="sd">    :param data: Single CT scan data array</span>
</span><span id="L-293"><a href="#L-293"><span class="linenos">293</span></a><span class="sd">    :param out_depth: Output data depth</span>
</span><span id="L-294"><a href="#L-294"><span class="linenos">294</span></a><span class="sd">    :param out_width: Output data width</span>
</span><span id="L-295"><a href="#L-295"><span class="linenos">295</span></a><span class="sd">    :param out_height: Output data height</span>
</span><span id="L-296"><a href="#L-296"><span class="linenos">296</span></a><span class="sd">    :param show_diff: True/False (debug parameter) - if true result is shown</span>
</span><span id="L-297"><a href="#L-297"><span class="linenos">297</span></a><span class="sd">    :return: Resized data</span>
</span><span id="L-298"><a href="#L-298"><span class="linenos">298</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="L-299"><a href="#L-299"><span class="linenos">299</span></a>    <span class="c1"># assert data.shape[0] == out_depth</span>
</span><span id="L-300"><a href="#L-300"><span class="linenos">300</span></a>
</span><span id="L-301"><a href="#L-301"><span class="linenos">301</span></a>    <span class="n">current_depth</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
</span><span id="L-302"><a href="#L-302"><span class="linenos">302</span></a>    <span class="n">current_width</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="L-303"><a href="#L-303"><span class="linenos">303</span></a>    <span class="n">current_height</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
</span><span id="L-304"><a href="#L-304"><span class="linenos">304</span></a>
</span><span id="L-305"><a href="#L-305"><span class="linenos">305</span></a>    <span class="n">depth_factor</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">/</span> <span class="p">(</span><span class="n">current_depth</span> <span class="o">/</span> <span class="n">out_depth</span><span class="p">)</span>
</span><span id="L-306"><a href="#L-306"><span class="linenos">306</span></a>    <span class="n">width_factor</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">/</span> <span class="p">(</span><span class="n">current_width</span> <span class="o">/</span> <span class="n">out_width</span><span class="p">)</span>
</span><span id="L-307"><a href="#L-307"><span class="linenos">307</span></a>    <span class="n">height_factor</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">/</span> <span class="p">(</span><span class="n">current_height</span> <span class="o">/</span> <span class="n">out_height</span><span class="p">)</span>
</span><span id="L-308"><a href="#L-308"><span class="linenos">308</span></a>
</span><span id="L-309"><a href="#L-309"><span class="linenos">309</span></a>    <span class="n">res</span> <span class="o">=</span> <span class="n">sp</span><span class="o">.</span><span class="n">ndimage</span><span class="o">.</span><span class="n">zoom</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="p">(</span><span class="n">width_factor</span><span class="p">,</span> <span class="n">height_factor</span><span class="p">,</span> <span class="n">depth_factor</span><span class="p">),</span> <span class="n">order</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
</span><span id="L-310"><a href="#L-310"><span class="linenos">310</span></a>    <span class="k">if</span> <span class="n">show_diff</span><span class="p">:</span>
</span><span id="L-311"><a href="#L-311"><span class="linenos">311</span></a>        <span class="n">ind</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">current_depth</span><span class="p">)</span>
</span><span id="L-312"><a href="#L-312"><span class="linenos">312</span></a>        <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">[</span><span class="mi">8</span><span class="p">,</span> <span class="mi">8</span><span class="p">])</span>
</span><span id="L-313"><a href="#L-313"><span class="linenos">313</span></a>        <span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Original scan&#39;</span><span class="p">)</span>
</span><span id="L-314"><a href="#L-314"><span class="linenos">314</span></a>        <span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">data</span><span class="p">[:,</span> <span class="p">:,</span> <span class="n">ind</span><span class="p">],</span> <span class="n">aspect</span><span class="o">=</span><span class="s1">&#39;auto&#39;</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">cm</span><span class="o">.</span><span class="n">bone</span><span class="p">)</span>
</span><span id="L-315"><a href="#L-315"><span class="linenos">315</span></a>
</span><span id="L-316"><a href="#L-316"><span class="linenos">316</span></a>        <span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Zoomed scan&#39;</span><span class="p">)</span>
</span><span id="L-317"><a href="#L-317"><span class="linenos">317</span></a>        <span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">res</span><span class="p">[:,</span> <span class="p">:,</span> <span class="n">ind</span><span class="p">],</span> <span class="n">aspect</span><span class="o">=</span><span class="s1">&#39;auto&#39;</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">cm</span><span class="o">.</span><span class="n">bone</span><span class="p">)</span>
</span><span id="L-318"><a href="#L-318"><span class="linenos">318</span></a>        <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="n">block</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="L-319"><a href="#L-319"><span class="linenos">319</span></a>
</span><span id="L-320"><a href="#L-320"><span class="linenos">320</span></a>    <span class="k">return</span> <span class="n">res</span>
</span><span id="L-321"><a href="#L-321"><span class="linenos">321</span></a>
</span><span id="L-322"><a href="#L-322"><span class="linenos">322</span></a>
</span><span id="L-323"><a href="#L-323"><span class="linenos">323</span></a><span class="k">def</span> <span class="nf">resize_scan</span><span class="p">(</span><span class="n">data</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span>
</span><span id="L-324"><a href="#L-324"><span class="linenos">324</span></a>                <span class="n">out_width</span><span class="p">:</span> <span class="nb">int</span><span class="o">=</span><span class="mi">512</span><span class="p">,</span>
</span><span id="L-325"><a href="#L-325"><span class="linenos">325</span></a>                <span class="n">out_height</span><span class="p">:</span> <span class="nb">int</span><span class="o">=</span><span class="mi">512</span><span class="p">,</span>
</span><span id="L-326"><a href="#L-326"><span class="linenos">326</span></a>                <span class="n">show_diff</span><span class="p">:</span> <span class="nb">bool</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
</span><span id="L-327"><a href="#L-327"><span class="linenos">327</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-328"><a href="#L-328"><span class="linenos">328</span></a><span class="sd">    Function resizes given data array of size = org_width x org_height</span>
</span><span id="L-329"><a href="#L-329"><span class="linenos">329</span></a><span class="sd">    to new resolution = out_width x out_height</span>
</span><span id="L-330"><a href="#L-330"><span class="linenos">330</span></a><span class="sd">    </span>
</span><span id="L-331"><a href="#L-331"><span class="linenos">331</span></a><span class="sd">    :param data: Single CT scan data array</span>
</span><span id="L-332"><a href="#L-332"><span class="linenos">332</span></a><span class="sd">    :param out_width: Output data width</span>
</span><span id="L-333"><a href="#L-333"><span class="linenos">333</span></a><span class="sd">    :param out_height: Output data height</span>
</span><span id="L-334"><a href="#L-334"><span class="linenos">334</span></a><span class="sd">    :param show_diff: True/False (debug parameter) - if true result is shown</span>
</span><span id="L-335"><a href="#L-335"><span class="linenos">335</span></a><span class="sd">    :return: Resized data</span>
</span><span id="L-336"><a href="#L-336"><span class="linenos">336</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="L-337"><a href="#L-337"><span class="linenos">337</span></a>    <span class="n">new</span> <span class="o">=</span> <span class="n">skimage</span><span class="o">.</span><span class="n">transform</span><span class="o">.</span><span class="n">resize</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="p">(</span><span class="n">out_width</span><span class="p">,</span> <span class="n">out_height</span><span class="p">),</span>
</span><span id="L-338"><a href="#L-338"><span class="linenos">338</span></a>                                   <span class="n">preserve_range</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span id="L-339"><a href="#L-339"><span class="linenos">339</span></a>                                   <span class="n">anti_aliasing</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
</span><span id="L-340"><a href="#L-340"><span class="linenos">340</span></a>                                   <span class="n">order</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span>
</span><span id="L-341"><a href="#L-341"><span class="linenos">341</span></a>
</span><span id="L-342"><a href="#L-342"><span class="linenos">342</span></a>    <span class="k">if</span> <span class="n">show_diff</span><span class="p">:</span>
</span><span id="L-343"><a href="#L-343"><span class="linenos">343</span></a>        <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">[</span><span class="mi">8</span><span class="p">,</span> <span class="mi">8</span><span class="p">])</span>
</span><span id="L-344"><a href="#L-344"><span class="linenos">344</span></a>        <span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Original scan&#39;</span><span class="p">)</span>
</span><span id="L-345"><a href="#L-345"><span class="linenos">345</span></a>        <span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">aspect</span><span class="o">=</span><span class="s1">&#39;auto&#39;</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">cm</span><span class="o">.</span><span class="n">bone</span><span class="p">)</span>
</span><span id="L-346"><a href="#L-346"><span class="linenos">346</span></a>
</span><span id="L-347"><a href="#L-347"><span class="linenos">347</span></a>        <span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Resized scan&#39;</span><span class="p">)</span>
</span><span id="L-348"><a href="#L-348"><span class="linenos">348</span></a>        <span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">new</span><span class="p">,</span> <span class="n">aspect</span><span class="o">=</span><span class="s1">&#39;auto&#39;</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">cm</span><span class="o">.</span><span class="n">bone</span><span class="p">)</span>
</span><span id="L-349"><a href="#L-349"><span class="linenos">349</span></a>        <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="n">block</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="L-350"><a href="#L-350"><span class="linenos">350</span></a>    <span class="k">return</span> <span class="n">new</span>
</span><span id="L-351"><a href="#L-351"><span class="linenos">351</span></a>
</span><span id="L-352"><a href="#L-352"><span class="linenos">352</span></a>
</span><span id="L-353"><a href="#L-353"><span class="linenos">353</span></a><span class="k">def</span> <span class="nf">move_to_center</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">out_width</span><span class="o">=</span><span class="mi">512</span><span class="p">,</span> <span class="n">out_height</span><span class="o">=</span><span class="mi">512</span><span class="p">,</span> <span class="n">show_diff</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
</span><span id="L-354"><a href="#L-354"><span class="linenos">354</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-355"><a href="#L-355"><span class="linenos">355</span></a><span class="sd">    Function resizes CT scan to given resolution</span>
</span><span id="L-356"><a href="#L-356"><span class="linenos">356</span></a><span class="sd">    First it shifts brain in the center</span>
</span><span id="L-357"><a href="#L-357"><span class="linenos">357</span></a><span class="sd">    Additional padding is added afterwards</span>
</span><span id="L-358"><a href="#L-358"><span class="linenos">358</span></a>
</span><span id="L-359"><a href="#L-359"><span class="linenos">359</span></a><span class="sd">    :param data: Single CT scan data array</span>
</span><span id="L-360"><a href="#L-360"><span class="linenos">360</span></a><span class="sd">    :param out_width: Output data width</span>
</span><span id="L-361"><a href="#L-361"><span class="linenos">361</span></a><span class="sd">    :param out_height: Output data height</span>
</span><span id="L-362"><a href="#L-362"><span class="linenos">362</span></a><span class="sd">    :param show_diff: True/False (debug parameter) - if true result is shown</span>
</span><span id="L-363"><a href="#L-363"><span class="linenos">363</span></a><span class="sd">    :returns: Single CT scan shifted to center of array</span>
</span><span id="L-364"><a href="#L-364"><span class="linenos">364</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="L-365"><a href="#L-365"><span class="linenos">365</span></a>    <span class="c1"># Brain is surrounded by black backgroud (black pixel = 0) </span>
</span><span id="L-366"><a href="#L-366"><span class="linenos">366</span></a>    <span class="n">mask</span> <span class="o">=</span> <span class="n">data</span> <span class="o">==</span> <span class="mi">0</span>
</span><span id="L-367"><a href="#L-367"><span class="linenos">367</span></a>
</span><span id="L-368"><a href="#L-368"><span class="linenos">368</span></a>    <span class="c1"># Brain_array = Scan_array - Scan_background </span>
</span><span id="L-369"><a href="#L-369"><span class="linenos">369</span></a>    <span class="n">coords</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">nonzero</span><span class="p">(</span><span class="o">~</span><span class="n">mask</span><span class="p">))</span>
</span><span id="L-370"><a href="#L-370"><span class="linenos">370</span></a>
</span><span id="L-371"><a href="#L-371"><span class="linenos">371</span></a>    <span class="k">try</span><span class="p">:</span>
</span><span id="L-372"><a href="#L-372"><span class="linenos">372</span></a>        <span class="n">top_left</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">coords</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</span><span id="L-373"><a href="#L-373"><span class="linenos">373</span></a>        <span class="n">bottom_right</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">coords</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</span><span id="L-374"><a href="#L-374"><span class="linenos">374</span></a>    <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
</span><span id="L-375"><a href="#L-375"><span class="linenos">375</span></a>        <span class="c1"># First slices of CT scan are just air (slice with only black pixels)</span>
</span><span id="L-376"><a href="#L-376"><span class="linenos">376</span></a>        <span class="k">if</span> <span class="n">show_diff</span><span class="p">:</span>
</span><span id="L-377"><a href="#L-377"><span class="linenos">377</span></a>            <span class="nb">print</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
</span><span id="L-378"><a href="#L-378"><span class="linenos">378</span></a>            <span class="nb">print</span><span class="p">(</span><span class="n">coords</span><span class="p">)</span>
</span><span id="L-379"><a href="#L-379"><span class="linenos">379</span></a>            <span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;bone&#39;</span><span class="p">)</span>
</span><span id="L-380"><a href="#L-380"><span class="linenos">380</span></a>            <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</span><span id="L-381"><a href="#L-381"><span class="linenos">381</span></a>        <span class="k">return</span> <span class="n">data</span>
</span><span id="L-382"><a href="#L-382"><span class="linenos">382</span></a>
</span><span id="L-383"><a href="#L-383"><span class="linenos">383</span></a>    <span class="c1"># Remove the background</span>
</span><span id="L-384"><a href="#L-384"><span class="linenos">384</span></a>    <span class="n">croped_scan</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">top_left</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span><span class="n">bottom_right</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">top_left</span><span class="p">[</span><span class="mi">1</span><span class="p">]:</span><span class="n">bottom_right</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span>
</span><span id="L-385"><a href="#L-385"><span class="linenos">385</span></a>
</span><span id="L-386"><a href="#L-386"><span class="linenos">386</span></a>    <span class="k">if</span> <span class="n">croped_scan</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">out_width</span> <span class="ow">or</span> <span class="n">croped_scan</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">out_height</span><span class="p">:</span>
</span><span id="L-387"><a href="#L-387"><span class="linenos">387</span></a>        <span class="n">croped_scan</span> <span class="o">=</span> <span class="n">resize_scan</span><span class="p">(</span><span class="n">croped_scan</span><span class="p">,</span> <span class="n">out_width</span><span class="p">,</span> <span class="n">out_height</span><span class="p">)</span>
</span><span id="L-388"><a href="#L-388"><span class="linenos">388</span></a>
</span><span id="L-389"><a href="#L-389"><span class="linenos">389</span></a>    <span class="n">height</span><span class="p">,</span> <span class="n">width</span> <span class="o">=</span> <span class="n">croped_scan</span><span class="o">.</span><span class="n">shape</span>
</span><span id="L-390"><a href="#L-390"><span class="linenos">390</span></a>    <span class="n">final_image</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">out_height</span><span class="p">,</span> <span class="n">out_width</span><span class="p">))</span>
</span><span id="L-391"><a href="#L-391"><span class="linenos">391</span></a>
</span><span id="L-392"><a href="#L-392"><span class="linenos">392</span></a>    <span class="n">pad_left</span> <span class="o">=</span> <span class="nb">int</span><span class="p">((</span><span class="n">out_width</span> <span class="o">-</span> <span class="n">width</span><span class="p">)</span> <span class="o">//</span> <span class="mi">2</span><span class="p">)</span>
</span><span id="L-393"><a href="#L-393"><span class="linenos">393</span></a>    <span class="n">pad_top</span> <span class="o">=</span> <span class="nb">int</span><span class="p">((</span><span class="n">out_height</span> <span class="o">-</span> <span class="n">height</span><span class="p">)</span> <span class="o">//</span> <span class="mi">2</span><span class="p">)</span>
</span><span id="L-394"><a href="#L-394"><span class="linenos">394</span></a>
</span><span id="L-395"><a href="#L-395"><span class="linenos">395</span></a>    <span class="c1"># Replace the pixels with the image&#39;s pixels</span>
</span><span id="L-396"><a href="#L-396"><span class="linenos">396</span></a>    <span class="c1"># try:</span>
</span><span id="L-397"><a href="#L-397"><span class="linenos">397</span></a>    <span class="n">final_image</span><span class="p">[</span><span class="n">pad_top</span><span class="p">:</span><span class="n">pad_top</span> <span class="o">+</span> <span class="n">height</span><span class="p">,</span> <span class="n">pad_left</span><span class="p">:</span><span class="n">pad_left</span> <span class="o">+</span> <span class="n">width</span><span class="p">]</span> <span class="o">=</span> <span class="n">croped_scan</span>
</span><span id="L-398"><a href="#L-398"><span class="linenos">398</span></a>    <span class="c1"># final_image.ravel([pad_top:pad_top + height, pad_left:pad_left + width])</span>
</span><span id="L-399"><a href="#L-399"><span class="linenos">399</span></a>
</span><span id="L-400"><a href="#L-400"><span class="linenos">400</span></a>    <span class="k">if</span> <span class="n">show_diff</span><span class="p">:</span>
</span><span id="L-401"><a href="#L-401"><span class="linenos">401</span></a>        <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">[</span><span class="mi">8</span><span class="p">,</span> <span class="mi">8</span><span class="p">])</span>
</span><span id="L-402"><a href="#L-402"><span class="linenos">402</span></a>        <span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Original scan&#39;</span><span class="p">)</span>
</span><span id="L-403"><a href="#L-403"><span class="linenos">403</span></a>        <span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">aspect</span><span class="o">=</span><span class="s1">&#39;auto&#39;</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">cm</span><span class="o">.</span><span class="n">bone</span><span class="p">)</span>
</span><span id="L-404"><a href="#L-404"><span class="linenos">404</span></a>
</span><span id="L-405"><a href="#L-405"><span class="linenos">405</span></a>        <span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Shifted scan&#39;</span><span class="p">)</span>
</span><span id="L-406"><a href="#L-406"><span class="linenos">406</span></a>        <span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">final_image</span><span class="p">,</span> <span class="n">aspect</span><span class="o">=</span><span class="s1">&#39;auto&#39;</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">cm</span><span class="o">.</span><span class="n">bone</span><span class="p">)</span>
</span><span id="L-407"><a href="#L-407"><span class="linenos">407</span></a>        <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="n">block</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="L-408"><a href="#L-408"><span class="linenos">408</span></a>
</span><span id="L-409"><a href="#L-409"><span class="linenos">409</span></a>    <span class="k">return</span> <span class="n">final_image</span>
</span><span id="L-410"><a href="#L-410"><span class="linenos">410</span></a>
</span><span id="L-411"><a href="#L-411"><span class="linenos">411</span></a>
</span><span id="L-412"><a href="#L-412"><span class="linenos">412</span></a><span class="k">def</span> <span class="nf">rotate_to_center</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">show_diff</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
</span><span id="L-413"><a href="#L-413"><span class="linenos">413</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-414"><a href="#L-414"><span class="linenos">414</span></a><span class="sd">    Function straightens tilted brain scan</span>
</span><span id="L-415"><a href="#L-415"><span class="linenos">415</span></a>
</span><span id="L-416"><a href="#L-416"><span class="linenos">416</span></a><span class="sd">    :param data: Single tilted CT scan data array</span>
</span><span id="L-417"><a href="#L-417"><span class="linenos">417</span></a><span class="sd">    :param show_diff: True/False (debug parameter) - if true result is shown</span>
</span><span id="L-418"><a href="#L-418"><span class="linenos">418</span></a><span class="sd">    :returns: Straight CT scan data array</span>
</span><span id="L-419"><a href="#L-419"><span class="linenos">419</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="L-420"><a href="#L-420"><span class="linenos">420</span></a>    <span class="c1"># @TODO - nefunguje vo vela pripadoch</span>
</span><span id="L-421"><a href="#L-421"><span class="linenos">421</span></a>    <span class="n">scan</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">uint8</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
</span><span id="L-422"><a href="#L-422"><span class="linenos">422</span></a>    <span class="n">contours</span><span class="p">,</span> <span class="n">hier</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">findContours</span><span class="p">(</span><span class="n">scan</span><span class="p">,</span> <span class="n">cv2</span><span class="o">.</span><span class="n">RETR_EXTERNAL</span><span class="p">,</span> <span class="n">cv2</span><span class="o">.</span><span class="n">CHAIN_APPROX_SIMPLE</span><span class="p">)</span>
</span><span id="L-423"><a href="#L-423"><span class="linenos">423</span></a>    <span class="n">mask</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">scan</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>  <span class="c1"># , np.uint8)</span>
</span><span id="L-424"><a href="#L-424"><span class="linenos">424</span></a>
</span><span id="L-425"><a href="#L-425"><span class="linenos">425</span></a>    <span class="c1"># find the biggest contour (c) by the area</span>
</span><span id="L-426"><a href="#L-426"><span class="linenos">426</span></a>    <span class="n">c</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">contours</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="n">cv2</span><span class="o">.</span><span class="n">contourArea</span><span class="p">)</span>
</span><span id="L-427"><a href="#L-427"><span class="linenos">427</span></a>
</span><span id="L-428"><a href="#L-428"><span class="linenos">428</span></a>    <span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">),</span> <span class="p">(</span><span class="n">MA</span><span class="p">,</span> <span class="n">ma</span><span class="p">),</span> <span class="n">angle</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">fitEllipse</span><span class="p">(</span><span class="n">c</span><span class="p">)</span>
</span><span id="L-429"><a href="#L-429"><span class="linenos">429</span></a>
</span><span id="L-430"><a href="#L-430"><span class="linenos">430</span></a>    <span class="n">cv2</span><span class="o">.</span><span class="n">ellipse</span><span class="p">(</span><span class="n">scan</span><span class="p">,</span> <span class="p">((</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">),</span> <span class="p">(</span><span class="n">MA</span><span class="p">,</span> <span class="n">ma</span><span class="p">),</span> <span class="n">angle</span><span class="p">),</span> <span class="n">color</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">255</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="n">thickness</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
</span><span id="L-431"><a href="#L-431"><span class="linenos">431</span></a>
</span><span id="L-432"><a href="#L-432"><span class="linenos">432</span></a>    <span class="n">rmajor</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">MA</span><span class="p">,</span> <span class="n">ma</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span>
</span><span id="L-433"><a href="#L-433"><span class="linenos">433</span></a>
</span><span id="L-434"><a href="#L-434"><span class="linenos">434</span></a>    <span class="k">if</span> <span class="n">angle</span> <span class="o">&gt;</span> <span class="mi">90</span><span class="p">:</span>
</span><span id="L-435"><a href="#L-435"><span class="linenos">435</span></a>        <span class="n">angle</span> <span class="o">-=</span> <span class="mi">90</span>
</span><span id="L-436"><a href="#L-436"><span class="linenos">436</span></a>    <span class="k">else</span><span class="p">:</span>
</span><span id="L-437"><a href="#L-437"><span class="linenos">437</span></a>        <span class="n">angle</span> <span class="o">+=</span> <span class="mi">90</span>
</span><span id="L-438"><a href="#L-438"><span class="linenos">438</span></a>
</span><span id="L-439"><a href="#L-439"><span class="linenos">439</span></a>    <span class="n">X_top</span> <span class="o">=</span> <span class="n">x</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">radians</span><span class="p">(</span><span class="n">angle</span><span class="p">))</span> <span class="o">*</span> <span class="n">rmajor</span>
</span><span id="L-440"><a href="#L-440"><span class="linenos">440</span></a>    <span class="n">Y_top</span> <span class="o">=</span> <span class="n">y</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">radians</span><span class="p">(</span><span class="n">angle</span><span class="p">))</span> <span class="o">*</span> <span class="n">rmajor</span>
</span><span id="L-441"><a href="#L-441"><span class="linenos">441</span></a>    <span class="n">X_bot</span> <span class="o">=</span> <span class="n">x</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">radians</span><span class="p">(</span><span class="n">angle</span> <span class="o">+</span> <span class="mi">180</span><span class="p">))</span> <span class="o">*</span> <span class="n">rmajor</span>
</span><span id="L-442"><a href="#L-442"><span class="linenos">442</span></a>    <span class="n">Y_bot</span> <span class="o">=</span> <span class="n">y</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">radians</span><span class="p">(</span><span class="n">angle</span> <span class="o">+</span> <span class="mi">180</span><span class="p">))</span> <span class="o">*</span> <span class="n">rmajor</span>
</span><span id="L-443"><a href="#L-443"><span class="linenos">443</span></a>
</span><span id="L-444"><a href="#L-444"><span class="linenos">444</span></a>    <span class="n">M</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">getRotationMatrix2D</span><span class="p">((</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">),</span> <span class="n">angle</span> <span class="o">-</span> <span class="mi">90</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
</span><span id="L-445"><a href="#L-445"><span class="linenos">445</span></a>    <span class="n">straight_scan</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">warpAffine</span><span class="p">(</span><span class="n">scan</span><span class="p">,</span> <span class="n">M</span><span class="p">,</span> <span class="p">(</span><span class="n">scan</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">scan</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span> <span class="n">cv2</span><span class="o">.</span><span class="n">INTER_CUBIC</span><span class="p">)</span>
</span><span id="L-446"><a href="#L-446"><span class="linenos">446</span></a>
</span><span id="L-447"><a href="#L-447"><span class="linenos">447</span></a>    <span class="k">if</span> <span class="n">show_diff</span><span class="p">:</span>
</span><span id="L-448"><a href="#L-448"><span class="linenos">448</span></a>        <span class="c1"># Show line of rotation</span>
</span><span id="L-449"><a href="#L-449"><span class="linenos">449</span></a>        <span class="n">cv2</span><span class="o">.</span><span class="n">line</span><span class="p">(</span><span class="n">scan</span><span class="p">,</span> <span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">X_top</span><span class="p">),</span> <span class="nb">int</span><span class="p">(</span><span class="n">Y_top</span><span class="p">)),</span> <span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">X_bot</span><span class="p">),</span> <span class="nb">int</span><span class="p">(</span><span class="n">Y_bot</span><span class="p">)),</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">255</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="mi">3</span><span class="p">)</span>
</span><span id="L-450"><a href="#L-450"><span class="linenos">450</span></a>
</span><span id="L-451"><a href="#L-451"><span class="linenos">451</span></a>        <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">[</span><span class="mi">8</span><span class="p">,</span> <span class="mi">8</span><span class="p">])</span>
</span><span id="L-452"><a href="#L-452"><span class="linenos">452</span></a>        <span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Tilted scan&#39;</span><span class="p">)</span>
</span><span id="L-453"><a href="#L-453"><span class="linenos">453</span></a>        <span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">scan</span><span class="p">,</span> <span class="n">aspect</span><span class="o">=</span><span class="s1">&#39;auto&#39;</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">cm</span><span class="o">.</span><span class="n">bone</span><span class="p">)</span>
</span><span id="L-454"><a href="#L-454"><span class="linenos">454</span></a>
</span><span id="L-455"><a href="#L-455"><span class="linenos">455</span></a>        <span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Straight scan&#39;</span><span class="p">)</span>
</span><span id="L-456"><a href="#L-456"><span class="linenos">456</span></a>        <span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">straight_scan</span><span class="p">,</span> <span class="n">aspect</span><span class="o">=</span><span class="s1">&#39;auto&#39;</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">cm</span><span class="o">.</span><span class="n">bone</span><span class="p">)</span>
</span><span id="L-457"><a href="#L-457"><span class="linenos">457</span></a>        <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="n">block</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="L-458"><a href="#L-458"><span class="linenos">458</span></a>
</span><span id="L-459"><a href="#L-459"><span class="linenos">459</span></a>    <span class="k">return</span> <span class="n">straight_scan</span>
</span><span id="L-460"><a href="#L-460"><span class="linenos">460</span></a>
</span><span id="L-461"><a href="#L-461"><span class="linenos">461</span></a>
</span><span id="L-462"><a href="#L-462"><span class="linenos">462</span></a><span class="k">def</span> <span class="nf">uniform_depth</span><span class="p">(</span><span class="n">data</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span>
</span><span id="L-463"><a href="#L-463"><span class="linenos">463</span></a>                  <span class="n">depth</span><span class="p">:</span> <span class="nb">int</span><span class="o">=</span><span class="mi">30</span><span class="p">,</span>
</span><span id="L-464"><a href="#L-464"><span class="linenos">464</span></a>                  <span class="n">center_pos</span><span class="p">:</span> <span class="nb">float</span><span class="o">=</span><span class="mi">3</span><span class="o">/</span><span class="mi">5</span><span class="p">,</span>
</span><span id="L-465"><a href="#L-465"><span class="linenos">465</span></a>                  <span class="n">type_</span><span class="p">:</span> <span class="nb">str</span><span class="o">=</span><span class="s1">&#39;multi&#39;</span><span class="p">,</span>
</span><span id="L-466"><a href="#L-466"><span class="linenos">466</span></a>                  <span class="p">):</span>
</span><span id="L-467"><a href="#L-467"><span class="linenos">467</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-468"><a href="#L-468"><span class="linenos">468</span></a><span class="sd">    Function uniforms depth of CT scans</span>
</span><span id="L-469"><a href="#L-469"><span class="linenos">469</span></a><span class="sd">    (given size of the body there might be more/less scans)</span>
</span><span id="L-470"><a href="#L-470"><span class="linenos">470</span></a>
</span><span id="L-471"><a href="#L-471"><span class="linenos">471</span></a><span class="sd">    -----------------------------------------</span>
</span><span id="L-472"><a href="#L-472"><span class="linenos">472</span></a><span class="sd">    In case of leukoencefalopathy classification:</span>
</span><span id="L-473"><a href="#L-473"><span class="linenos">473</span></a><span class="sd">    Ventricular system is located approx. in 3/5 depth of the scan</span>
</span><span id="L-474"><a href="#L-474"><span class="linenos">474</span></a><span class="sd">    -----------------------------------------</span>
</span><span id="L-475"><a href="#L-475"><span class="linenos">475</span></a><span class="sd">    </span>
</span><span id="L-476"><a href="#L-476"><span class="linenos">476</span></a><span class="sd">    :param data: numpy array data</span>
</span><span id="L-477"><a href="#L-477"><span class="linenos">477</span></a><span class="sd">    :param depth: number of</span>
</span><span id="L-478"><a href="#L-478"><span class="linenos">478</span></a><span class="sd">    :param center_pos: location of desired object in %</span>
</span><span id="L-479"><a href="#L-479"><span class="linenos">479</span></a><span class="sd">    :param type_: single/multi - single=single patient/ multi=multi patients</span>
</span><span id="L-480"><a href="#L-480"><span class="linenos">480</span></a><span class="sd">    :return: uniformed depth in data</span>
</span><span id="L-481"><a href="#L-481"><span class="linenos">481</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="L-482"><a href="#L-482"><span class="linenos">482</span></a>    <span class="k">if</span> <span class="n">type_</span> <span class="o">==</span> <span class="s1">&#39;single&#39;</span><span class="p">:</span>
</span><span id="L-483"><a href="#L-483"><span class="linenos">483</span></a>        <span class="n">data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">data</span><span class="p">])</span>
</span><span id="L-484"><a href="#L-484"><span class="linenos">484</span></a>
</span><span id="L-485"><a href="#L-485"><span class="linenos">485</span></a>    <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">data</span><span class="p">)</span> <span class="o">==</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
</span><span id="L-486"><a href="#L-486"><span class="linenos">486</span></a>        <span class="n">data</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
</span><span id="L-487"><a href="#L-487"><span class="linenos">487</span></a>
</span><span id="L-488"><a href="#L-488"><span class="linenos">488</span></a>    <span class="n">ct_scans</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>
</span><span id="L-489"><a href="#L-489"><span class="linenos">489</span></a>    <span class="k">for</span> <span class="n">scan</span> <span class="ow">in</span> <span class="n">data</span><span class="p">:</span>
</span><span id="L-490"><a href="#L-490"><span class="linenos">490</span></a>        <span class="c1"># Take only middle slices of CT scan (first/last parts have no important information)</span>
</span><span id="L-491"><a href="#L-491"><span class="linenos">491</span></a>        <span class="c1"># If CT scan has 71 and desired depth is 30 -&gt; final CT scan = original_scan[20:50]</span>
</span><span id="L-492"><a href="#L-492"><span class="linenos">492</span></a>        <span class="n">center</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">scan</span><span class="p">)</span> <span class="o">*</span> <span class="n">center_pos</span><span class="p">)</span>
</span><span id="L-493"><a href="#L-493"><span class="linenos">493</span></a>        <span class="n">ct_scans</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">scan</span><span class="p">[</span><span class="n">center</span> <span class="o">-</span> <span class="p">(</span><span class="n">depth</span> <span class="o">//</span> <span class="mi">2</span><span class="p">):</span> <span class="n">center</span> <span class="o">+</span> <span class="p">(</span><span class="n">depth</span> <span class="o">//</span> <span class="mi">2</span><span class="p">)])</span>
</span><span id="L-494"><a href="#L-494"><span class="linenos">494</span></a>
</span><span id="L-495"><a href="#L-495"><span class="linenos">495</span></a>    <span class="k">if</span> <span class="n">type_</span> <span class="o">==</span> <span class="s1">&#39;single&#39;</span><span class="p">:</span>
</span><span id="L-496"><a href="#L-496"><span class="linenos">496</span></a>        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">ct_scans</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
</span><span id="L-497"><a href="#L-497"><span class="linenos">497</span></a>    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">ct_scans</span><span class="p">)</span>
</span><span id="L-498"><a href="#L-498"><span class="linenos">498</span></a>
</span><span id="L-499"><a href="#L-499"><span class="linenos">499</span></a>
</span><span id="L-500"><a href="#L-500"><span class="linenos">500</span></a><span class="k">def</span> <span class="nf">plot_ct_images</span><span class="p">(</span><span class="n">data</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span>
</span><span id="L-501"><a href="#L-501"><span class="linenos">501</span></a>                   <span class="n">rows</span><span class="p">:</span> <span class="nb">int</span><span class="o">=</span><span class="mi">6</span><span class="p">,</span>
</span><span id="L-502"><a href="#L-502"><span class="linenos">502</span></a>                   <span class="n">cols</span><span class="p">:</span> <span class="nb">int</span><span class="o">=</span><span class="mi">6</span><span class="p">,</span>
</span><span id="L-503"><a href="#L-503"><span class="linenos">503</span></a>                   <span class="n">start_with</span><span class="p">:</span> <span class="nb">int</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span>
</span><span id="L-504"><a href="#L-504"><span class="linenos">504</span></a>                   <span class="n">show_every</span><span class="p">:</span> <span class="nb">int</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span>
</span><span id="L-505"><a href="#L-505"><span class="linenos">505</span></a>                   <span class="n">block</span><span class="p">:</span> <span class="nb">bool</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span id="L-506"><a href="#L-506"><span class="linenos">506</span></a>                   <span class="p">):</span>
</span><span id="L-507"><a href="#L-507"><span class="linenos">507</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-508"><a href="#L-508"><span class="linenos">508</span></a><span class="sd">    Using matplotlib plots scans side by side</span>
</span><span id="L-509"><a href="#L-509"><span class="linenos">509</span></a>
</span><span id="L-510"><a href="#L-510"><span class="linenos">510</span></a><span class="sd">    :param data: list of scans</span>
</span><span id="L-511"><a href="#L-511"><span class="linenos">511</span></a><span class="sd">    :param rows: number of rows</span>
</span><span id="L-512"><a href="#L-512"><span class="linenos">512</span></a><span class="sd">    :param cols: number of columns</span>
</span><span id="L-513"><a href="#L-513"><span class="linenos">513</span></a><span class="sd">    :param start_with: initial scan to start with</span>
</span><span id="L-514"><a href="#L-514"><span class="linenos">514</span></a><span class="sd">    :param show_every: number of steps</span>
</span><span id="L-515"><a href="#L-515"><span class="linenos">515</span></a><span class="sd">    :param block:</span>
</span><span id="L-516"><a href="#L-516"><span class="linenos">516</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="L-517"><a href="#L-517"><span class="linenos">517</span></a>    <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">rows</span><span class="p">,</span> <span class="n">cols</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">[</span><span class="mi">8</span><span class="p">,</span> <span class="mi">8</span><span class="p">])</span>
</span><span id="L-518"><a href="#L-518"><span class="linenos">518</span></a>    <span class="n">index</span> <span class="o">=</span> <span class="n">start_with</span>
</span><span id="L-519"><a href="#L-519"><span class="linenos">519</span></a>    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">rows</span><span class="p">):</span>
</span><span id="L-520"><a href="#L-520"><span class="linenos">520</span></a>        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">cols</span><span class="p">):</span>
</span><span id="L-521"><a href="#L-521"><span class="linenos">521</span></a>            <span class="n">ax</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Scan slice </span><span class="si">{</span><span class="n">index</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
</span><span id="L-522"><a href="#L-522"><span class="linenos">522</span></a>            <span class="n">ax</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="n">index</span><span class="p">],</span> <span class="n">aspect</span><span class="o">=</span><span class="s1">&#39;auto&#39;</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">cm</span><span class="o">.</span><span class="n">bone</span><span class="p">)</span>
</span><span id="L-523"><a href="#L-523"><span class="linenos">523</span></a>            <span class="n">ax</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s1">&#39;off&#39;</span><span class="p">)</span>
</span><span id="L-524"><a href="#L-524"><span class="linenos">524</span></a>            <span class="n">index</span> <span class="o">+=</span> <span class="n">show_every</span>
</span><span id="L-525"><a href="#L-525"><span class="linenos">525</span></a>    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="n">block</span><span class="o">=</span><span class="n">block</span><span class="p">)</span>
</span><span id="L-526"><a href="#L-526"><span class="linenos">526</span></a>
</span><span id="L-527"><a href="#L-527"><span class="linenos">527</span></a>
</span><span id="L-528"><a href="#L-528"><span class="linenos">528</span></a><span class="k">def</span> <span class="nf">load_data</span><span class="p">(</span><span class="n">path</span><span class="p">,</span>
</span><span id="L-529"><a href="#L-529"><span class="linenos">529</span></a>              <span class="n">limit</span><span class="p">:</span> <span class="nb">int</span><span class="o">=</span><span class="mi">1000</span><span class="p">,</span>
</span><span id="L-530"><a href="#L-530"><span class="linenos">530</span></a>              <span class="n">processed_type</span><span class="p">:</span> <span class="nb">str</span><span class="o">=</span><span class="s1">&#39;numpy_data_processed&#39;</span><span class="p">):</span>
</span><span id="L-531"><a href="#L-531"><span class="linenos">531</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-532"><a href="#L-532"><span class="linenos">532</span></a><span class="sd">    Function loads all data processed to numpy file(.npy)</span>
</span><span id="L-533"><a href="#L-533"><span class="linenos">533</span></a><span class="sd">    from all folders in a given path</span>
</span><span id="L-534"><a href="#L-534"><span class="linenos">534</span></a>
</span><span id="L-535"><a href="#L-535"><span class="linenos">535</span></a><span class="sd">    :param path: path to folder containing CT scans (pos or neg)</span>
</span><span id="L-536"><a href="#L-536"><span class="linenos">536</span></a><span class="sd">    :param limit: int limit how many files to return</span>
</span><span id="L-537"><a href="#L-537"><span class="linenos">537</span></a><span class="sd">    :param processed_type:</span>
</span><span id="L-538"><a href="#L-538"><span class="linenos">538</span></a><span class="sd">    :return: CT scans in numpy array</span>
</span><span id="L-539"><a href="#L-539"><span class="linenos">539</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="L-540"><a href="#L-540"><span class="linenos">540</span></a>    <span class="n">all_ct_scans</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>
</span><span id="L-541"><a href="#L-541"><span class="linenos">541</span></a>    <span class="n">count</span> <span class="o">=</span> <span class="mi">1</span>
</span><span id="L-542"><a href="#L-542"><span class="linenos">542</span></a>    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Path:&#39;</span><span class="p">,</span> <span class="n">path</span><span class="p">)</span>
</span><span id="L-543"><a href="#L-543"><span class="linenos">543</span></a>    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Loading CT data from numpy arrays...&#39;</span><span class="p">)</span>
</span><span id="L-544"><a href="#L-544"><span class="linenos">544</span></a>    <span class="k">for</span> <span class="n">directory</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="n">path</span><span class="p">):</span>
</span><span id="L-545"><a href="#L-545"><span class="linenos">545</span></a>        <span class="k">if</span> <span class="n">count</span> <span class="o">&lt;=</span> <span class="n">limit</span><span class="p">:</span>
</span><span id="L-546"><a href="#L-546"><span class="linenos">546</span></a>            <span class="n">dir_path</span> <span class="o">=</span> <span class="n">path</span> <span class="o">+</span> <span class="s1">&#39;/&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">directory</span><span class="p">)</span>
</span><span id="L-547"><a href="#L-547"><span class="linenos">547</span></a>            <span class="k">try</span><span class="p">:</span>
</span><span id="L-548"><a href="#L-548"><span class="linenos">548</span></a>                <span class="n">ct_scan</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">dir_path</span> <span class="o">+</span> <span class="s1">&#39;/&#39;</span> <span class="o">+</span> <span class="n">processed_type</span> <span class="o">+</span> <span class="s1">&#39;.npy&#39;</span><span class="p">,</span> <span class="n">allow_pickle</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="L-549"><a href="#L-549"><span class="linenos">549</span></a>                <span class="k">if</span> <span class="n">ct_scan</span><span class="o">.</span><span class="n">shape</span> <span class="o">!=</span> <span class="p">(</span><span class="mi">0</span><span class="p">,)</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">ct_scan</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">ct_scan</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">5</span><span class="p">:</span>
</span><span id="L-550"><a href="#L-550"><span class="linenos">550</span></a>                    <span class="n">all_ct_scans</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ct_scan</span><span class="o">.</span><span class="n">tolist</span><span class="p">())</span>
</span><span id="L-551"><a href="#L-551"><span class="linenos">551</span></a>                    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;-&#39;</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
</span><span id="L-552"><a href="#L-552"><span class="linenos">552</span></a>                    <span class="k">if</span> <span class="n">count</span> <span class="o">%</span> <span class="mi">10</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="L-553"><a href="#L-553"><span class="linenos">553</span></a>                        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;&gt; </span><span class="si">{</span><span class="n">count</span><span class="si">}</span><span class="s1"> DONE!&#39;</span><span class="p">)</span>
</span><span id="L-554"><a href="#L-554"><span class="linenos">554</span></a>                <span class="n">count</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="L-555"><a href="#L-555"><span class="linenos">555</span></a>            <span class="k">except</span> <span class="ne">FileNotFoundError</span><span class="p">:</span>
</span><span id="L-556"><a href="#L-556"><span class="linenos">556</span></a>                <span class="k">pass</span>
</span><span id="L-557"><a href="#L-557"><span class="linenos">557</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-558"><a href="#L-558"><span class="linenos">558</span></a>            <span class="k">pass</span>
</span><span id="L-559"><a href="#L-559"><span class="linenos">559</span></a>    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;CT data successfully loaded!&#39;</span><span class="p">)</span>
</span><span id="L-560"><a href="#L-560"><span class="linenos">560</span></a>
</span><span id="L-561"><a href="#L-561"><span class="linenos">561</span></a>    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">all_ct_scans</span><span class="p">)</span>
</span><span id="L-562"><a href="#L-562"><span class="linenos">562</span></a>
</span><span id="L-563"><a href="#L-563"><span class="linenos">563</span></a>
</span><span id="L-564"><a href="#L-564"><span class="linenos">564</span></a><span class="k">def</span> <span class="nf">remove_background</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">show_diff</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
</span><span id="L-565"><a href="#L-565"><span class="linenos">565</span></a>    <span class="c1"># TODO - implement this part</span>
</span><span id="L-566"><a href="#L-566"><span class="linenos">566</span></a>    <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="s2">&quot;To be done...&quot;</span><span class="p">)</span>
</span><span id="L-567"><a href="#L-567"><span class="linenos">567</span></a>
</span><span id="L-568"><a href="#L-568"><span class="linenos">568</span></a>    <span class="n">scan</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">uint8</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
</span><span id="L-569"><a href="#L-569"><span class="linenos">569</span></a>    <span class="n">contours</span><span class="p">,</span> <span class="n">hier</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">findContours</span><span class="p">(</span><span class="n">scan</span><span class="p">,</span> <span class="n">cv2</span><span class="o">.</span><span class="n">RETR_EXTERNAL</span><span class="p">,</span> <span class="n">cv2</span><span class="o">.</span><span class="n">CHAIN_APPROX_SIMPLE</span><span class="p">)</span>
</span><span id="L-570"><a href="#L-570"><span class="linenos">570</span></a>    <span class="n">mask</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">scan</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">uint8</span><span class="p">)</span>
</span><span id="L-571"><a href="#L-571"><span class="linenos">571</span></a>
</span><span id="L-572"><a href="#L-572"><span class="linenos">572</span></a>    <span class="c1"># find the biggest contour (c) by the area</span>
</span><span id="L-573"><a href="#L-573"><span class="linenos">573</span></a>    <span class="n">c</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">contours</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="n">cv2</span><span class="o">.</span><span class="n">contourArea</span><span class="p">)</span>
</span><span id="L-574"><a href="#L-574"><span class="linenos">574</span></a>    <span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">),</span> <span class="p">(</span><span class="n">MA</span><span class="p">,</span> <span class="n">ma</span><span class="p">),</span> <span class="n">angle</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">fitEllipse</span><span class="p">(</span><span class="n">c</span><span class="p">)</span>
</span><span id="L-575"><a href="#L-575"><span class="linenos">575</span></a>
</span><span id="L-576"><a href="#L-576"><span class="linenos">576</span></a>    <span class="c1"># cv2.ellipse(scan, ((x, y), (MA, ma), angle), color=(3, 5, 255), thickness=2)</span>
</span><span id="L-577"><a href="#L-577"><span class="linenos">577</span></a>    <span class="n">cv2</span><span class="o">.</span><span class="n">ellipse</span><span class="p">(</span><span class="n">mask</span><span class="p">,</span> <span class="p">((</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">),</span> <span class="p">(</span><span class="n">MA</span><span class="p">,</span> <span class="n">ma</span><span class="p">),</span> <span class="n">angle</span><span class="p">),</span> <span class="mi">255</span><span class="p">,</span> <span class="n">thickness</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
</span><span id="L-578"><a href="#L-578"><span class="linenos">578</span></a>
</span><span id="L-579"><a href="#L-579"><span class="linenos">579</span></a>    <span class="n">result</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">bitwise_and</span><span class="p">(</span><span class="n">mask</span><span class="p">,</span> <span class="n">scan</span><span class="p">)</span>
</span><span id="L-580"><a href="#L-580"><span class="linenos">580</span></a>    <span class="n">result</span><span class="p">[</span><span class="n">mask</span> <span class="o">==</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
</span><span id="L-581"><a href="#L-581"><span class="linenos">581</span></a>
</span><span id="L-582"><a href="#L-582"><span class="linenos">582</span></a>    <span class="k">if</span> <span class="n">show_diff</span><span class="p">:</span>
</span><span id="L-583"><a href="#L-583"><span class="linenos">583</span></a>        <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">[</span><span class="mi">8</span><span class="p">,</span> <span class="mi">8</span><span class="p">])</span>
</span><span id="L-584"><a href="#L-584"><span class="linenos">584</span></a>        <span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Background scan&#39;</span><span class="p">)</span>
</span><span id="L-585"><a href="#L-585"><span class="linenos">585</span></a>        <span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">aspect</span><span class="o">=</span><span class="s1">&#39;auto&#39;</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">cm</span><span class="o">.</span><span class="n">bone</span><span class="p">)</span>
</span><span id="L-586"><a href="#L-586"><span class="linenos">586</span></a>
</span><span id="L-587"><a href="#L-587"><span class="linenos">587</span></a>        <span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;W/o background scan&#39;</span><span class="p">)</span>
</span><span id="L-588"><a href="#L-588"><span class="linenos">588</span></a>        <span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">result</span><span class="p">,</span> <span class="n">aspect</span><span class="o">=</span><span class="s1">&#39;auto&#39;</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">cm</span><span class="o">.</span><span class="n">bone</span><span class="p">)</span>
</span><span id="L-589"><a href="#L-589"><span class="linenos">589</span></a>        <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="n">block</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="L-590"><a href="#L-590"><span class="linenos">590</span></a>
</span><span id="L-591"><a href="#L-591"><span class="linenos">591</span></a>    <span class="k">return</span> <span class="n">result</span>
</span></pre></div>


            </section>
                <section id="allowed_types">
                            <input id="allowed_types-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">allowed_types</span><span class="signature pdoc-code condensed">(<span class="return-annotation">):</span></span>

                <label class="view-source-button" for="allowed_types-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#allowed_types"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="allowed_types-17"><a href="#allowed_types-17"><span class="linenos">17</span></a><span class="k">def</span> <span class="nf">allowed_types</span><span class="p">():</span>
</span><span id="allowed_types-18"><a href="#allowed_types-18"><span class="linenos">18</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="allowed_types-19"><a href="#allowed_types-19"><span class="linenos">19</span></a><span class="sd">    Function returns list of allowed CT scan series descriptions</span>
</span><span id="allowed_types-20"><a href="#allowed_types-20"><span class="linenos">20</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="allowed_types-21"><a href="#allowed_types-21"><span class="linenos">21</span></a>    <span class="k">return</span> <span class="p">[</span><span class="s1">&#39;Head  3.0  MPR&#39;</span><span class="p">]</span>
</span></pre></div>


            <div class="docstring"><p>Function returns list of allowed CT scan series descriptions</p>
</div>


                </section>
                <section id="normalize">
                            <input id="normalize-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">normalize</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">data</span><span class="p">:</span> <span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="normalize-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#normalize"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="normalize-24"><a href="#normalize-24"><span class="linenos">24</span></a><span class="k">def</span> <span class="nf">normalize</span><span class="p">(</span><span class="n">data</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">):</span>
</span><span id="normalize-25"><a href="#normalize-25"><span class="linenos">25</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="normalize-26"><a href="#normalize-26"><span class="linenos">26</span></a><span class="sd">    Function normalizes given data to min-max scale</span>
</span><span id="normalize-27"><a href="#normalize-27"><span class="linenos">27</span></a><span class="sd">    </span>
</span><span id="normalize-28"><a href="#normalize-28"><span class="linenos">28</span></a><span class="sd">    :param data: Numpy array data</span>
</span><span id="normalize-29"><a href="#normalize-29"><span class="linenos">29</span></a><span class="sd">    :return: 0-k scaled numpy array data</span>
</span><span id="normalize-30"><a href="#normalize-30"><span class="linenos">30</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="normalize-31"><a href="#normalize-31"><span class="linenos">31</span></a>    <span class="k">return</span> <span class="p">(</span><span class="n">data</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">data</span><span class="p">))</span> <span class="o">/</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">data</span><span class="p">)</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">data</span><span class="p">))</span>
</span></pre></div>


            <div class="docstring"><p>Function normalizes given data to min-max scale</p>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>data</strong>:  Numpy array data</li>
</ul>

<h6 id="returns">Returns</h6>

<blockquote>
  <p>0-k scaled numpy array data</p>
</blockquote>
</div>


                </section>
                <section id="transform_to_hu">
                            <input id="transform_to_hu-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">transform_to_hu</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="n">dicom_data</span><span class="p">:</span> <span class="n">pydicom</span><span class="o">.</span><span class="n">dataset</span><span class="o">.</span><span class="n">FileDataset</span>,</span><span class="param">	<span class="n">slope</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">intercept</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="kc">None</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="transform_to_hu-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#transform_to_hu"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="transform_to_hu-34"><a href="#transform_to_hu-34"><span class="linenos">34</span></a><span class="k">def</span> <span class="nf">transform_to_hu</span><span class="p">(</span><span class="n">dicom_data</span><span class="p">:</span> <span class="n">pdcm</span><span class="o">.</span><span class="n">dataset</span><span class="o">.</span><span class="n">FileDataset</span><span class="p">,</span>
</span><span id="transform_to_hu-35"><a href="#transform_to_hu-35"><span class="linenos">35</span></a>                    <span class="n">slope</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="transform_to_hu-36"><a href="#transform_to_hu-36"><span class="linenos">36</span></a>                    <span class="n">intercept</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
</span><span id="transform_to_hu-37"><a href="#transform_to_hu-37"><span class="linenos">37</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="transform_to_hu-38"><a href="#transform_to_hu-38"><span class="linenos">38</span></a><span class="sd">    Function transforms DICOM data (Digital Imaging and Communication in Medicine)</span>
</span><span id="transform_to_hu-39"><a href="#transform_to_hu-39"><span class="linenos">39</span></a><span class="sd">    format to Hounsfield Unit (HU) given relationship</span>
</span><span id="transform_to_hu-40"><a href="#transform_to_hu-40"><span class="linenos">40</span></a><span class="sd">    data_HU = data*slope + intercept</span>
</span><span id="transform_to_hu-41"><a href="#transform_to_hu-41"><span class="linenos">41</span></a>
</span><span id="transform_to_hu-42"><a href="#transform_to_hu-42"><span class="linenos">42</span></a><span class="sd">    :param dicom_data: Data in DICOM format</span>
</span><span id="transform_to_hu-43"><a href="#transform_to_hu-43"><span class="linenos">43</span></a><span class="sd">    :param slope: Slope value</span>
</span><span id="transform_to_hu-44"><a href="#transform_to_hu-44"><span class="linenos">44</span></a><span class="sd">    :param intercept: Intercept value</span>
</span><span id="transform_to_hu-45"><a href="#transform_to_hu-45"><span class="linenos">45</span></a><span class="sd">    :return: pixel array in HU</span>
</span><span id="transform_to_hu-46"><a href="#transform_to_hu-46"><span class="linenos">46</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="transform_to_hu-47"><a href="#transform_to_hu-47"><span class="linenos">47</span></a>    <span class="k">if</span> <span class="n">slope</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="transform_to_hu-48"><a href="#transform_to_hu-48"><span class="linenos">48</span></a>        <span class="n">slope</span> <span class="o">=</span> <span class="n">dicom_data</span><span class="o">.</span><span class="n">RescaleSlope</span>
</span><span id="transform_to_hu-49"><a href="#transform_to_hu-49"><span class="linenos">49</span></a>
</span><span id="transform_to_hu-50"><a href="#transform_to_hu-50"><span class="linenos">50</span></a>    <span class="k">if</span> <span class="n">intercept</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="transform_to_hu-51"><a href="#transform_to_hu-51"><span class="linenos">51</span></a>        <span class="n">intercept</span> <span class="o">=</span> <span class="n">dicom_data</span><span class="o">.</span><span class="n">RescaleIntercept</span>
</span><span id="transform_to_hu-52"><a href="#transform_to_hu-52"><span class="linenos">52</span></a>
</span><span id="transform_to_hu-53"><a href="#transform_to_hu-53"><span class="linenos">53</span></a>    <span class="k">return</span> <span class="n">dicom_data</span><span class="o">.</span><span class="n">pixel_array</span> <span class="o">*</span> <span class="n">slope</span> <span class="o">+</span> <span class="n">intercept</span>
</span></pre></div>


            <div class="docstring"><p>Function transforms DICOM data (Digital Imaging and Communication in Medicine)
format to Hounsfield Unit (HU) given relationship
data_HU = data*slope + intercept</p>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>dicom_data</strong>:  Data in DICOM format</li>
<li><strong>slope</strong>:  Slope value</li>
<li><strong>intercept</strong>:  Intercept value</li>
</ul>

<h6 id="returns">Returns</h6>

<blockquote>
  <p>pixel array in HU</p>
</blockquote>
</div>


                </section>
                <section id="filter_data">
                            <input id="filter_data-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">filter_data</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">data</span>, </span><span class="param"><span class="n">show_diff</span><span class="o">=</span><span class="kc">False</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="filter_data-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#filter_data"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="filter_data-56"><a href="#filter_data-56"><span class="linenos"> 56</span></a><span class="k">def</span> <span class="nf">filter_data</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">show_diff</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
</span><span id="filter_data-57"><a href="#filter_data-57"><span class="linenos"> 57</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="filter_data-58"><a href="#filter_data-58"><span class="linenos"> 58</span></a><span class="sd">    Function sets every pixel value beyond given threshold to 0 (default backgrond value)</span>
</span><span id="filter_data-59"><a href="#filter_data-59"><span class="linenos"> 59</span></a><span class="sd">    Thresholds are listed below in the table</span>
</span><span id="filter_data-60"><a href="#filter_data-60"><span class="linenos"> 60</span></a><span class="sd">    Afterwards using erosion and dilation redundant parts are removed (such as ears e.g.)</span>
</span><span id="filter_data-61"><a href="#filter_data-61"><span class="linenos"> 61</span></a>
</span><span id="filter_data-62"><a href="#filter_data-62"><span class="linenos"> 62</span></a><span class="sd">    Table values are based on data normalization</span>
</span><span id="filter_data-63"><a href="#filter_data-63"><span class="linenos"> 63</span></a>
</span><span id="filter_data-64"><a href="#filter_data-64"><span class="linenos"> 64</span></a><span class="sd">    |----------------------|-----------------------|</span>
</span><span id="filter_data-65"><a href="#filter_data-65"><span class="linenos"> 65</span></a>
</span><span id="filter_data-66"><a href="#filter_data-66"><span class="linenos"> 66</span></a><span class="sd">    | Bone     80  (Max)   | Brain   +-50          |</span>
</span><span id="filter_data-67"><a href="#filter_data-67"><span class="linenos"> 67</span></a><span class="sd">    | Vacuum   0   (Min)   |                       |</span>
</span><span id="filter_data-68"><a href="#filter_data-68"><span class="linenos"> 68</span></a><span class="sd">    | Water    18          |                       |</span>
</span><span id="filter_data-69"><a href="#filter_data-69"><span class="linenos"> 69</span></a>
</span><span id="filter_data-70"><a href="#filter_data-70"><span class="linenos"> 70</span></a><span class="sd">    |----------------------|-----------------------|</span>
</span><span id="filter_data-71"><a href="#filter_data-71"><span class="linenos"> 71</span></a>
</span><span id="filter_data-72"><a href="#filter_data-72"><span class="linenos"> 72</span></a><span class="sd">    :param data: CT scan data array in HU</span>
</span><span id="filter_data-73"><a href="#filter_data-73"><span class="linenos"> 73</span></a><span class="sd">    :param threshold: Threshold beyond to filter out</span>
</span><span id="filter_data-74"><a href="#filter_data-74"><span class="linenos"> 74</span></a><span class="sd">    :param show_diff: True/False (debug parameter) - if true result is shown</span>
</span><span id="filter_data-75"><a href="#filter_data-75"><span class="linenos"> 75</span></a><span class="sd">    :return: Filtered out data</span>
</span><span id="filter_data-76"><a href="#filter_data-76"><span class="linenos"> 76</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="filter_data-77"><a href="#filter_data-77"><span class="linenos"> 77</span></a>    <span class="n">filter_values</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;bone&#39;</span><span class="p">:</span> <span class="mi">80</span><span class="p">,</span> <span class="s1">&#39;vacuum&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;water&#39;</span><span class="p">:</span> <span class="mi">18</span><span class="p">,</span> <span class="s1">&#39;brain&#39;</span><span class="p">:</span> <span class="mi">50</span><span class="p">}</span>
</span><span id="filter_data-78"><a href="#filter_data-78"><span class="linenos"> 78</span></a>    <span class="n">org_scan</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</span><span id="filter_data-79"><a href="#filter_data-79"><span class="linenos"> 79</span></a>    <span class="n">data</span><span class="p">[</span><span class="n">data</span> <span class="o">&gt;=</span> <span class="n">filter_values</span><span class="p">[</span><span class="s1">&#39;bone&#39;</span><span class="p">]]</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="filter_data-80"><a href="#filter_data-80"><span class="linenos"> 80</span></a>    <span class="n">data</span><span class="p">[</span><span class="n">data</span> <span class="o">&lt;=</span> <span class="n">filter_values</span><span class="p">[</span><span class="s1">&#39;water&#39;</span><span class="p">]]</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="filter_data-81"><a href="#filter_data-81"><span class="linenos"> 81</span></a>
</span><span id="filter_data-82"><a href="#filter_data-82"><span class="linenos"> 82</span></a>    <span class="n">labels</span><span class="p">,</span> <span class="n">label_nb</span> <span class="o">=</span> <span class="n">sp</span><span class="o">.</span><span class="n">ndimage</span><span class="o">.</span><span class="n">label</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
</span><span id="filter_data-83"><a href="#filter_data-83"><span class="linenos"> 83</span></a>    <span class="n">label_count</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">bincount</span><span class="p">(</span><span class="n">labels</span><span class="o">.</span><span class="n">ravel</span><span class="p">()</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">))</span>
</span><span id="filter_data-84"><a href="#filter_data-84"><span class="linenos"> 84</span></a>    <span class="n">label_count</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="filter_data-85"><a href="#filter_data-85"><span class="linenos"> 85</span></a>
</span><span id="filter_data-86"><a href="#filter_data-86"><span class="linenos"> 86</span></a>    <span class="n">mask</span> <span class="o">=</span> <span class="n">labels</span> <span class="o">==</span> <span class="n">label_count</span><span class="o">.</span><span class="n">argmax</span><span class="p">()</span>
</span><span id="filter_data-87"><a href="#filter_data-87"><span class="linenos"> 87</span></a>
</span><span id="filter_data-88"><a href="#filter_data-88"><span class="linenos"> 88</span></a>    <span class="c1"># mask = skimage.morphology.erosion(mask, np.ones((3, 3)))</span>
</span><span id="filter_data-89"><a href="#filter_data-89"><span class="linenos"> 89</span></a>    <span class="n">mask</span> <span class="o">=</span> <span class="n">skimage</span><span class="o">.</span><span class="n">morphology</span><span class="o">.</span><span class="n">erosion</span><span class="p">(</span><span class="n">mask</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">((</span><span class="mi">4</span><span class="p">,</span> <span class="mi">4</span><span class="p">)))</span>
</span><span id="filter_data-90"><a href="#filter_data-90"><span class="linenos"> 90</span></a>
</span><span id="filter_data-91"><a href="#filter_data-91"><span class="linenos"> 91</span></a>    <span class="c1"># @TODO - dilataciu mozno prec</span>
</span><span id="filter_data-92"><a href="#filter_data-92"><span class="linenos"> 92</span></a>    <span class="n">mask</span> <span class="o">=</span> <span class="n">skimage</span><span class="o">.</span><span class="n">morphology</span><span class="o">.</span><span class="n">dilation</span><span class="p">(</span><span class="n">mask</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">((</span><span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">)))</span>
</span><span id="filter_data-93"><a href="#filter_data-93"><span class="linenos"> 93</span></a>
</span><span id="filter_data-94"><a href="#filter_data-94"><span class="linenos"> 94</span></a>    <span class="n">res</span> <span class="o">=</span> <span class="n">mask</span> <span class="o">*</span> <span class="n">data</span>
</span><span id="filter_data-95"><a href="#filter_data-95"><span class="linenos"> 95</span></a>
</span><span id="filter_data-96"><a href="#filter_data-96"><span class="linenos"> 96</span></a>    <span class="k">if</span> <span class="n">show_diff</span><span class="p">:</span>
</span><span id="filter_data-97"><a href="#filter_data-97"><span class="linenos"> 97</span></a>        <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">[</span><span class="mi">8</span><span class="p">,</span> <span class="mi">8</span><span class="p">])</span>
</span><span id="filter_data-98"><a href="#filter_data-98"><span class="linenos"> 98</span></a>        <span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Original scan&#39;</span><span class="p">)</span>
</span><span id="filter_data-99"><a href="#filter_data-99"><span class="linenos"> 99</span></a>        <span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">org_scan</span><span class="p">,</span> <span class="n">aspect</span><span class="o">=</span><span class="s1">&#39;auto&#39;</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">cm</span><span class="o">.</span><span class="n">bone</span><span class="p">)</span>
</span><span id="filter_data-100"><a href="#filter_data-100"><span class="linenos">100</span></a>
</span><span id="filter_data-101"><a href="#filter_data-101"><span class="linenos">101</span></a>        <span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Filtered out scan&#39;</span><span class="p">)</span>
</span><span id="filter_data-102"><a href="#filter_data-102"><span class="linenos">102</span></a>        <span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">res</span><span class="p">,</span> <span class="n">aspect</span><span class="o">=</span><span class="s1">&#39;auto&#39;</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">cm</span><span class="o">.</span><span class="n">bone</span><span class="p">)</span>
</span><span id="filter_data-103"><a href="#filter_data-103"><span class="linenos">103</span></a>        <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="n">block</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="filter_data-104"><a href="#filter_data-104"><span class="linenos">104</span></a>
</span><span id="filter_data-105"><a href="#filter_data-105"><span class="linenos">105</span></a>    <span class="k">return</span> <span class="n">res</span>
</span></pre></div>


            <div class="docstring"><p>Function sets every pixel value beyond given threshold to 0 (default backgrond value)
Thresholds are listed below in the table
Afterwards using erosion and dilation redundant parts are removed (such as ears e.g.)</p>

<p>Table values are based on data normalization</p>

<p>|----------------------|-----------------------|</p>

<p>| Bone     80  (Max)   | Brain   +-50          |
| Vacuum   0   (Min)   |                       |
| Water    18          |                       |</p>

<p>|----------------------|-----------------------|</p>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>data</strong>:  CT scan data array in HU</li>
<li><strong>threshold</strong>:  Threshold beyond to filter out</li>
<li><strong>show_diff</strong>:  True/False (debug parameter) - if true result is shown</li>
</ul>

<h6 id="returns">Returns</h6>

<blockquote>
  <p>Filtered out data</p>
</blockquote>
</div>


                </section>
                <section id="thresholding">
                            <input id="thresholding-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">thresholding</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">data</span><span class="p">:</span> <span class="n">Any</span>, </span><span class="param"><span class="n">show_diff</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>, </span><span class="param"><span class="n">save</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="thresholding-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#thresholding"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="thresholding-108"><a href="#thresholding-108"><span class="linenos">108</span></a><span class="k">def</span> <span class="nf">thresholding</span><span class="p">(</span><span class="n">data</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span>
</span><span id="thresholding-109"><a href="#thresholding-109"><span class="linenos">109</span></a>                 <span class="n">show_diff</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="thresholding-110"><a href="#thresholding-110"><span class="linenos">110</span></a>                 <span class="n">save</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">):</span>
</span><span id="thresholding-111"><a href="#thresholding-111"><span class="linenos">111</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="thresholding-112"><a href="#thresholding-112"><span class="linenos">112</span></a><span class="sd">    Function does thresholding of the CT image to remove very bright pixels;</span>
</span><span id="thresholding-113"><a href="#thresholding-113"><span class="linenos">113</span></a><span class="sd">    pixels &gt; 100 (bone) to 100 and all</span>
</span><span id="thresholding-114"><a href="#thresholding-114"><span class="linenos">114</span></a><span class="sd">    pixels &lt; 0 (background) to value 0</span>
</span><span id="thresholding-115"><a href="#thresholding-115"><span class="linenos">115</span></a><span class="sd">    (original scan max value is approx. 1000 and min value -1000)</span>
</span><span id="thresholding-116"><a href="#thresholding-116"><span class="linenos">116</span></a>
</span><span id="thresholding-117"><a href="#thresholding-117"><span class="linenos">117</span></a><span class="sd">    Afterwards all pixels are divided by 100 - this can be considered as a data normalization</span>
</span><span id="thresholding-118"><a href="#thresholding-118"><span class="linenos">118</span></a><span class="sd">    </span>
</span><span id="thresholding-119"><a href="#thresholding-119"><span class="linenos">119</span></a><span class="sd">    :param data: CT scan data array in HU</span>
</span><span id="thresholding-120"><a href="#thresholding-120"><span class="linenos">120</span></a><span class="sd">    :param show_diff: True/False (debug parameter) - if true result is shown</span>
</span><span id="thresholding-121"><a href="#thresholding-121"><span class="linenos">121</span></a><span class="sd">    :param save: True/False - if true result scan is saved </span>
</span><span id="thresholding-122"><a href="#thresholding-122"><span class="linenos">122</span></a><span class="sd">    :return: threshold data in range (0-1)</span>
</span><span id="thresholding-123"><a href="#thresholding-123"><span class="linenos">123</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="thresholding-124"><a href="#thresholding-124"><span class="linenos">124</span></a>    <span class="n">org_scan</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</span><span id="thresholding-125"><a href="#thresholding-125"><span class="linenos">125</span></a>
</span><span id="thresholding-126"><a href="#thresholding-126"><span class="linenos">126</span></a>    <span class="c1"># Set pixel values range from 0 to 100</span>
</span><span id="thresholding-127"><a href="#thresholding-127"><span class="linenos">127</span></a>    <span class="n">data</span><span class="p">[</span><span class="n">data</span> <span class="o">&gt;</span> <span class="mi">100</span><span class="p">]</span> <span class="o">=</span> <span class="mi">100</span>
</span><span id="thresholding-128"><a href="#thresholding-128"><span class="linenos">128</span></a>    <span class="n">data</span><span class="p">[</span><span class="n">data</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="thresholding-129"><a href="#thresholding-129"><span class="linenos">129</span></a>
</span><span id="thresholding-130"><a href="#thresholding-130"><span class="linenos">130</span></a>    <span class="n">data</span> <span class="o">=</span> <span class="n">data</span> <span class="o">/</span> <span class="mi">100</span>
</span><span id="thresholding-131"><a href="#thresholding-131"><span class="linenos">131</span></a>
</span><span id="thresholding-132"><a href="#thresholding-132"><span class="linenos">132</span></a>    <span class="k">if</span> <span class="n">save</span><span class="p">:</span>
</span><span id="thresholding-133"><a href="#thresholding-133"><span class="linenos">133</span></a>        <span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
</span><span id="thresholding-134"><a href="#thresholding-134"><span class="linenos">134</span></a>
</span><span id="thresholding-135"><a href="#thresholding-135"><span class="linenos">135</span></a>        <span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">aspect</span><span class="o">=</span><span class="s1">&#39;auto&#39;</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">cm</span><span class="o">.</span><span class="n">bone</span><span class="p">)</span>
</span><span id="thresholding-136"><a href="#thresholding-136"><span class="linenos">136</span></a>        <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;threshold scan&#39;</span><span class="p">)</span>
</span><span id="thresholding-137"><a href="#thresholding-137"><span class="linenos">137</span></a>
</span><span id="thresholding-138"><a href="#thresholding-138"><span class="linenos">138</span></a>        <span class="c1"># plt.show(block=True)</span>
</span><span id="thresholding-139"><a href="#thresholding-139"><span class="linenos">139</span></a>        <span class="n">i</span> <span class="o">=</span> <span class="mi">1</span>
</span><span id="thresholding-140"><a href="#thresholding-140"><span class="linenos">140</span></a>        <span class="k">while</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="s2">&quot;threshold_</span><span class="si">%d</span><span class="s2">.png&quot;</span> <span class="o">%</span> <span class="n">i</span><span class="p">):</span>
</span><span id="thresholding-141"><a href="#thresholding-141"><span class="linenos">141</span></a>            <span class="n">i</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="thresholding-142"><a href="#thresholding-142"><span class="linenos">142</span></a>        <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;./images/thresholding/threshold_</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s1">.png&#39;</span><span class="p">)</span>
</span><span id="thresholding-143"><a href="#thresholding-143"><span class="linenos">143</span></a>
</span><span id="thresholding-144"><a href="#thresholding-144"><span class="linenos">144</span></a>    <span class="k">if</span> <span class="n">show_diff</span><span class="p">:</span>
</span><span id="thresholding-145"><a href="#thresholding-145"><span class="linenos">145</span></a>        <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">[</span><span class="mi">8</span><span class="p">,</span> <span class="mi">8</span><span class="p">])</span>
</span><span id="thresholding-146"><a href="#thresholding-146"><span class="linenos">146</span></a>        <span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Before threshold scan&#39;</span><span class="p">)</span>
</span><span id="thresholding-147"><a href="#thresholding-147"><span class="linenos">147</span></a>        <span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">org_scan</span><span class="p">,</span> <span class="n">aspect</span><span class="o">=</span><span class="s1">&#39;auto&#39;</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">cm</span><span class="o">.</span><span class="n">bone</span><span class="p">)</span>
</span><span id="thresholding-148"><a href="#thresholding-148"><span class="linenos">148</span></a>
</span><span id="thresholding-149"><a href="#thresholding-149"><span class="linenos">149</span></a>        <span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;After threshold scan&#39;</span><span class="p">)</span>
</span><span id="thresholding-150"><a href="#thresholding-150"><span class="linenos">150</span></a>        <span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">aspect</span><span class="o">=</span><span class="s1">&#39;auto&#39;</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">cm</span><span class="o">.</span><span class="n">bone</span><span class="p">)</span>
</span><span id="thresholding-151"><a href="#thresholding-151"><span class="linenos">151</span></a>
</span><span id="thresholding-152"><a href="#thresholding-152"><span class="linenos">152</span></a>        <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="n">block</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="thresholding-153"><a href="#thresholding-153"><span class="linenos">153</span></a>    <span class="k">return</span> <span class="n">data</span>
</span></pre></div>


            <div class="docstring"><p>Function does thresholding of the CT image to remove very bright pixels;
pixels &gt; 100 (bone) to 100 and all
pixels &lt; 0 (background) to value 0
(original scan max value is approx. 1000 and min value -1000)</p>

<p>Afterwards all pixels are divided by 100 - this can be considered as a data normalization</p>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>data</strong>:  CT scan data array in HU</li>
<li><strong>show_diff</strong>:  True/False (debug parameter) - if true result is shown</li>
<li><strong>save</strong>:  True/False - if true result scan is saved </li>
</ul>

<h6 id="returns">Returns</h6>

<blockquote>
  <p>threshold data in range (0-1)</p>
</blockquote>
</div>


                </section>
                <section id="median_filter">
                            <input id="median_filter-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">median_filter</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="n">data</span><span class="p">:</span> <span class="n">Any</span>,</span><span class="param">	<span class="n">mat</span><span class="p">:</span> <span class="nb">tuple</span> <span class="o">=</span> <span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>,</span><span class="param">	<span class="n">show_diff</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>,</span><span class="param">	<span class="n">save</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="median_filter-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#median_filter"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="median_filter-156"><a href="#median_filter-156"><span class="linenos">156</span></a><span class="k">def</span> <span class="nf">median_filter</span><span class="p">(</span><span class="n">data</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span>
</span><span id="median_filter-157"><a href="#median_filter-157"><span class="linenos">157</span></a>                  <span class="n">mat</span><span class="p">:</span> <span class="nb">tuple</span> <span class="o">=</span> <span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">),</span>
</span><span id="median_filter-158"><a href="#median_filter-158"><span class="linenos">158</span></a>                  <span class="n">show_diff</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="median_filter-159"><a href="#median_filter-159"><span class="linenos">159</span></a>                  <span class="n">save</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">):</span>
</span><span id="median_filter-160"><a href="#median_filter-160"><span class="linenos">160</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="median_filter-161"><a href="#median_filter-161"><span class="linenos">161</span></a><span class="sd">    Function uses median filter to remove noise from an image (CT scan array)</span>
</span><span id="median_filter-162"><a href="#median_filter-162"><span class="linenos">162</span></a><span class="sd">    The median filter replaces each pixel&#39;s value with the median value of the neighboring pixels.</span>
</span><span id="median_filter-163"><a href="#median_filter-163"><span class="linenos">163</span></a><span class="sd">    It&#39;s effective in removing salt-and-pepper noise (randomly occurring bright or dark pixels)</span>
</span><span id="median_filter-164"><a href="#median_filter-164"><span class="linenos">164</span></a><span class="sd">    which occurs in electronic detectors.</span>
</span><span id="median_filter-165"><a href="#median_filter-165"><span class="linenos">165</span></a>
</span><span id="median_filter-166"><a href="#median_filter-166"><span class="linenos">166</span></a><span class="sd">    :param data: CT scan data array in HU</span>
</span><span id="median_filter-167"><a href="#median_filter-167"><span class="linenos">167</span></a><span class="sd">    :param mat: Filtering matrix</span>
</span><span id="median_filter-168"><a href="#median_filter-168"><span class="linenos">168</span></a><span class="sd">    :param show_diff: Boolean (debug parameter) - if true result is shown</span>
</span><span id="median_filter-169"><a href="#median_filter-169"><span class="linenos">169</span></a><span class="sd">    :param save: Boolean - if true result scan is saved</span>
</span><span id="median_filter-170"><a href="#median_filter-170"><span class="linenos">170</span></a><span class="sd">    :return: clean (without noise) data</span>
</span><span id="median_filter-171"><a href="#median_filter-171"><span class="linenos">171</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="median_filter-172"><a href="#median_filter-172"><span class="linenos">172</span></a>    <span class="n">org_scan</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</span><span id="median_filter-173"><a href="#median_filter-173"><span class="linenos">173</span></a>    <span class="n">structuring_element</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">mat</span><span class="p">)</span>
</span><span id="median_filter-174"><a href="#median_filter-174"><span class="linenos">174</span></a>    <span class="n">data</span> <span class="o">=</span> <span class="n">skimage</span><span class="o">.</span><span class="n">filters</span><span class="o">.</span><span class="n">median</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">structuring_element</span><span class="p">)</span>
</span><span id="median_filter-175"><a href="#median_filter-175"><span class="linenos">175</span></a>    <span class="k">if</span> <span class="n">save</span><span class="p">:</span>
</span><span id="median_filter-176"><a href="#median_filter-176"><span class="linenos">176</span></a>        <span class="n">morph_type</span> <span class="o">=</span> <span class="s1">&#39;median_filter&#39;</span>
</span><span id="median_filter-177"><a href="#median_filter-177"><span class="linenos">177</span></a>        <span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
</span><span id="median_filter-178"><a href="#median_filter-178"><span class="linenos">178</span></a>        <span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">aspect</span><span class="o">=</span><span class="s1">&#39;auto&#39;</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">cm</span><span class="o">.</span><span class="n">bone</span><span class="p">)</span>
</span><span id="median_filter-179"><a href="#median_filter-179"><span class="linenos">179</span></a>        <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">morph_type</span><span class="si">}</span><span class="s1"> mat=</span><span class="si">{</span><span class="n">mat</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
</span><span id="median_filter-180"><a href="#median_filter-180"><span class="linenos">180</span></a>
</span><span id="median_filter-181"><a href="#median_filter-181"><span class="linenos">181</span></a>        <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;./images/</span><span class="si">{</span><span class="n">morph_type</span><span class="si">}</span><span class="s1">/</span><span class="si">{</span><span class="n">morph_type</span><span class="si">}</span><span class="s1">_mat</span><span class="si">{</span><span class="n">mat</span><span class="si">}</span><span class="s1">.png&#39;</span><span class="p">)</span>
</span><span id="median_filter-182"><a href="#median_filter-182"><span class="linenos">182</span></a>
</span><span id="median_filter-183"><a href="#median_filter-183"><span class="linenos">183</span></a>    <span class="k">if</span> <span class="n">show_diff</span><span class="p">:</span>
</span><span id="median_filter-184"><a href="#median_filter-184"><span class="linenos">184</span></a>        <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">[</span><span class="mi">8</span><span class="p">,</span> <span class="mi">8</span><span class="p">])</span>
</span><span id="median_filter-185"><a href="#median_filter-185"><span class="linenos">185</span></a>        <span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Before median filter scan&#39;</span><span class="p">)</span>
</span><span id="median_filter-186"><a href="#median_filter-186"><span class="linenos">186</span></a>        <span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">org_scan</span><span class="p">,</span> <span class="n">aspect</span><span class="o">=</span><span class="s1">&#39;auto&#39;</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">cm</span><span class="o">.</span><span class="n">bone</span><span class="p">)</span>
</span><span id="median_filter-187"><a href="#median_filter-187"><span class="linenos">187</span></a>
</span><span id="median_filter-188"><a href="#median_filter-188"><span class="linenos">188</span></a>        <span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;After median filter scan&#39;</span><span class="p">)</span>
</span><span id="median_filter-189"><a href="#median_filter-189"><span class="linenos">189</span></a>        <span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">aspect</span><span class="o">=</span><span class="s1">&#39;auto&#39;</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">cm</span><span class="o">.</span><span class="n">bone</span><span class="p">)</span>
</span><span id="median_filter-190"><a href="#median_filter-190"><span class="linenos">190</span></a>
</span><span id="median_filter-191"><a href="#median_filter-191"><span class="linenos">191</span></a>        <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="n">block</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="median_filter-192"><a href="#median_filter-192"><span class="linenos">192</span></a>    <span class="k">return</span> <span class="n">data</span>
</span></pre></div>


            <div class="docstring"><p>Function uses median filter to remove noise from an image (CT scan array)
The median filter replaces each pixel's value with the median value of the neighboring pixels.
It's effective in removing salt-and-pepper noise (randomly occurring bright or dark pixels)
which occurs in electronic detectors.</p>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>data</strong>:  CT scan data array in HU</li>
<li><strong>mat</strong>:  Filtering matrix</li>
<li><strong>show_diff</strong>:  Boolean (debug parameter) - if true result is shown</li>
<li><strong>save</strong>:  Boolean - if true result scan is saved</li>
</ul>

<h6 id="returns">Returns</h6>

<blockquote>
  <p>clean (without noise) data</p>
</blockquote>
</div>


                </section>
                <section id="adjust_contrast">
                            <input id="adjust_contrast-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">adjust_contrast</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">data</span><span class="p">:</span> <span class="n">Any</span>, </span><span class="param"><span class="n">show_diff</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>, </span><span class="param"><span class="n">save</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="adjust_contrast-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#adjust_contrast"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="adjust_contrast-195"><a href="#adjust_contrast-195"><span class="linenos">195</span></a><span class="k">def</span> <span class="nf">adjust_contrast</span><span class="p">(</span><span class="n">data</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span>
</span><span id="adjust_contrast-196"><a href="#adjust_contrast-196"><span class="linenos">196</span></a>                    <span class="n">show_diff</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="adjust_contrast-197"><a href="#adjust_contrast-197"><span class="linenos">197</span></a>                    <span class="n">save</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">):</span>
</span><span id="adjust_contrast-198"><a href="#adjust_contrast-198"><span class="linenos">198</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="adjust_contrast-199"><a href="#adjust_contrast-199"><span class="linenos">199</span></a>
</span><span id="adjust_contrast-200"><a href="#adjust_contrast-200"><span class="linenos">200</span></a><span class="sd">    :param data: CT scan data array in HU</span>
</span><span id="adjust_contrast-201"><a href="#adjust_contrast-201"><span class="linenos">201</span></a><span class="sd">    :param show_diff: Boolean (debug parameter) - if true result is shown</span>
</span><span id="adjust_contrast-202"><a href="#adjust_contrast-202"><span class="linenos">202</span></a><span class="sd">    :param save: Boolean - if true result scan is saved</span>
</span><span id="adjust_contrast-203"><a href="#adjust_contrast-203"><span class="linenos">203</span></a><span class="sd">    :return: Image after histogram equalization</span>
</span><span id="adjust_contrast-204"><a href="#adjust_contrast-204"><span class="linenos">204</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="adjust_contrast-205"><a href="#adjust_contrast-205"><span class="linenos">205</span></a>    <span class="n">org_scan</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</span><span id="adjust_contrast-206"><a href="#adjust_contrast-206"><span class="linenos">206</span></a>
</span><span id="adjust_contrast-207"><a href="#adjust_contrast-207"><span class="linenos">207</span></a>    <span class="n">low</span><span class="p">,</span> <span class="n">high</span> <span class="o">=</span> <span class="mf">0.15</span><span class="p">,</span> <span class="mf">0.75</span>
</span><span id="adjust_contrast-208"><a href="#adjust_contrast-208"><span class="linenos">208</span></a>    <span class="n">data</span> <span class="o">=</span> <span class="n">skimage</span><span class="o">.</span><span class="n">exposure</span><span class="o">.</span><span class="n">rescale_intensity</span><span class="p">(</span><span class="n">org_scan</span><span class="p">,</span> <span class="n">in_range</span><span class="o">=</span><span class="p">(</span><span class="n">low</span><span class="p">,</span> <span class="n">high</span><span class="p">))</span>
</span><span id="adjust_contrast-209"><a href="#adjust_contrast-209"><span class="linenos">209</span></a>
</span><span id="adjust_contrast-210"><a href="#adjust_contrast-210"><span class="linenos">210</span></a>    <span class="k">if</span> <span class="n">save</span><span class="p">:</span>
</span><span id="adjust_contrast-211"><a href="#adjust_contrast-211"><span class="linenos">211</span></a>        <span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
</span><span id="adjust_contrast-212"><a href="#adjust_contrast-212"><span class="linenos">212</span></a>        <span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">aspect</span><span class="o">=</span><span class="s1">&#39;auto&#39;</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">cm</span><span class="o">.</span><span class="n">bone</span><span class="p">)</span>
</span><span id="adjust_contrast-213"><a href="#adjust_contrast-213"><span class="linenos">213</span></a>        <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Contrast adjustment&#39;</span><span class="p">)</span>
</span><span id="adjust_contrast-214"><a href="#adjust_contrast-214"><span class="linenos">214</span></a>
</span><span id="adjust_contrast-215"><a href="#adjust_contrast-215"><span class="linenos">215</span></a>        <span class="n">i</span> <span class="o">=</span> <span class="mi">1</span>
</span><span id="adjust_contrast-216"><a href="#adjust_contrast-216"><span class="linenos">216</span></a>        <span class="k">while</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="s2">&quot;threshold_</span><span class="si">%d</span><span class="s2">.png&quot;</span> <span class="o">%</span> <span class="n">i</span><span class="p">):</span>
</span><span id="adjust_contrast-217"><a href="#adjust_contrast-217"><span class="linenos">217</span></a>            <span class="n">i</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="adjust_contrast-218"><a href="#adjust_contrast-218"><span class="linenos">218</span></a>        <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;./images/contrast/contrast_</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s1">.png&#39;</span><span class="p">)</span>
</span><span id="adjust_contrast-219"><a href="#adjust_contrast-219"><span class="linenos">219</span></a>
</span><span id="adjust_contrast-220"><a href="#adjust_contrast-220"><span class="linenos">220</span></a>    <span class="k">if</span> <span class="n">show_diff</span><span class="p">:</span>
</span><span id="adjust_contrast-221"><a href="#adjust_contrast-221"><span class="linenos">221</span></a>        <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">[</span><span class="mi">8</span><span class="p">,</span> <span class="mi">8</span><span class="p">])</span>
</span><span id="adjust_contrast-222"><a href="#adjust_contrast-222"><span class="linenos">222</span></a>        <span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Before contrast adjustment scan&#39;</span><span class="p">)</span>
</span><span id="adjust_contrast-223"><a href="#adjust_contrast-223"><span class="linenos">223</span></a>        <span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">org_scan</span><span class="p">,</span> <span class="n">aspect</span><span class="o">=</span><span class="s1">&#39;auto&#39;</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">cm</span><span class="o">.</span><span class="n">bone</span><span class="p">)</span>
</span><span id="adjust_contrast-224"><a href="#adjust_contrast-224"><span class="linenos">224</span></a>
</span><span id="adjust_contrast-225"><a href="#adjust_contrast-225"><span class="linenos">225</span></a>        <span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;After contrast adjustment scan&#39;</span><span class="p">)</span>
</span><span id="adjust_contrast-226"><a href="#adjust_contrast-226"><span class="linenos">226</span></a>        <span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">aspect</span><span class="o">=</span><span class="s1">&#39;auto&#39;</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">cm</span><span class="o">.</span><span class="n">bone</span><span class="p">)</span>
</span><span id="adjust_contrast-227"><a href="#adjust_contrast-227"><span class="linenos">227</span></a>
</span><span id="adjust_contrast-228"><a href="#adjust_contrast-228"><span class="linenos">228</span></a>        <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="n">block</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="adjust_contrast-229"><a href="#adjust_contrast-229"><span class="linenos">229</span></a>    <span class="k">return</span> <span class="n">data</span>
</span></pre></div>


            <div class="docstring"><h6 id="parameters">Parameters</h6>

<ul>
<li><strong>data</strong>:  CT scan data array in HU</li>
<li><strong>show_diff</strong>:  Boolean (debug parameter) - if true result is shown</li>
<li><strong>save</strong>:  Boolean - if true result scan is saved</li>
</ul>

<h6 id="returns">Returns</h6>

<blockquote>
  <p>Image after histogram equalization</p>
</blockquote>
</div>


                </section>
                <section id="clear_data">
                            <input id="clear_data-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">clear_data</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">data</span>, </span><span class="param"><span class="n">dil_mat</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span>, </span><span class="param"><span class="n">show_diff</span><span class="o">=</span><span class="kc">False</span>, </span><span class="param"><span class="n">save</span><span class="o">=</span><span class="kc">False</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="clear_data-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#clear_data"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="clear_data-232"><a href="#clear_data-232"><span class="linenos">232</span></a><span class="k">def</span> <span class="nf">clear_data</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">dil_mat</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">10</span><span class="p">),</span> <span class="n">show_diff</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">save</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
</span><span id="clear_data-233"><a href="#clear_data-233"><span class="linenos">233</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="clear_data-234"><a href="#clear_data-234"><span class="linenos">234</span></a><span class="sd">    Function filters out noise in scan, it sets all</span>
</span><span id="clear_data-235"><a href="#clear_data-235"><span class="linenos">235</span></a><span class="sd">    pixels &gt; 100 (bone) to 100 and all</span>
</span><span id="clear_data-236"><a href="#clear_data-236"><span class="linenos">236</span></a><span class="sd">    pixels &lt; 0 (background) to value 0</span>
</span><span id="clear_data-237"><a href="#clear_data-237"><span class="linenos">237</span></a><span class="sd">    (original scan max value is approx. 1000 and min value -1000)</span>
</span><span id="clear_data-238"><a href="#clear_data-238"><span class="linenos">238</span></a><span class="sd">    </span>
</span><span id="clear_data-239"><a href="#clear_data-239"><span class="linenos">239</span></a><span class="sd">    :param data: CT scan data array in HU</span>
</span><span id="clear_data-240"><a href="#clear_data-240"><span class="linenos">240</span></a><span class="sd">    :param dil_mat: Dilation matrix of shape (N x N)</span>
</span><span id="clear_data-241"><a href="#clear_data-241"><span class="linenos">241</span></a><span class="sd">    :param show_diff: True/False (debug parameter) - if true result is shown</span>
</span><span id="clear_data-242"><a href="#clear_data-242"><span class="linenos">242</span></a><span class="sd">    :param save: True/False - if true result scan is saved </span>
</span><span id="clear_data-243"><a href="#clear_data-243"><span class="linenos">243</span></a><span class="sd">    :return: clean (without noise) data</span>
</span><span id="clear_data-244"><a href="#clear_data-244"><span class="linenos">244</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="clear_data-245"><a href="#clear_data-245"><span class="linenos">245</span></a>    <span class="n">org_scan</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</span><span id="clear_data-246"><a href="#clear_data-246"><span class="linenos">246</span></a>
</span><span id="clear_data-247"><a href="#clear_data-247"><span class="linenos">247</span></a>    <span class="c1"># Set pixel values range from 0 to 100</span>
</span><span id="clear_data-248"><a href="#clear_data-248"><span class="linenos">248</span></a>    <span class="n">data</span><span class="p">[</span><span class="n">data</span> <span class="o">&gt;</span> <span class="mi">100</span><span class="p">]</span> <span class="o">=</span> <span class="mi">100</span>
</span><span id="clear_data-249"><a href="#clear_data-249"><span class="linenos">249</span></a>    <span class="n">data</span><span class="p">[</span><span class="n">data</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="clear_data-250"><a href="#clear_data-250"><span class="linenos">250</span></a>
</span><span id="clear_data-251"><a href="#clear_data-251"><span class="linenos">251</span></a>    <span class="n">segmentation</span> <span class="o">=</span> <span class="n">skimage</span><span class="o">.</span><span class="n">morphology</span><span class="o">.</span><span class="n">dilation</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">dil_mat</span><span class="p">))</span>
</span><span id="clear_data-252"><a href="#clear_data-252"><span class="linenos">252</span></a>
</span><span id="clear_data-253"><a href="#clear_data-253"><span class="linenos">253</span></a>    <span class="n">labels</span><span class="p">,</span> <span class="n">label_nb</span> <span class="o">=</span> <span class="n">sp</span><span class="o">.</span><span class="n">ndimage</span><span class="o">.</span><span class="n">label</span><span class="p">(</span><span class="n">segmentation</span><span class="p">)</span>
</span><span id="clear_data-254"><a href="#clear_data-254"><span class="linenos">254</span></a>    <span class="n">label_count</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">bincount</span><span class="p">(</span><span class="n">labels</span><span class="o">.</span><span class="n">ravel</span><span class="p">()</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">))</span>
</span><span id="clear_data-255"><a href="#clear_data-255"><span class="linenos">255</span></a>    <span class="n">label_count</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="clear_data-256"><a href="#clear_data-256"><span class="linenos">256</span></a>
</span><span id="clear_data-257"><a href="#clear_data-257"><span class="linenos">257</span></a>    <span class="c1"># mask = labels == label_count.argmax()</span>
</span><span id="clear_data-258"><a href="#clear_data-258"><span class="linenos">258</span></a>    <span class="c1"># mask = skimage.morphology.dilation(mask, np.ones(dil_mat))</span>
</span><span id="clear_data-259"><a href="#clear_data-259"><span class="linenos">259</span></a>    <span class="c1"># mask = sp.ndimage.morphology.binary_fill_holes(mask)</span>
</span><span id="clear_data-260"><a href="#clear_data-260"><span class="linenos">260</span></a>    <span class="c1"># mask = skimage.morphology.dilation(mask, np.ones(dil_mat))</span>
</span><span id="clear_data-261"><a href="#clear_data-261"><span class="linenos">261</span></a>
</span><span id="clear_data-262"><a href="#clear_data-262"><span class="linenos">262</span></a>    <span class="n">data</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">erode</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">dil_mat</span><span class="p">))</span>
</span><span id="clear_data-263"><a href="#clear_data-263"><span class="linenos">263</span></a>    <span class="n">mask</span> <span class="o">=</span> <span class="mi">1</span>
</span><span id="clear_data-264"><a href="#clear_data-264"><span class="linenos">264</span></a>
</span><span id="clear_data-265"><a href="#clear_data-265"><span class="linenos">265</span></a>    <span class="k">if</span> <span class="n">save</span><span class="p">:</span>
</span><span id="clear_data-266"><a href="#clear_data-266"><span class="linenos">266</span></a>        <span class="n">morph_type</span> <span class="o">=</span> <span class="s1">&#39;dilation&#39;</span>
</span><span id="clear_data-267"><a href="#clear_data-267"><span class="linenos">267</span></a>        <span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
</span><span id="clear_data-268"><a href="#clear_data-268"><span class="linenos">268</span></a>
</span><span id="clear_data-269"><a href="#clear_data-269"><span class="linenos">269</span></a>        <span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">mask</span> <span class="o">*</span> <span class="n">data</span><span class="p">,</span> <span class="n">aspect</span><span class="o">=</span><span class="s1">&#39;auto&#39;</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">cm</span><span class="o">.</span><span class="n">bone</span><span class="p">)</span>
</span><span id="clear_data-270"><a href="#clear_data-270"><span class="linenos">270</span></a>        <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">morph_type</span><span class="si">}</span><span class="s1"> mat=</span><span class="si">{</span><span class="n">dil_mat</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
</span><span id="clear_data-271"><a href="#clear_data-271"><span class="linenos">271</span></a>
</span><span id="clear_data-272"><a href="#clear_data-272"><span class="linenos">272</span></a>        <span class="c1"># plt.show(block=True)</span>
</span><span id="clear_data-273"><a href="#clear_data-273"><span class="linenos">273</span></a>        <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;./images/</span><span class="si">{</span><span class="n">morph_type</span><span class="si">}</span><span class="s1">/</span><span class="si">{</span><span class="n">morph_type</span><span class="si">}</span><span class="s1">_mat</span><span class="si">{</span><span class="n">dil_mat</span><span class="si">}</span><span class="s1">.png&#39;</span><span class="p">)</span>
</span><span id="clear_data-274"><a href="#clear_data-274"><span class="linenos">274</span></a>
</span><span id="clear_data-275"><a href="#clear_data-275"><span class="linenos">275</span></a>    <span class="k">if</span> <span class="n">show_diff</span><span class="p">:</span>
</span><span id="clear_data-276"><a href="#clear_data-276"><span class="linenos">276</span></a>        <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">[</span><span class="mi">8</span><span class="p">,</span> <span class="mi">8</span><span class="p">])</span>
</span><span id="clear_data-277"><a href="#clear_data-277"><span class="linenos">277</span></a>        <span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Noisy scan&#39;</span><span class="p">)</span>
</span><span id="clear_data-278"><a href="#clear_data-278"><span class="linenos">278</span></a>        <span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">org_scan</span><span class="p">,</span> <span class="n">aspect</span><span class="o">=</span><span class="s1">&#39;auto&#39;</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">cm</span><span class="o">.</span><span class="n">bone</span><span class="p">)</span>
</span><span id="clear_data-279"><a href="#clear_data-279"><span class="linenos">279</span></a>
</span><span id="clear_data-280"><a href="#clear_data-280"><span class="linenos">280</span></a>        <span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Clean scan&#39;</span><span class="p">)</span>
</span><span id="clear_data-281"><a href="#clear_data-281"><span class="linenos">281</span></a>        <span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">mask</span> <span class="o">*</span> <span class="n">data</span><span class="p">,</span> <span class="n">aspect</span><span class="o">=</span><span class="s1">&#39;auto&#39;</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">cm</span><span class="o">.</span><span class="n">bone</span><span class="p">)</span>
</span><span id="clear_data-282"><a href="#clear_data-282"><span class="linenos">282</span></a>
</span><span id="clear_data-283"><a href="#clear_data-283"><span class="linenos">283</span></a>        <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="n">block</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="clear_data-284"><a href="#clear_data-284"><span class="linenos">284</span></a>    <span class="k">return</span> <span class="n">mask</span> <span class="o">*</span> <span class="n">data</span>
</span></pre></div>


            <div class="docstring"><p>Function filters out noise in scan, it sets all
pixels &gt; 100 (bone) to 100 and all
pixels &lt; 0 (background) to value 0
(original scan max value is approx. 1000 and min value -1000)</p>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>data</strong>:  CT scan data array in HU</li>
<li><strong>dil_mat</strong>:  Dilation matrix of shape (N x N)</li>
<li><strong>show_diff</strong>:  True/False (debug parameter) - if true result is shown</li>
<li><strong>save</strong>:  True/False - if true result scan is saved </li>
</ul>

<h6 id="returns">Returns</h6>

<blockquote>
  <p>clean (without noise) data</p>
</blockquote>
</div>


                </section>
                <section id="zoom_scan">
                            <input id="zoom_scan-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">zoom_scan</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">data</span>, </span><span class="param"><span class="n">out_width</span><span class="o">=</span><span class="mi">512</span>, </span><span class="param"><span class="n">out_height</span><span class="o">=</span><span class="mi">512</span>, </span><span class="param"><span class="n">out_depth</span><span class="o">=</span><span class="mi">30</span>, </span><span class="param"><span class="n">show_diff</span><span class="o">=</span><span class="kc">False</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="zoom_scan-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#zoom_scan"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="zoom_scan-288"><a href="#zoom_scan-288"><span class="linenos">288</span></a><span class="k">def</span> <span class="nf">zoom_scan</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">out_width</span><span class="o">=</span><span class="mi">512</span><span class="p">,</span> <span class="n">out_height</span><span class="o">=</span><span class="mi">512</span><span class="p">,</span> <span class="n">out_depth</span><span class="o">=</span><span class="mi">30</span><span class="p">,</span> <span class="n">show_diff</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
</span><span id="zoom_scan-289"><a href="#zoom_scan-289"><span class="linenos">289</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="zoom_scan-290"><a href="#zoom_scan-290"><span class="linenos">290</span></a><span class="sd">    Function zooms in on given data array of size = org_width x org_height</span>
</span><span id="zoom_scan-291"><a href="#zoom_scan-291"><span class="linenos">291</span></a><span class="sd">    to new resolution = out_width x out_height</span>
</span><span id="zoom_scan-292"><a href="#zoom_scan-292"><span class="linenos">292</span></a><span class="sd">    </span>
</span><span id="zoom_scan-293"><a href="#zoom_scan-293"><span class="linenos">293</span></a><span class="sd">    :param data: Single CT scan data array</span>
</span><span id="zoom_scan-294"><a href="#zoom_scan-294"><span class="linenos">294</span></a><span class="sd">    :param out_depth: Output data depth</span>
</span><span id="zoom_scan-295"><a href="#zoom_scan-295"><span class="linenos">295</span></a><span class="sd">    :param out_width: Output data width</span>
</span><span id="zoom_scan-296"><a href="#zoom_scan-296"><span class="linenos">296</span></a><span class="sd">    :param out_height: Output data height</span>
</span><span id="zoom_scan-297"><a href="#zoom_scan-297"><span class="linenos">297</span></a><span class="sd">    :param show_diff: True/False (debug parameter) - if true result is shown</span>
</span><span id="zoom_scan-298"><a href="#zoom_scan-298"><span class="linenos">298</span></a><span class="sd">    :return: Resized data</span>
</span><span id="zoom_scan-299"><a href="#zoom_scan-299"><span class="linenos">299</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="zoom_scan-300"><a href="#zoom_scan-300"><span class="linenos">300</span></a>    <span class="c1"># assert data.shape[0] == out_depth</span>
</span><span id="zoom_scan-301"><a href="#zoom_scan-301"><span class="linenos">301</span></a>
</span><span id="zoom_scan-302"><a href="#zoom_scan-302"><span class="linenos">302</span></a>    <span class="n">current_depth</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
</span><span id="zoom_scan-303"><a href="#zoom_scan-303"><span class="linenos">303</span></a>    <span class="n">current_width</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="zoom_scan-304"><a href="#zoom_scan-304"><span class="linenos">304</span></a>    <span class="n">current_height</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
</span><span id="zoom_scan-305"><a href="#zoom_scan-305"><span class="linenos">305</span></a>
</span><span id="zoom_scan-306"><a href="#zoom_scan-306"><span class="linenos">306</span></a>    <span class="n">depth_factor</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">/</span> <span class="p">(</span><span class="n">current_depth</span> <span class="o">/</span> <span class="n">out_depth</span><span class="p">)</span>
</span><span id="zoom_scan-307"><a href="#zoom_scan-307"><span class="linenos">307</span></a>    <span class="n">width_factor</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">/</span> <span class="p">(</span><span class="n">current_width</span> <span class="o">/</span> <span class="n">out_width</span><span class="p">)</span>
</span><span id="zoom_scan-308"><a href="#zoom_scan-308"><span class="linenos">308</span></a>    <span class="n">height_factor</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">/</span> <span class="p">(</span><span class="n">current_height</span> <span class="o">/</span> <span class="n">out_height</span><span class="p">)</span>
</span><span id="zoom_scan-309"><a href="#zoom_scan-309"><span class="linenos">309</span></a>
</span><span id="zoom_scan-310"><a href="#zoom_scan-310"><span class="linenos">310</span></a>    <span class="n">res</span> <span class="o">=</span> <span class="n">sp</span><span class="o">.</span><span class="n">ndimage</span><span class="o">.</span><span class="n">zoom</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="p">(</span><span class="n">width_factor</span><span class="p">,</span> <span class="n">height_factor</span><span class="p">,</span> <span class="n">depth_factor</span><span class="p">),</span> <span class="n">order</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
</span><span id="zoom_scan-311"><a href="#zoom_scan-311"><span class="linenos">311</span></a>    <span class="k">if</span> <span class="n">show_diff</span><span class="p">:</span>
</span><span id="zoom_scan-312"><a href="#zoom_scan-312"><span class="linenos">312</span></a>        <span class="n">ind</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">current_depth</span><span class="p">)</span>
</span><span id="zoom_scan-313"><a href="#zoom_scan-313"><span class="linenos">313</span></a>        <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">[</span><span class="mi">8</span><span class="p">,</span> <span class="mi">8</span><span class="p">])</span>
</span><span id="zoom_scan-314"><a href="#zoom_scan-314"><span class="linenos">314</span></a>        <span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Original scan&#39;</span><span class="p">)</span>
</span><span id="zoom_scan-315"><a href="#zoom_scan-315"><span class="linenos">315</span></a>        <span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">data</span><span class="p">[:,</span> <span class="p">:,</span> <span class="n">ind</span><span class="p">],</span> <span class="n">aspect</span><span class="o">=</span><span class="s1">&#39;auto&#39;</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">cm</span><span class="o">.</span><span class="n">bone</span><span class="p">)</span>
</span><span id="zoom_scan-316"><a href="#zoom_scan-316"><span class="linenos">316</span></a>
</span><span id="zoom_scan-317"><a href="#zoom_scan-317"><span class="linenos">317</span></a>        <span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Zoomed scan&#39;</span><span class="p">)</span>
</span><span id="zoom_scan-318"><a href="#zoom_scan-318"><span class="linenos">318</span></a>        <span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">res</span><span class="p">[:,</span> <span class="p">:,</span> <span class="n">ind</span><span class="p">],</span> <span class="n">aspect</span><span class="o">=</span><span class="s1">&#39;auto&#39;</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">cm</span><span class="o">.</span><span class="n">bone</span><span class="p">)</span>
</span><span id="zoom_scan-319"><a href="#zoom_scan-319"><span class="linenos">319</span></a>        <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="n">block</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="zoom_scan-320"><a href="#zoom_scan-320"><span class="linenos">320</span></a>
</span><span id="zoom_scan-321"><a href="#zoom_scan-321"><span class="linenos">321</span></a>    <span class="k">return</span> <span class="n">res</span>
</span></pre></div>


            <div class="docstring"><p>Function zooms in on given data array of size = org_width x org_height
to new resolution = out_width x out_height</p>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>data</strong>:  Single CT scan data array</li>
<li><strong>out_depth</strong>:  Output data depth</li>
<li><strong>out_width</strong>:  Output data width</li>
<li><strong>out_height</strong>:  Output data height</li>
<li><strong>show_diff</strong>:  True/False (debug parameter) - if true result is shown</li>
</ul>

<h6 id="returns">Returns</h6>

<blockquote>
  <p>Resized data</p>
</blockquote>
</div>


                </section>
                <section id="resize_scan">
                            <input id="resize_scan-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">resize_scan</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="n">data</span><span class="p">:</span> <span class="n">Any</span>,</span><span class="param">	<span class="n">out_width</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">512</span>,</span><span class="param">	<span class="n">out_height</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">512</span>,</span><span class="param">	<span class="n">show_diff</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="resize_scan-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#resize_scan"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="resize_scan-324"><a href="#resize_scan-324"><span class="linenos">324</span></a><span class="k">def</span> <span class="nf">resize_scan</span><span class="p">(</span><span class="n">data</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span>
</span><span id="resize_scan-325"><a href="#resize_scan-325"><span class="linenos">325</span></a>                <span class="n">out_width</span><span class="p">:</span> <span class="nb">int</span><span class="o">=</span><span class="mi">512</span><span class="p">,</span>
</span><span id="resize_scan-326"><a href="#resize_scan-326"><span class="linenos">326</span></a>                <span class="n">out_height</span><span class="p">:</span> <span class="nb">int</span><span class="o">=</span><span class="mi">512</span><span class="p">,</span>
</span><span id="resize_scan-327"><a href="#resize_scan-327"><span class="linenos">327</span></a>                <span class="n">show_diff</span><span class="p">:</span> <span class="nb">bool</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
</span><span id="resize_scan-328"><a href="#resize_scan-328"><span class="linenos">328</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="resize_scan-329"><a href="#resize_scan-329"><span class="linenos">329</span></a><span class="sd">    Function resizes given data array of size = org_width x org_height</span>
</span><span id="resize_scan-330"><a href="#resize_scan-330"><span class="linenos">330</span></a><span class="sd">    to new resolution = out_width x out_height</span>
</span><span id="resize_scan-331"><a href="#resize_scan-331"><span class="linenos">331</span></a><span class="sd">    </span>
</span><span id="resize_scan-332"><a href="#resize_scan-332"><span class="linenos">332</span></a><span class="sd">    :param data: Single CT scan data array</span>
</span><span id="resize_scan-333"><a href="#resize_scan-333"><span class="linenos">333</span></a><span class="sd">    :param out_width: Output data width</span>
</span><span id="resize_scan-334"><a href="#resize_scan-334"><span class="linenos">334</span></a><span class="sd">    :param out_height: Output data height</span>
</span><span id="resize_scan-335"><a href="#resize_scan-335"><span class="linenos">335</span></a><span class="sd">    :param show_diff: True/False (debug parameter) - if true result is shown</span>
</span><span id="resize_scan-336"><a href="#resize_scan-336"><span class="linenos">336</span></a><span class="sd">    :return: Resized data</span>
</span><span id="resize_scan-337"><a href="#resize_scan-337"><span class="linenos">337</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="resize_scan-338"><a href="#resize_scan-338"><span class="linenos">338</span></a>    <span class="n">new</span> <span class="o">=</span> <span class="n">skimage</span><span class="o">.</span><span class="n">transform</span><span class="o">.</span><span class="n">resize</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="p">(</span><span class="n">out_width</span><span class="p">,</span> <span class="n">out_height</span><span class="p">),</span>
</span><span id="resize_scan-339"><a href="#resize_scan-339"><span class="linenos">339</span></a>                                   <span class="n">preserve_range</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span id="resize_scan-340"><a href="#resize_scan-340"><span class="linenos">340</span></a>                                   <span class="n">anti_aliasing</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
</span><span id="resize_scan-341"><a href="#resize_scan-341"><span class="linenos">341</span></a>                                   <span class="n">order</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span>
</span><span id="resize_scan-342"><a href="#resize_scan-342"><span class="linenos">342</span></a>
</span><span id="resize_scan-343"><a href="#resize_scan-343"><span class="linenos">343</span></a>    <span class="k">if</span> <span class="n">show_diff</span><span class="p">:</span>
</span><span id="resize_scan-344"><a href="#resize_scan-344"><span class="linenos">344</span></a>        <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">[</span><span class="mi">8</span><span class="p">,</span> <span class="mi">8</span><span class="p">])</span>
</span><span id="resize_scan-345"><a href="#resize_scan-345"><span class="linenos">345</span></a>        <span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Original scan&#39;</span><span class="p">)</span>
</span><span id="resize_scan-346"><a href="#resize_scan-346"><span class="linenos">346</span></a>        <span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">aspect</span><span class="o">=</span><span class="s1">&#39;auto&#39;</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">cm</span><span class="o">.</span><span class="n">bone</span><span class="p">)</span>
</span><span id="resize_scan-347"><a href="#resize_scan-347"><span class="linenos">347</span></a>
</span><span id="resize_scan-348"><a href="#resize_scan-348"><span class="linenos">348</span></a>        <span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Resized scan&#39;</span><span class="p">)</span>
</span><span id="resize_scan-349"><a href="#resize_scan-349"><span class="linenos">349</span></a>        <span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">new</span><span class="p">,</span> <span class="n">aspect</span><span class="o">=</span><span class="s1">&#39;auto&#39;</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">cm</span><span class="o">.</span><span class="n">bone</span><span class="p">)</span>
</span><span id="resize_scan-350"><a href="#resize_scan-350"><span class="linenos">350</span></a>        <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="n">block</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="resize_scan-351"><a href="#resize_scan-351"><span class="linenos">351</span></a>    <span class="k">return</span> <span class="n">new</span>
</span></pre></div>


            <div class="docstring"><p>Function resizes given data array of size = org_width x org_height
to new resolution = out_width x out_height</p>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>data</strong>:  Single CT scan data array</li>
<li><strong>out_width</strong>:  Output data width</li>
<li><strong>out_height</strong>:  Output data height</li>
<li><strong>show_diff</strong>:  True/False (debug parameter) - if true result is shown</li>
</ul>

<h6 id="returns">Returns</h6>

<blockquote>
  <p>Resized data</p>
</blockquote>
</div>


                </section>
                <section id="move_to_center">
                            <input id="move_to_center-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">move_to_center</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">data</span>, </span><span class="param"><span class="n">out_width</span><span class="o">=</span><span class="mi">512</span>, </span><span class="param"><span class="n">out_height</span><span class="o">=</span><span class="mi">512</span>, </span><span class="param"><span class="n">show_diff</span><span class="o">=</span><span class="kc">False</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="move_to_center-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#move_to_center"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="move_to_center-354"><a href="#move_to_center-354"><span class="linenos">354</span></a><span class="k">def</span> <span class="nf">move_to_center</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">out_width</span><span class="o">=</span><span class="mi">512</span><span class="p">,</span> <span class="n">out_height</span><span class="o">=</span><span class="mi">512</span><span class="p">,</span> <span class="n">show_diff</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
</span><span id="move_to_center-355"><a href="#move_to_center-355"><span class="linenos">355</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="move_to_center-356"><a href="#move_to_center-356"><span class="linenos">356</span></a><span class="sd">    Function resizes CT scan to given resolution</span>
</span><span id="move_to_center-357"><a href="#move_to_center-357"><span class="linenos">357</span></a><span class="sd">    First it shifts brain in the center</span>
</span><span id="move_to_center-358"><a href="#move_to_center-358"><span class="linenos">358</span></a><span class="sd">    Additional padding is added afterwards</span>
</span><span id="move_to_center-359"><a href="#move_to_center-359"><span class="linenos">359</span></a>
</span><span id="move_to_center-360"><a href="#move_to_center-360"><span class="linenos">360</span></a><span class="sd">    :param data: Single CT scan data array</span>
</span><span id="move_to_center-361"><a href="#move_to_center-361"><span class="linenos">361</span></a><span class="sd">    :param out_width: Output data width</span>
</span><span id="move_to_center-362"><a href="#move_to_center-362"><span class="linenos">362</span></a><span class="sd">    :param out_height: Output data height</span>
</span><span id="move_to_center-363"><a href="#move_to_center-363"><span class="linenos">363</span></a><span class="sd">    :param show_diff: True/False (debug parameter) - if true result is shown</span>
</span><span id="move_to_center-364"><a href="#move_to_center-364"><span class="linenos">364</span></a><span class="sd">    :returns: Single CT scan shifted to center of array</span>
</span><span id="move_to_center-365"><a href="#move_to_center-365"><span class="linenos">365</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="move_to_center-366"><a href="#move_to_center-366"><span class="linenos">366</span></a>    <span class="c1"># Brain is surrounded by black backgroud (black pixel = 0) </span>
</span><span id="move_to_center-367"><a href="#move_to_center-367"><span class="linenos">367</span></a>    <span class="n">mask</span> <span class="o">=</span> <span class="n">data</span> <span class="o">==</span> <span class="mi">0</span>
</span><span id="move_to_center-368"><a href="#move_to_center-368"><span class="linenos">368</span></a>
</span><span id="move_to_center-369"><a href="#move_to_center-369"><span class="linenos">369</span></a>    <span class="c1"># Brain_array = Scan_array - Scan_background </span>
</span><span id="move_to_center-370"><a href="#move_to_center-370"><span class="linenos">370</span></a>    <span class="n">coords</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">nonzero</span><span class="p">(</span><span class="o">~</span><span class="n">mask</span><span class="p">))</span>
</span><span id="move_to_center-371"><a href="#move_to_center-371"><span class="linenos">371</span></a>
</span><span id="move_to_center-372"><a href="#move_to_center-372"><span class="linenos">372</span></a>    <span class="k">try</span><span class="p">:</span>
</span><span id="move_to_center-373"><a href="#move_to_center-373"><span class="linenos">373</span></a>        <span class="n">top_left</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">coords</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</span><span id="move_to_center-374"><a href="#move_to_center-374"><span class="linenos">374</span></a>        <span class="n">bottom_right</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">coords</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</span><span id="move_to_center-375"><a href="#move_to_center-375"><span class="linenos">375</span></a>    <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
</span><span id="move_to_center-376"><a href="#move_to_center-376"><span class="linenos">376</span></a>        <span class="c1"># First slices of CT scan are just air (slice with only black pixels)</span>
</span><span id="move_to_center-377"><a href="#move_to_center-377"><span class="linenos">377</span></a>        <span class="k">if</span> <span class="n">show_diff</span><span class="p">:</span>
</span><span id="move_to_center-378"><a href="#move_to_center-378"><span class="linenos">378</span></a>            <span class="nb">print</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
</span><span id="move_to_center-379"><a href="#move_to_center-379"><span class="linenos">379</span></a>            <span class="nb">print</span><span class="p">(</span><span class="n">coords</span><span class="p">)</span>
</span><span id="move_to_center-380"><a href="#move_to_center-380"><span class="linenos">380</span></a>            <span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;bone&#39;</span><span class="p">)</span>
</span><span id="move_to_center-381"><a href="#move_to_center-381"><span class="linenos">381</span></a>            <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</span><span id="move_to_center-382"><a href="#move_to_center-382"><span class="linenos">382</span></a>        <span class="k">return</span> <span class="n">data</span>
</span><span id="move_to_center-383"><a href="#move_to_center-383"><span class="linenos">383</span></a>
</span><span id="move_to_center-384"><a href="#move_to_center-384"><span class="linenos">384</span></a>    <span class="c1"># Remove the background</span>
</span><span id="move_to_center-385"><a href="#move_to_center-385"><span class="linenos">385</span></a>    <span class="n">croped_scan</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">top_left</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span><span class="n">bottom_right</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">top_left</span><span class="p">[</span><span class="mi">1</span><span class="p">]:</span><span class="n">bottom_right</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span>
</span><span id="move_to_center-386"><a href="#move_to_center-386"><span class="linenos">386</span></a>
</span><span id="move_to_center-387"><a href="#move_to_center-387"><span class="linenos">387</span></a>    <span class="k">if</span> <span class="n">croped_scan</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">out_width</span> <span class="ow">or</span> <span class="n">croped_scan</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">out_height</span><span class="p">:</span>
</span><span id="move_to_center-388"><a href="#move_to_center-388"><span class="linenos">388</span></a>        <span class="n">croped_scan</span> <span class="o">=</span> <span class="n">resize_scan</span><span class="p">(</span><span class="n">croped_scan</span><span class="p">,</span> <span class="n">out_width</span><span class="p">,</span> <span class="n">out_height</span><span class="p">)</span>
</span><span id="move_to_center-389"><a href="#move_to_center-389"><span class="linenos">389</span></a>
</span><span id="move_to_center-390"><a href="#move_to_center-390"><span class="linenos">390</span></a>    <span class="n">height</span><span class="p">,</span> <span class="n">width</span> <span class="o">=</span> <span class="n">croped_scan</span><span class="o">.</span><span class="n">shape</span>
</span><span id="move_to_center-391"><a href="#move_to_center-391"><span class="linenos">391</span></a>    <span class="n">final_image</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">out_height</span><span class="p">,</span> <span class="n">out_width</span><span class="p">))</span>
</span><span id="move_to_center-392"><a href="#move_to_center-392"><span class="linenos">392</span></a>
</span><span id="move_to_center-393"><a href="#move_to_center-393"><span class="linenos">393</span></a>    <span class="n">pad_left</span> <span class="o">=</span> <span class="nb">int</span><span class="p">((</span><span class="n">out_width</span> <span class="o">-</span> <span class="n">width</span><span class="p">)</span> <span class="o">//</span> <span class="mi">2</span><span class="p">)</span>
</span><span id="move_to_center-394"><a href="#move_to_center-394"><span class="linenos">394</span></a>    <span class="n">pad_top</span> <span class="o">=</span> <span class="nb">int</span><span class="p">((</span><span class="n">out_height</span> <span class="o">-</span> <span class="n">height</span><span class="p">)</span> <span class="o">//</span> <span class="mi">2</span><span class="p">)</span>
</span><span id="move_to_center-395"><a href="#move_to_center-395"><span class="linenos">395</span></a>
</span><span id="move_to_center-396"><a href="#move_to_center-396"><span class="linenos">396</span></a>    <span class="c1"># Replace the pixels with the image&#39;s pixels</span>
</span><span id="move_to_center-397"><a href="#move_to_center-397"><span class="linenos">397</span></a>    <span class="c1"># try:</span>
</span><span id="move_to_center-398"><a href="#move_to_center-398"><span class="linenos">398</span></a>    <span class="n">final_image</span><span class="p">[</span><span class="n">pad_top</span><span class="p">:</span><span class="n">pad_top</span> <span class="o">+</span> <span class="n">height</span><span class="p">,</span> <span class="n">pad_left</span><span class="p">:</span><span class="n">pad_left</span> <span class="o">+</span> <span class="n">width</span><span class="p">]</span> <span class="o">=</span> <span class="n">croped_scan</span>
</span><span id="move_to_center-399"><a href="#move_to_center-399"><span class="linenos">399</span></a>    <span class="c1"># final_image.ravel([pad_top:pad_top + height, pad_left:pad_left + width])</span>
</span><span id="move_to_center-400"><a href="#move_to_center-400"><span class="linenos">400</span></a>
</span><span id="move_to_center-401"><a href="#move_to_center-401"><span class="linenos">401</span></a>    <span class="k">if</span> <span class="n">show_diff</span><span class="p">:</span>
</span><span id="move_to_center-402"><a href="#move_to_center-402"><span class="linenos">402</span></a>        <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">[</span><span class="mi">8</span><span class="p">,</span> <span class="mi">8</span><span class="p">])</span>
</span><span id="move_to_center-403"><a href="#move_to_center-403"><span class="linenos">403</span></a>        <span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Original scan&#39;</span><span class="p">)</span>
</span><span id="move_to_center-404"><a href="#move_to_center-404"><span class="linenos">404</span></a>        <span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">aspect</span><span class="o">=</span><span class="s1">&#39;auto&#39;</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">cm</span><span class="o">.</span><span class="n">bone</span><span class="p">)</span>
</span><span id="move_to_center-405"><a href="#move_to_center-405"><span class="linenos">405</span></a>
</span><span id="move_to_center-406"><a href="#move_to_center-406"><span class="linenos">406</span></a>        <span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Shifted scan&#39;</span><span class="p">)</span>
</span><span id="move_to_center-407"><a href="#move_to_center-407"><span class="linenos">407</span></a>        <span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">final_image</span><span class="p">,</span> <span class="n">aspect</span><span class="o">=</span><span class="s1">&#39;auto&#39;</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">cm</span><span class="o">.</span><span class="n">bone</span><span class="p">)</span>
</span><span id="move_to_center-408"><a href="#move_to_center-408"><span class="linenos">408</span></a>        <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="n">block</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="move_to_center-409"><a href="#move_to_center-409"><span class="linenos">409</span></a>
</span><span id="move_to_center-410"><a href="#move_to_center-410"><span class="linenos">410</span></a>    <span class="k">return</span> <span class="n">final_image</span>
</span></pre></div>


            <div class="docstring"><p>Function resizes CT scan to given resolution
First it shifts brain in the center
Additional padding is added afterwards</p>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>data</strong>:  Single CT scan data array</li>
<li><strong>out_width</strong>:  Output data width</li>
<li><strong>out_height</strong>:  Output data height</li>
<li><strong>show_diff</strong>:  True/False (debug parameter) - if true result is shown
:returns: Single CT scan shifted to center of array</li>
</ul>
</div>


                </section>
                <section id="rotate_to_center">
                            <input id="rotate_to_center-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">rotate_to_center</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">data</span>, </span><span class="param"><span class="n">show_diff</span><span class="o">=</span><span class="kc">False</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="rotate_to_center-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#rotate_to_center"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="rotate_to_center-413"><a href="#rotate_to_center-413"><span class="linenos">413</span></a><span class="k">def</span> <span class="nf">rotate_to_center</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">show_diff</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
</span><span id="rotate_to_center-414"><a href="#rotate_to_center-414"><span class="linenos">414</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="rotate_to_center-415"><a href="#rotate_to_center-415"><span class="linenos">415</span></a><span class="sd">    Function straightens tilted brain scan</span>
</span><span id="rotate_to_center-416"><a href="#rotate_to_center-416"><span class="linenos">416</span></a>
</span><span id="rotate_to_center-417"><a href="#rotate_to_center-417"><span class="linenos">417</span></a><span class="sd">    :param data: Single tilted CT scan data array</span>
</span><span id="rotate_to_center-418"><a href="#rotate_to_center-418"><span class="linenos">418</span></a><span class="sd">    :param show_diff: True/False (debug parameter) - if true result is shown</span>
</span><span id="rotate_to_center-419"><a href="#rotate_to_center-419"><span class="linenos">419</span></a><span class="sd">    :returns: Straight CT scan data array</span>
</span><span id="rotate_to_center-420"><a href="#rotate_to_center-420"><span class="linenos">420</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="rotate_to_center-421"><a href="#rotate_to_center-421"><span class="linenos">421</span></a>    <span class="c1"># @TODO - nefunguje vo vela pripadoch</span>
</span><span id="rotate_to_center-422"><a href="#rotate_to_center-422"><span class="linenos">422</span></a>    <span class="n">scan</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">uint8</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
</span><span id="rotate_to_center-423"><a href="#rotate_to_center-423"><span class="linenos">423</span></a>    <span class="n">contours</span><span class="p">,</span> <span class="n">hier</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">findContours</span><span class="p">(</span><span class="n">scan</span><span class="p">,</span> <span class="n">cv2</span><span class="o">.</span><span class="n">RETR_EXTERNAL</span><span class="p">,</span> <span class="n">cv2</span><span class="o">.</span><span class="n">CHAIN_APPROX_SIMPLE</span><span class="p">)</span>
</span><span id="rotate_to_center-424"><a href="#rotate_to_center-424"><span class="linenos">424</span></a>    <span class="n">mask</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">scan</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>  <span class="c1"># , np.uint8)</span>
</span><span id="rotate_to_center-425"><a href="#rotate_to_center-425"><span class="linenos">425</span></a>
</span><span id="rotate_to_center-426"><a href="#rotate_to_center-426"><span class="linenos">426</span></a>    <span class="c1"># find the biggest contour (c) by the area</span>
</span><span id="rotate_to_center-427"><a href="#rotate_to_center-427"><span class="linenos">427</span></a>    <span class="n">c</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">contours</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="n">cv2</span><span class="o">.</span><span class="n">contourArea</span><span class="p">)</span>
</span><span id="rotate_to_center-428"><a href="#rotate_to_center-428"><span class="linenos">428</span></a>
</span><span id="rotate_to_center-429"><a href="#rotate_to_center-429"><span class="linenos">429</span></a>    <span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">),</span> <span class="p">(</span><span class="n">MA</span><span class="p">,</span> <span class="n">ma</span><span class="p">),</span> <span class="n">angle</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">fitEllipse</span><span class="p">(</span><span class="n">c</span><span class="p">)</span>
</span><span id="rotate_to_center-430"><a href="#rotate_to_center-430"><span class="linenos">430</span></a>
</span><span id="rotate_to_center-431"><a href="#rotate_to_center-431"><span class="linenos">431</span></a>    <span class="n">cv2</span><span class="o">.</span><span class="n">ellipse</span><span class="p">(</span><span class="n">scan</span><span class="p">,</span> <span class="p">((</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">),</span> <span class="p">(</span><span class="n">MA</span><span class="p">,</span> <span class="n">ma</span><span class="p">),</span> <span class="n">angle</span><span class="p">),</span> <span class="n">color</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">255</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="n">thickness</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
</span><span id="rotate_to_center-432"><a href="#rotate_to_center-432"><span class="linenos">432</span></a>
</span><span id="rotate_to_center-433"><a href="#rotate_to_center-433"><span class="linenos">433</span></a>    <span class="n">rmajor</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">MA</span><span class="p">,</span> <span class="n">ma</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span>
</span><span id="rotate_to_center-434"><a href="#rotate_to_center-434"><span class="linenos">434</span></a>
</span><span id="rotate_to_center-435"><a href="#rotate_to_center-435"><span class="linenos">435</span></a>    <span class="k">if</span> <span class="n">angle</span> <span class="o">&gt;</span> <span class="mi">90</span><span class="p">:</span>
</span><span id="rotate_to_center-436"><a href="#rotate_to_center-436"><span class="linenos">436</span></a>        <span class="n">angle</span> <span class="o">-=</span> <span class="mi">90</span>
</span><span id="rotate_to_center-437"><a href="#rotate_to_center-437"><span class="linenos">437</span></a>    <span class="k">else</span><span class="p">:</span>
</span><span id="rotate_to_center-438"><a href="#rotate_to_center-438"><span class="linenos">438</span></a>        <span class="n">angle</span> <span class="o">+=</span> <span class="mi">90</span>
</span><span id="rotate_to_center-439"><a href="#rotate_to_center-439"><span class="linenos">439</span></a>
</span><span id="rotate_to_center-440"><a href="#rotate_to_center-440"><span class="linenos">440</span></a>    <span class="n">X_top</span> <span class="o">=</span> <span class="n">x</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">radians</span><span class="p">(</span><span class="n">angle</span><span class="p">))</span> <span class="o">*</span> <span class="n">rmajor</span>
</span><span id="rotate_to_center-441"><a href="#rotate_to_center-441"><span class="linenos">441</span></a>    <span class="n">Y_top</span> <span class="o">=</span> <span class="n">y</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">radians</span><span class="p">(</span><span class="n">angle</span><span class="p">))</span> <span class="o">*</span> <span class="n">rmajor</span>
</span><span id="rotate_to_center-442"><a href="#rotate_to_center-442"><span class="linenos">442</span></a>    <span class="n">X_bot</span> <span class="o">=</span> <span class="n">x</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">radians</span><span class="p">(</span><span class="n">angle</span> <span class="o">+</span> <span class="mi">180</span><span class="p">))</span> <span class="o">*</span> <span class="n">rmajor</span>
</span><span id="rotate_to_center-443"><a href="#rotate_to_center-443"><span class="linenos">443</span></a>    <span class="n">Y_bot</span> <span class="o">=</span> <span class="n">y</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">radians</span><span class="p">(</span><span class="n">angle</span> <span class="o">+</span> <span class="mi">180</span><span class="p">))</span> <span class="o">*</span> <span class="n">rmajor</span>
</span><span id="rotate_to_center-444"><a href="#rotate_to_center-444"><span class="linenos">444</span></a>
</span><span id="rotate_to_center-445"><a href="#rotate_to_center-445"><span class="linenos">445</span></a>    <span class="n">M</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">getRotationMatrix2D</span><span class="p">((</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">),</span> <span class="n">angle</span> <span class="o">-</span> <span class="mi">90</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
</span><span id="rotate_to_center-446"><a href="#rotate_to_center-446"><span class="linenos">446</span></a>    <span class="n">straight_scan</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">warpAffine</span><span class="p">(</span><span class="n">scan</span><span class="p">,</span> <span class="n">M</span><span class="p">,</span> <span class="p">(</span><span class="n">scan</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">scan</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span> <span class="n">cv2</span><span class="o">.</span><span class="n">INTER_CUBIC</span><span class="p">)</span>
</span><span id="rotate_to_center-447"><a href="#rotate_to_center-447"><span class="linenos">447</span></a>
</span><span id="rotate_to_center-448"><a href="#rotate_to_center-448"><span class="linenos">448</span></a>    <span class="k">if</span> <span class="n">show_diff</span><span class="p">:</span>
</span><span id="rotate_to_center-449"><a href="#rotate_to_center-449"><span class="linenos">449</span></a>        <span class="c1"># Show line of rotation</span>
</span><span id="rotate_to_center-450"><a href="#rotate_to_center-450"><span class="linenos">450</span></a>        <span class="n">cv2</span><span class="o">.</span><span class="n">line</span><span class="p">(</span><span class="n">scan</span><span class="p">,</span> <span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">X_top</span><span class="p">),</span> <span class="nb">int</span><span class="p">(</span><span class="n">Y_top</span><span class="p">)),</span> <span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">X_bot</span><span class="p">),</span> <span class="nb">int</span><span class="p">(</span><span class="n">Y_bot</span><span class="p">)),</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">255</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="mi">3</span><span class="p">)</span>
</span><span id="rotate_to_center-451"><a href="#rotate_to_center-451"><span class="linenos">451</span></a>
</span><span id="rotate_to_center-452"><a href="#rotate_to_center-452"><span class="linenos">452</span></a>        <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">[</span><span class="mi">8</span><span class="p">,</span> <span class="mi">8</span><span class="p">])</span>
</span><span id="rotate_to_center-453"><a href="#rotate_to_center-453"><span class="linenos">453</span></a>        <span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Tilted scan&#39;</span><span class="p">)</span>
</span><span id="rotate_to_center-454"><a href="#rotate_to_center-454"><span class="linenos">454</span></a>        <span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">scan</span><span class="p">,</span> <span class="n">aspect</span><span class="o">=</span><span class="s1">&#39;auto&#39;</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">cm</span><span class="o">.</span><span class="n">bone</span><span class="p">)</span>
</span><span id="rotate_to_center-455"><a href="#rotate_to_center-455"><span class="linenos">455</span></a>
</span><span id="rotate_to_center-456"><a href="#rotate_to_center-456"><span class="linenos">456</span></a>        <span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Straight scan&#39;</span><span class="p">)</span>
</span><span id="rotate_to_center-457"><a href="#rotate_to_center-457"><span class="linenos">457</span></a>        <span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">straight_scan</span><span class="p">,</span> <span class="n">aspect</span><span class="o">=</span><span class="s1">&#39;auto&#39;</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">cm</span><span class="o">.</span><span class="n">bone</span><span class="p">)</span>
</span><span id="rotate_to_center-458"><a href="#rotate_to_center-458"><span class="linenos">458</span></a>        <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="n">block</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="rotate_to_center-459"><a href="#rotate_to_center-459"><span class="linenos">459</span></a>
</span><span id="rotate_to_center-460"><a href="#rotate_to_center-460"><span class="linenos">460</span></a>    <span class="k">return</span> <span class="n">straight_scan</span>
</span></pre></div>


            <div class="docstring"><p>Function straightens tilted brain scan</p>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>data</strong>:  Single tilted CT scan data array</li>
<li><strong>show_diff</strong>:  True/False (debug parameter) - if true result is shown
:returns: Straight CT scan data array</li>
</ul>
</div>


                </section>
                <section id="uniform_depth">
                            <input id="uniform_depth-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">uniform_depth</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="n">data</span><span class="p">:</span> <span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span>,</span><span class="param">	<span class="n">depth</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">30</span>,</span><span class="param">	<span class="n">center_pos</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.6</span>,</span><span class="param">	<span class="n">type_</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;multi&#39;</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="uniform_depth-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#uniform_depth"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="uniform_depth-463"><a href="#uniform_depth-463"><span class="linenos">463</span></a><span class="k">def</span> <span class="nf">uniform_depth</span><span class="p">(</span><span class="n">data</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span>
</span><span id="uniform_depth-464"><a href="#uniform_depth-464"><span class="linenos">464</span></a>                  <span class="n">depth</span><span class="p">:</span> <span class="nb">int</span><span class="o">=</span><span class="mi">30</span><span class="p">,</span>
</span><span id="uniform_depth-465"><a href="#uniform_depth-465"><span class="linenos">465</span></a>                  <span class="n">center_pos</span><span class="p">:</span> <span class="nb">float</span><span class="o">=</span><span class="mi">3</span><span class="o">/</span><span class="mi">5</span><span class="p">,</span>
</span><span id="uniform_depth-466"><a href="#uniform_depth-466"><span class="linenos">466</span></a>                  <span class="n">type_</span><span class="p">:</span> <span class="nb">str</span><span class="o">=</span><span class="s1">&#39;multi&#39;</span><span class="p">,</span>
</span><span id="uniform_depth-467"><a href="#uniform_depth-467"><span class="linenos">467</span></a>                  <span class="p">):</span>
</span><span id="uniform_depth-468"><a href="#uniform_depth-468"><span class="linenos">468</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="uniform_depth-469"><a href="#uniform_depth-469"><span class="linenos">469</span></a><span class="sd">    Function uniforms depth of CT scans</span>
</span><span id="uniform_depth-470"><a href="#uniform_depth-470"><span class="linenos">470</span></a><span class="sd">    (given size of the body there might be more/less scans)</span>
</span><span id="uniform_depth-471"><a href="#uniform_depth-471"><span class="linenos">471</span></a>
</span><span id="uniform_depth-472"><a href="#uniform_depth-472"><span class="linenos">472</span></a><span class="sd">    -----------------------------------------</span>
</span><span id="uniform_depth-473"><a href="#uniform_depth-473"><span class="linenos">473</span></a><span class="sd">    In case of leukoencefalopathy classification:</span>
</span><span id="uniform_depth-474"><a href="#uniform_depth-474"><span class="linenos">474</span></a><span class="sd">    Ventricular system is located approx. in 3/5 depth of the scan</span>
</span><span id="uniform_depth-475"><a href="#uniform_depth-475"><span class="linenos">475</span></a><span class="sd">    -----------------------------------------</span>
</span><span id="uniform_depth-476"><a href="#uniform_depth-476"><span class="linenos">476</span></a><span class="sd">    </span>
</span><span id="uniform_depth-477"><a href="#uniform_depth-477"><span class="linenos">477</span></a><span class="sd">    :param data: numpy array data</span>
</span><span id="uniform_depth-478"><a href="#uniform_depth-478"><span class="linenos">478</span></a><span class="sd">    :param depth: number of</span>
</span><span id="uniform_depth-479"><a href="#uniform_depth-479"><span class="linenos">479</span></a><span class="sd">    :param center_pos: location of desired object in %</span>
</span><span id="uniform_depth-480"><a href="#uniform_depth-480"><span class="linenos">480</span></a><span class="sd">    :param type_: single/multi - single=single patient/ multi=multi patients</span>
</span><span id="uniform_depth-481"><a href="#uniform_depth-481"><span class="linenos">481</span></a><span class="sd">    :return: uniformed depth in data</span>
</span><span id="uniform_depth-482"><a href="#uniform_depth-482"><span class="linenos">482</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="uniform_depth-483"><a href="#uniform_depth-483"><span class="linenos">483</span></a>    <span class="k">if</span> <span class="n">type_</span> <span class="o">==</span> <span class="s1">&#39;single&#39;</span><span class="p">:</span>
</span><span id="uniform_depth-484"><a href="#uniform_depth-484"><span class="linenos">484</span></a>        <span class="n">data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">data</span><span class="p">])</span>
</span><span id="uniform_depth-485"><a href="#uniform_depth-485"><span class="linenos">485</span></a>
</span><span id="uniform_depth-486"><a href="#uniform_depth-486"><span class="linenos">486</span></a>    <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">data</span><span class="p">)</span> <span class="o">==</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
</span><span id="uniform_depth-487"><a href="#uniform_depth-487"><span class="linenos">487</span></a>        <span class="n">data</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
</span><span id="uniform_depth-488"><a href="#uniform_depth-488"><span class="linenos">488</span></a>
</span><span id="uniform_depth-489"><a href="#uniform_depth-489"><span class="linenos">489</span></a>    <span class="n">ct_scans</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>
</span><span id="uniform_depth-490"><a href="#uniform_depth-490"><span class="linenos">490</span></a>    <span class="k">for</span> <span class="n">scan</span> <span class="ow">in</span> <span class="n">data</span><span class="p">:</span>
</span><span id="uniform_depth-491"><a href="#uniform_depth-491"><span class="linenos">491</span></a>        <span class="c1"># Take only middle slices of CT scan (first/last parts have no important information)</span>
</span><span id="uniform_depth-492"><a href="#uniform_depth-492"><span class="linenos">492</span></a>        <span class="c1"># If CT scan has 71 and desired depth is 30 -&gt; final CT scan = original_scan[20:50]</span>
</span><span id="uniform_depth-493"><a href="#uniform_depth-493"><span class="linenos">493</span></a>        <span class="n">center</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">scan</span><span class="p">)</span> <span class="o">*</span> <span class="n">center_pos</span><span class="p">)</span>
</span><span id="uniform_depth-494"><a href="#uniform_depth-494"><span class="linenos">494</span></a>        <span class="n">ct_scans</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">scan</span><span class="p">[</span><span class="n">center</span> <span class="o">-</span> <span class="p">(</span><span class="n">depth</span> <span class="o">//</span> <span class="mi">2</span><span class="p">):</span> <span class="n">center</span> <span class="o">+</span> <span class="p">(</span><span class="n">depth</span> <span class="o">//</span> <span class="mi">2</span><span class="p">)])</span>
</span><span id="uniform_depth-495"><a href="#uniform_depth-495"><span class="linenos">495</span></a>
</span><span id="uniform_depth-496"><a href="#uniform_depth-496"><span class="linenos">496</span></a>    <span class="k">if</span> <span class="n">type_</span> <span class="o">==</span> <span class="s1">&#39;single&#39;</span><span class="p">:</span>
</span><span id="uniform_depth-497"><a href="#uniform_depth-497"><span class="linenos">497</span></a>        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">ct_scans</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
</span><span id="uniform_depth-498"><a href="#uniform_depth-498"><span class="linenos">498</span></a>    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">ct_scans</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Function uniforms depth of CT scans
(given size of the body there might be more/less scans)</p>

<hr />

<p>In case of leukoencefalopathy classification:</p>

<h2 id="ventricular-system-is-located-approx-in-35-depth-of-the-scan">Ventricular system is located approx. in 3/5 depth of the scan</h2>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>data</strong>:  numpy array data</li>
<li><strong>depth</strong>:  number of</li>
<li><strong>center_pos</strong>:  location of desired object in %</li>
<li><strong>type_</strong>:  single/multi - single=single patient/ multi=multi patients</li>
</ul>

<h6 id="returns">Returns</h6>

<blockquote>
  <p>uniformed depth in data</p>
</blockquote>
</div>


                </section>
                <section id="plot_ct_images">
                            <input id="plot_ct_images-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">plot_ct_images</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="n">data</span><span class="p">:</span> <span class="n">Any</span>,</span><span class="param">	<span class="n">rows</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">6</span>,</span><span class="param">	<span class="n">cols</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">6</span>,</span><span class="param">	<span class="n">start_with</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">10</span>,</span><span class="param">	<span class="n">show_every</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">3</span>,</span><span class="param">	<span class="n">block</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="plot_ct_images-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#plot_ct_images"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="plot_ct_images-501"><a href="#plot_ct_images-501"><span class="linenos">501</span></a><span class="k">def</span> <span class="nf">plot_ct_images</span><span class="p">(</span><span class="n">data</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span>
</span><span id="plot_ct_images-502"><a href="#plot_ct_images-502"><span class="linenos">502</span></a>                   <span class="n">rows</span><span class="p">:</span> <span class="nb">int</span><span class="o">=</span><span class="mi">6</span><span class="p">,</span>
</span><span id="plot_ct_images-503"><a href="#plot_ct_images-503"><span class="linenos">503</span></a>                   <span class="n">cols</span><span class="p">:</span> <span class="nb">int</span><span class="o">=</span><span class="mi">6</span><span class="p">,</span>
</span><span id="plot_ct_images-504"><a href="#plot_ct_images-504"><span class="linenos">504</span></a>                   <span class="n">start_with</span><span class="p">:</span> <span class="nb">int</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span>
</span><span id="plot_ct_images-505"><a href="#plot_ct_images-505"><span class="linenos">505</span></a>                   <span class="n">show_every</span><span class="p">:</span> <span class="nb">int</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span>
</span><span id="plot_ct_images-506"><a href="#plot_ct_images-506"><span class="linenos">506</span></a>                   <span class="n">block</span><span class="p">:</span> <span class="nb">bool</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span id="plot_ct_images-507"><a href="#plot_ct_images-507"><span class="linenos">507</span></a>                   <span class="p">):</span>
</span><span id="plot_ct_images-508"><a href="#plot_ct_images-508"><span class="linenos">508</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="plot_ct_images-509"><a href="#plot_ct_images-509"><span class="linenos">509</span></a><span class="sd">    Using matplotlib plots scans side by side</span>
</span><span id="plot_ct_images-510"><a href="#plot_ct_images-510"><span class="linenos">510</span></a>
</span><span id="plot_ct_images-511"><a href="#plot_ct_images-511"><span class="linenos">511</span></a><span class="sd">    :param data: list of scans</span>
</span><span id="plot_ct_images-512"><a href="#plot_ct_images-512"><span class="linenos">512</span></a><span class="sd">    :param rows: number of rows</span>
</span><span id="plot_ct_images-513"><a href="#plot_ct_images-513"><span class="linenos">513</span></a><span class="sd">    :param cols: number of columns</span>
</span><span id="plot_ct_images-514"><a href="#plot_ct_images-514"><span class="linenos">514</span></a><span class="sd">    :param start_with: initial scan to start with</span>
</span><span id="plot_ct_images-515"><a href="#plot_ct_images-515"><span class="linenos">515</span></a><span class="sd">    :param show_every: number of steps</span>
</span><span id="plot_ct_images-516"><a href="#plot_ct_images-516"><span class="linenos">516</span></a><span class="sd">    :param block:</span>
</span><span id="plot_ct_images-517"><a href="#plot_ct_images-517"><span class="linenos">517</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="plot_ct_images-518"><a href="#plot_ct_images-518"><span class="linenos">518</span></a>    <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">rows</span><span class="p">,</span> <span class="n">cols</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">[</span><span class="mi">8</span><span class="p">,</span> <span class="mi">8</span><span class="p">])</span>
</span><span id="plot_ct_images-519"><a href="#plot_ct_images-519"><span class="linenos">519</span></a>    <span class="n">index</span> <span class="o">=</span> <span class="n">start_with</span>
</span><span id="plot_ct_images-520"><a href="#plot_ct_images-520"><span class="linenos">520</span></a>    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">rows</span><span class="p">):</span>
</span><span id="plot_ct_images-521"><a href="#plot_ct_images-521"><span class="linenos">521</span></a>        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">cols</span><span class="p">):</span>
</span><span id="plot_ct_images-522"><a href="#plot_ct_images-522"><span class="linenos">522</span></a>            <span class="n">ax</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Scan slice </span><span class="si">{</span><span class="n">index</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
</span><span id="plot_ct_images-523"><a href="#plot_ct_images-523"><span class="linenos">523</span></a>            <span class="n">ax</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="n">index</span><span class="p">],</span> <span class="n">aspect</span><span class="o">=</span><span class="s1">&#39;auto&#39;</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">cm</span><span class="o">.</span><span class="n">bone</span><span class="p">)</span>
</span><span id="plot_ct_images-524"><a href="#plot_ct_images-524"><span class="linenos">524</span></a>            <span class="n">ax</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s1">&#39;off&#39;</span><span class="p">)</span>
</span><span id="plot_ct_images-525"><a href="#plot_ct_images-525"><span class="linenos">525</span></a>            <span class="n">index</span> <span class="o">+=</span> <span class="n">show_every</span>
</span><span id="plot_ct_images-526"><a href="#plot_ct_images-526"><span class="linenos">526</span></a>    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="n">block</span><span class="o">=</span><span class="n">block</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Using matplotlib plots scans side by side</p>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>data</strong>:  list of scans</li>
<li><strong>rows</strong>:  number of rows</li>
<li><strong>cols</strong>:  number of columns</li>
<li><strong>start_with</strong>:  initial scan to start with</li>
<li><strong>show_every</strong>:  number of steps</li>
<li><strong>block</strong>: </li>
</ul>
</div>


                </section>
                <section id="load_data">
                            <input id="load_data-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">load_data</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="n">path</span>,</span><span class="param">	<span class="n">limit</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1000</span>,</span><span class="param">	<span class="n">processed_type</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;numpy_data_processed&#39;</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="load_data-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#load_data"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="load_data-529"><a href="#load_data-529"><span class="linenos">529</span></a><span class="k">def</span> <span class="nf">load_data</span><span class="p">(</span><span class="n">path</span><span class="p">,</span>
</span><span id="load_data-530"><a href="#load_data-530"><span class="linenos">530</span></a>              <span class="n">limit</span><span class="p">:</span> <span class="nb">int</span><span class="o">=</span><span class="mi">1000</span><span class="p">,</span>
</span><span id="load_data-531"><a href="#load_data-531"><span class="linenos">531</span></a>              <span class="n">processed_type</span><span class="p">:</span> <span class="nb">str</span><span class="o">=</span><span class="s1">&#39;numpy_data_processed&#39;</span><span class="p">):</span>
</span><span id="load_data-532"><a href="#load_data-532"><span class="linenos">532</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="load_data-533"><a href="#load_data-533"><span class="linenos">533</span></a><span class="sd">    Function loads all data processed to numpy file(.npy)</span>
</span><span id="load_data-534"><a href="#load_data-534"><span class="linenos">534</span></a><span class="sd">    from all folders in a given path</span>
</span><span id="load_data-535"><a href="#load_data-535"><span class="linenos">535</span></a>
</span><span id="load_data-536"><a href="#load_data-536"><span class="linenos">536</span></a><span class="sd">    :param path: path to folder containing CT scans (pos or neg)</span>
</span><span id="load_data-537"><a href="#load_data-537"><span class="linenos">537</span></a><span class="sd">    :param limit: int limit how many files to return</span>
</span><span id="load_data-538"><a href="#load_data-538"><span class="linenos">538</span></a><span class="sd">    :param processed_type:</span>
</span><span id="load_data-539"><a href="#load_data-539"><span class="linenos">539</span></a><span class="sd">    :return: CT scans in numpy array</span>
</span><span id="load_data-540"><a href="#load_data-540"><span class="linenos">540</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="load_data-541"><a href="#load_data-541"><span class="linenos">541</span></a>    <span class="n">all_ct_scans</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>
</span><span id="load_data-542"><a href="#load_data-542"><span class="linenos">542</span></a>    <span class="n">count</span> <span class="o">=</span> <span class="mi">1</span>
</span><span id="load_data-543"><a href="#load_data-543"><span class="linenos">543</span></a>    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Path:&#39;</span><span class="p">,</span> <span class="n">path</span><span class="p">)</span>
</span><span id="load_data-544"><a href="#load_data-544"><span class="linenos">544</span></a>    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Loading CT data from numpy arrays...&#39;</span><span class="p">)</span>
</span><span id="load_data-545"><a href="#load_data-545"><span class="linenos">545</span></a>    <span class="k">for</span> <span class="n">directory</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="n">path</span><span class="p">):</span>
</span><span id="load_data-546"><a href="#load_data-546"><span class="linenos">546</span></a>        <span class="k">if</span> <span class="n">count</span> <span class="o">&lt;=</span> <span class="n">limit</span><span class="p">:</span>
</span><span id="load_data-547"><a href="#load_data-547"><span class="linenos">547</span></a>            <span class="n">dir_path</span> <span class="o">=</span> <span class="n">path</span> <span class="o">+</span> <span class="s1">&#39;/&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">directory</span><span class="p">)</span>
</span><span id="load_data-548"><a href="#load_data-548"><span class="linenos">548</span></a>            <span class="k">try</span><span class="p">:</span>
</span><span id="load_data-549"><a href="#load_data-549"><span class="linenos">549</span></a>                <span class="n">ct_scan</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">dir_path</span> <span class="o">+</span> <span class="s1">&#39;/&#39;</span> <span class="o">+</span> <span class="n">processed_type</span> <span class="o">+</span> <span class="s1">&#39;.npy&#39;</span><span class="p">,</span> <span class="n">allow_pickle</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="load_data-550"><a href="#load_data-550"><span class="linenos">550</span></a>                <span class="k">if</span> <span class="n">ct_scan</span><span class="o">.</span><span class="n">shape</span> <span class="o">!=</span> <span class="p">(</span><span class="mi">0</span><span class="p">,)</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">ct_scan</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">ct_scan</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">5</span><span class="p">:</span>
</span><span id="load_data-551"><a href="#load_data-551"><span class="linenos">551</span></a>                    <span class="n">all_ct_scans</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ct_scan</span><span class="o">.</span><span class="n">tolist</span><span class="p">())</span>
</span><span id="load_data-552"><a href="#load_data-552"><span class="linenos">552</span></a>                    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;-&#39;</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
</span><span id="load_data-553"><a href="#load_data-553"><span class="linenos">553</span></a>                    <span class="k">if</span> <span class="n">count</span> <span class="o">%</span> <span class="mi">10</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="load_data-554"><a href="#load_data-554"><span class="linenos">554</span></a>                        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;&gt; </span><span class="si">{</span><span class="n">count</span><span class="si">}</span><span class="s1"> DONE!&#39;</span><span class="p">)</span>
</span><span id="load_data-555"><a href="#load_data-555"><span class="linenos">555</span></a>                <span class="n">count</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="load_data-556"><a href="#load_data-556"><span class="linenos">556</span></a>            <span class="k">except</span> <span class="ne">FileNotFoundError</span><span class="p">:</span>
</span><span id="load_data-557"><a href="#load_data-557"><span class="linenos">557</span></a>                <span class="k">pass</span>
</span><span id="load_data-558"><a href="#load_data-558"><span class="linenos">558</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="load_data-559"><a href="#load_data-559"><span class="linenos">559</span></a>            <span class="k">pass</span>
</span><span id="load_data-560"><a href="#load_data-560"><span class="linenos">560</span></a>    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;CT data successfully loaded!&#39;</span><span class="p">)</span>
</span><span id="load_data-561"><a href="#load_data-561"><span class="linenos">561</span></a>
</span><span id="load_data-562"><a href="#load_data-562"><span class="linenos">562</span></a>    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">all_ct_scans</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Function loads all data processed to numpy file(.npy)
from all folders in a given path</p>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>path</strong>:  path to folder containing CT scans (pos or neg)</li>
<li><strong>limit</strong>:  int limit how many files to return</li>
<li><strong>processed_type</strong>: </li>
</ul>

<h6 id="returns">Returns</h6>

<blockquote>
  <p>CT scans in numpy array</p>
</blockquote>
</div>


                </section>
                <section id="remove_background">
                            <input id="remove_background-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">remove_background</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">data</span>, </span><span class="param"><span class="n">show_diff</span><span class="o">=</span><span class="kc">False</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="remove_background-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#remove_background"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="remove_background-565"><a href="#remove_background-565"><span class="linenos">565</span></a><span class="k">def</span> <span class="nf">remove_background</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">show_diff</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
</span><span id="remove_background-566"><a href="#remove_background-566"><span class="linenos">566</span></a>    <span class="c1"># TODO - implement this part</span>
</span><span id="remove_background-567"><a href="#remove_background-567"><span class="linenos">567</span></a>    <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="s2">&quot;To be done...&quot;</span><span class="p">)</span>
</span><span id="remove_background-568"><a href="#remove_background-568"><span class="linenos">568</span></a>
</span><span id="remove_background-569"><a href="#remove_background-569"><span class="linenos">569</span></a>    <span class="n">scan</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">uint8</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
</span><span id="remove_background-570"><a href="#remove_background-570"><span class="linenos">570</span></a>    <span class="n">contours</span><span class="p">,</span> <span class="n">hier</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">findContours</span><span class="p">(</span><span class="n">scan</span><span class="p">,</span> <span class="n">cv2</span><span class="o">.</span><span class="n">RETR_EXTERNAL</span><span class="p">,</span> <span class="n">cv2</span><span class="o">.</span><span class="n">CHAIN_APPROX_SIMPLE</span><span class="p">)</span>
</span><span id="remove_background-571"><a href="#remove_background-571"><span class="linenos">571</span></a>    <span class="n">mask</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">scan</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">uint8</span><span class="p">)</span>
</span><span id="remove_background-572"><a href="#remove_background-572"><span class="linenos">572</span></a>
</span><span id="remove_background-573"><a href="#remove_background-573"><span class="linenos">573</span></a>    <span class="c1"># find the biggest contour (c) by the area</span>
</span><span id="remove_background-574"><a href="#remove_background-574"><span class="linenos">574</span></a>    <span class="n">c</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">contours</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="n">cv2</span><span class="o">.</span><span class="n">contourArea</span><span class="p">)</span>
</span><span id="remove_background-575"><a href="#remove_background-575"><span class="linenos">575</span></a>    <span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">),</span> <span class="p">(</span><span class="n">MA</span><span class="p">,</span> <span class="n">ma</span><span class="p">),</span> <span class="n">angle</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">fitEllipse</span><span class="p">(</span><span class="n">c</span><span class="p">)</span>
</span><span id="remove_background-576"><a href="#remove_background-576"><span class="linenos">576</span></a>
</span><span id="remove_background-577"><a href="#remove_background-577"><span class="linenos">577</span></a>    <span class="c1"># cv2.ellipse(scan, ((x, y), (MA, ma), angle), color=(3, 5, 255), thickness=2)</span>
</span><span id="remove_background-578"><a href="#remove_background-578"><span class="linenos">578</span></a>    <span class="n">cv2</span><span class="o">.</span><span class="n">ellipse</span><span class="p">(</span><span class="n">mask</span><span class="p">,</span> <span class="p">((</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">),</span> <span class="p">(</span><span class="n">MA</span><span class="p">,</span> <span class="n">ma</span><span class="p">),</span> <span class="n">angle</span><span class="p">),</span> <span class="mi">255</span><span class="p">,</span> <span class="n">thickness</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
</span><span id="remove_background-579"><a href="#remove_background-579"><span class="linenos">579</span></a>
</span><span id="remove_background-580"><a href="#remove_background-580"><span class="linenos">580</span></a>    <span class="n">result</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">bitwise_and</span><span class="p">(</span><span class="n">mask</span><span class="p">,</span> <span class="n">scan</span><span class="p">)</span>
</span><span id="remove_background-581"><a href="#remove_background-581"><span class="linenos">581</span></a>    <span class="n">result</span><span class="p">[</span><span class="n">mask</span> <span class="o">==</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
</span><span id="remove_background-582"><a href="#remove_background-582"><span class="linenos">582</span></a>
</span><span id="remove_background-583"><a href="#remove_background-583"><span class="linenos">583</span></a>    <span class="k">if</span> <span class="n">show_diff</span><span class="p">:</span>
</span><span id="remove_background-584"><a href="#remove_background-584"><span class="linenos">584</span></a>        <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">[</span><span class="mi">8</span><span class="p">,</span> <span class="mi">8</span><span class="p">])</span>
</span><span id="remove_background-585"><a href="#remove_background-585"><span class="linenos">585</span></a>        <span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Background scan&#39;</span><span class="p">)</span>
</span><span id="remove_background-586"><a href="#remove_background-586"><span class="linenos">586</span></a>        <span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">aspect</span><span class="o">=</span><span class="s1">&#39;auto&#39;</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">cm</span><span class="o">.</span><span class="n">bone</span><span class="p">)</span>
</span><span id="remove_background-587"><a href="#remove_background-587"><span class="linenos">587</span></a>
</span><span id="remove_background-588"><a href="#remove_background-588"><span class="linenos">588</span></a>        <span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;W/o background scan&#39;</span><span class="p">)</span>
</span><span id="remove_background-589"><a href="#remove_background-589"><span class="linenos">589</span></a>        <span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">result</span><span class="p">,</span> <span class="n">aspect</span><span class="o">=</span><span class="s1">&#39;auto&#39;</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">cm</span><span class="o">.</span><span class="n">bone</span><span class="p">)</span>
</span><span id="remove_background-590"><a href="#remove_background-590"><span class="linenos">590</span></a>        <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="n">block</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="remove_background-591"><a href="#remove_background-591"><span class="linenos">591</span></a>
</span><span id="remove_background-592"><a href="#remove_background-592"><span class="linenos">592</span></a>    <span class="k">return</span> <span class="n">result</span>
</span></pre></div>


    

                </section>
    </main>
</body>
</html>